{
    "sourceFile": "app.py",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 63,
            "patches": [
                {
                    "date": 1752476972049,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752477007143,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,9 +7,9 @@\n from datetime import datetime\n \n # è®¾ç½®é¡µé¢é…ç½®\n st.set_page_config(\n-    page_title=\"æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n+    page_title=\"FoodSky\",\n     page_icon=\"ğŸ²\",\n     layout=\"wide\",\n     initial_sidebar_state=\"expanded\"\n )\n"
                },
                {
                    "date": 1752477026415,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,9 +7,9 @@\n from datetime import datetime\n \n # è®¾ç½®é¡µé¢é…ç½®\n st.set_page_config(\n-    page_title=\"FoodSky\",\n+    page_title=\"FoodSkyè†³é£Ÿæ¨è\",\n     page_icon=\"ğŸ²\",\n     layout=\"wide\",\n     initial_sidebar_state=\"expanded\"\n )\n"
                },
                {
                    "date": 1752478534110,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -129,9 +129,9 @@\n \n # åº”ç”¨æ ‡é¢˜\n st.markdown(\"\"\"\n <div class=\"header\">\n-    <h1 style=\"text-align:center; margin:0;\">ğŸ² æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n+    <h1 style=\"text-align:center; margin:0;\">ğŸ²FoodSkyè†³é£Ÿæ¨è</h1>\n     <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n </div>\n \"\"\", unsafe_allow_html=True)\n \n"
                },
                {
                    "date": 1752478554165,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -130,9 +130,9 @@\n # åº”ç”¨æ ‡é¢˜\n st.markdown(\"\"\"\n <div class=\"header\">\n     <h1 style=\"text-align:center; margin:0;\">ğŸ²FoodSkyè†³é£Ÿæ¨è</h1>\n-    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n+    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºFoodSkyï¼Œç”±ä¸­ç§‘æ·±å¥ç ”å‘çš„é£Ÿå“å¤§æ¨¡å‹æ¨è</p>\n </div>\n \"\"\", unsafe_allow_html=True)\n \n # åç«¯æœåŠ¡URL\n"
                },
                {
                    "date": 1752478566134,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -130,9 +130,9 @@\n # åº”ç”¨æ ‡é¢˜\n st.markdown(\"\"\"\n <div class=\"header\">\n     <h1 style=\"text-align:center; margin:0;\">ğŸ²FoodSkyè†³é£Ÿæ¨è</h1>\n-    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºFoodSkyï¼Œç”±ä¸­ç§‘æ·±å¥ç ”å‘çš„é£Ÿå“å¤§æ¨¡å‹æ¨è</p>\n+    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºFoodSkyï¼Œç”±ä¸­ç§‘æ·±å¥ç ”å‘çš„é£Ÿå“å¤§æ¨¡å‹æ²™é—¨æ°èŒå“¦æ¨è</p>\n </div>\n \"\"\", unsafe_allow_html=True)\n \n # åç«¯æœåŠ¡URL\n"
                },
                {
                    "date": 1752478573005,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -130,9 +130,9 @@\n # åº”ç”¨æ ‡é¢˜\n st.markdown(\"\"\"\n <div class=\"header\">\n     <h1 style=\"text-align:center; margin:0;\">ğŸ²FoodSkyè†³é£Ÿæ¨è</h1>\n-    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºFoodSkyï¼Œç”±ä¸­ç§‘æ·±å¥ç ”å‘çš„é£Ÿå“å¤§æ¨¡å‹æ²™é—¨æ°èŒå“¦æ¨è</p>\n+    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºFoodSkyï¼Œç”±ä¸­ç§‘æ·±å¥ç ”å‘çš„é£Ÿå“å¤§æ¨¡å‹è†³é£Ÿæ¨è</p>\n </div>\n \"\"\", unsafe_allow_html=True)\n \n # åç«¯æœåŠ¡URL\n"
                },
                {
                    "date": 1752478877312,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -235,16 +235,37 @@\n         st.error(f\"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}\")\n     \n     return False\n \n-# å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n+# ä¿®å¤åçš„ä»£ç  - å°†æ‰€æœ‰æ•°å€¼å‚æ•°ç»Ÿä¸€ä¸ºæµ®ç‚¹æ•°\n+\n+# åœ¨å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥éƒ¨åˆ†\n with st.sidebar:\n     st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n     with st.container():\n         st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n         st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n-        st.number_input(\"èº«é«˜ (cm)\", min_value=50, max_value=250, key=\"height\", value=175)\n-        st.number_input(\"ä½“é‡ (kg)\", min_value=10, max_value=200, key=\"weight\", value=65.5)\n+        \n+        # ä¿®å¤èº«é«˜è¾“å…¥ - ç»Ÿä¸€ä¸ºæµ®ç‚¹æ•°\n+        st.number_input(\n+            \"èº«é«˜ (cm)\", \n+            min_value=50.0,  # æ”¹ä¸ºæµ®ç‚¹æ•°\n+            max_value=250.0, # æ”¹ä¸ºæµ®ç‚¹æ•°\n+            key=\"height\", \n+            value=175.0,     # æ”¹ä¸ºæµ®ç‚¹æ•°\n+            step=1.0         # æ·»åŠ æ­¥é•¿å‚æ•°\n+        )\n+        \n+        # ä¿®å¤ä½“é‡è¾“å…¥ - ç»Ÿä¸€ä¸ºæµ®ç‚¹æ•°\n+        st.number_input(\n+            \"ä½“é‡ (kg)\", \n+            min_value=10.0,  # æ”¹ä¸ºæµ®ç‚¹æ•°\n+            max_value=200.0, # æ”¹ä¸ºæµ®ç‚¹æ•°\n+            key=\"weight\", \n+            value=65.5,      # ä¿æŒæµ®ç‚¹æ•°\n+            step=0.1          # æ·»åŠ æ­¥é•¿å‚æ•°\n+        )\n+        \n         st.selectbox(\n             \"æ´»åŠ¨æ°´å¹³\", \n             [\"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\", \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\", \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\"], \n             key=\"activity_level\",\n@@ -256,11 +277,9 @@\n             key=\"meal_type\",\n             index=1\n         )\n \n-# ä¸»å†…å®¹åŒº\n-col1, col2 = st.columns([1, 1])\n-\n+# åœ¨èœå“è¾“å…¥éƒ¨åˆ†\n with col1:\n     # èœå“è¾“å…¥éƒ¨åˆ†\n     st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n     with st.container():\n@@ -274,13 +293,15 @@\n                         key=f\"dish_name_{i}\",\n                         placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n                     )\n                 with col_b:\n+                    # ä¿®å¤èœå“é‡é‡è¾“å…¥ - ç»Ÿä¸€ä¸ºæµ®ç‚¹æ•°\n                     dish_weight = st.number_input(\n                         \"é‡é‡ (g)\", \n-                        min_value=1, \n+                        min_value=1.0,  # æ”¹ä¸ºæµ®ç‚¹æ•°\n                         value=dish[\"weight\"],\n-                        key=f\"dish_weight_{i}\"\n+                        key=f\"dish_weight_{i}\",\n+                        step=1.0         # æ·»åŠ æ­¥é•¿å‚æ•°\n                     )\n                 \n                 # æ›´æ–°session state\n                 st.session_state.dishes[i][\"name\"] = dish_name\n@@ -288,19 +309,8 @@\n                 \n                 # åˆ é™¤æŒ‰é’®ï¼ˆä¸æ˜¯ç¬¬ä¸€ä¸ªèœå“æ—¶æ˜¾ç¤ºï¼‰\n                 if i > 0:\n                     st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n-        \n-        # æ·»åŠ èœå“æŒ‰é’®\n-        st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n-        \n-        # æäº¤æŒ‰é’®\n-        if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n-            if submit_form():\n-                if call_backend_service():\n-                    st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n-                else:\n-                    st.session_state.recommendations = None\n \n with col2:\n     # ç»“æœæ˜¾ç¤ºéƒ¨åˆ†\n     st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n"
                },
                {
                    "date": 1752478890052,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -235,37 +235,16 @@\n         st.error(f\"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}\")\n     \n     return False\n \n-# ä¿®å¤åçš„ä»£ç  - å°†æ‰€æœ‰æ•°å€¼å‚æ•°ç»Ÿä¸€ä¸ºæµ®ç‚¹æ•°\n-\n-# åœ¨å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥éƒ¨åˆ†\n+# å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n with st.sidebar:\n     st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n     with st.container():\n         st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n         st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n-        \n-        # ä¿®å¤èº«é«˜è¾“å…¥ - ç»Ÿä¸€ä¸ºæµ®ç‚¹æ•°\n-        st.number_input(\n-            \"èº«é«˜ (cm)\", \n-            min_value=50.0,  # æ”¹ä¸ºæµ®ç‚¹æ•°\n-            max_value=250.0, # æ”¹ä¸ºæµ®ç‚¹æ•°\n-            key=\"height\", \n-            value=175.0,     # æ”¹ä¸ºæµ®ç‚¹æ•°\n-            step=1.0         # æ·»åŠ æ­¥é•¿å‚æ•°\n-        )\n-        \n-        # ä¿®å¤ä½“é‡è¾“å…¥ - ç»Ÿä¸€ä¸ºæµ®ç‚¹æ•°\n-        st.number_input(\n-            \"ä½“é‡ (kg)\", \n-            min_value=10.0,  # æ”¹ä¸ºæµ®ç‚¹æ•°\n-            max_value=200.0, # æ”¹ä¸ºæµ®ç‚¹æ•°\n-            key=\"weight\", \n-            value=65.5,      # ä¿æŒæµ®ç‚¹æ•°\n-            step=0.1          # æ·»åŠ æ­¥é•¿å‚æ•°\n-        )\n-        \n+        st.number_input(\"èº«é«˜ (cm)\", min_value=50, max_value=250, key=\"height\", value=175)\n+        st.number_input(\"ä½“é‡ (kg)\", min_value=10, max_value=200, key=\"weight\", value=65.5)\n         st.selectbox(\n             \"æ´»åŠ¨æ°´å¹³\", \n             [\"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\", \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\", \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\"], \n             key=\"activity_level\",\n@@ -277,9 +256,11 @@\n             key=\"meal_type\",\n             index=1\n         )\n \n-# åœ¨èœå“è¾“å…¥éƒ¨åˆ†\n+# ä¸»å†…å®¹åŒº\n+col1, col2 = st.columns([1, 1])\n+\n with col1:\n     # èœå“è¾“å…¥éƒ¨åˆ†\n     st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n     with st.container():\n@@ -293,15 +274,13 @@\n                         key=f\"dish_name_{i}\",\n                         placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n                     )\n                 with col_b:\n-                    # ä¿®å¤èœå“é‡é‡è¾“å…¥ - ç»Ÿä¸€ä¸ºæµ®ç‚¹æ•°\n                     dish_weight = st.number_input(\n                         \"é‡é‡ (g)\", \n-                        min_value=1.0,  # æ”¹ä¸ºæµ®ç‚¹æ•°\n+                        min_value=1, \n                         value=dish[\"weight\"],\n-                        key=f\"dish_weight_{i}\",\n-                        step=1.0         # æ·»åŠ æ­¥é•¿å‚æ•°\n+                        key=f\"dish_weight_{i}\"\n                     )\n                 \n                 # æ›´æ–°session state\n                 st.session_state.dishes[i][\"name\"] = dish_name\n@@ -309,8 +288,19 @@\n                 \n                 # åˆ é™¤æŒ‰é’®ï¼ˆä¸æ˜¯ç¬¬ä¸€ä¸ªèœå“æ—¶æ˜¾ç¤ºï¼‰\n                 if i > 0:\n                     st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n+        \n+        # æ·»åŠ èœå“æŒ‰é’®\n+        st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n+        \n+        # æäº¤æŒ‰é’®\n+        if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n+            if submit_form():\n+                if call_backend_service():\n+                    st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n+                else:\n+                    st.session_state.recommendations = None\n \n with col2:\n     # ç»“æœæ˜¾ç¤ºéƒ¨åˆ†\n     st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n"
                },
                {
                    "date": 1752478939099,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -236,15 +236,52 @@\n     \n     return False\n \n # å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n+# åˆå§‹åŒ–session state\n+if 'dishes' not in st.session_state:\n+    st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]  # æ”¹ä¸ºæµ®ç‚¹æ•°\n+\n+if 'recommendations' not in st.session_state:\n+    st.session_state.recommendations = None\n+\n+if 'request_data' not in st.session_state:\n+    st.session_state.request_data = None\n+\n+if 'response_time' not in st.session_state:\n+    st.session_state.response_time = None\n+\n+# æ·»åŠ èœå“\n+def add_dish():\n+    st.session_state.dishes.append({\"name\": \"\", \"weight\": 100.0})  # æ”¹ä¸ºæµ®ç‚¹æ•°\n+\n+# åœ¨å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥éƒ¨åˆ†\n with st.sidebar:\n     st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n     with st.container():\n         st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n         st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n-        st.number_input(\"èº«é«˜ (cm)\", min_value=50, max_value=250, key=\"height\", value=175)\n-        st.number_input(\"ä½“é‡ (kg)\", min_value=10, max_value=200, key=\"weight\", value=65.5)\n+        \n+        # ä¿®å¤èº«é«˜è¾“å…¥\n+        st.number_input(\n+            \"èº«é«˜ (cm)\", \n+            min_value=50.0, \n+            max_value=250.0, \n+            key=\"height\", \n+            value=175.0,\n+            step=1.0\n+        )\n+        \n+        # ä¿®å¤ä½“é‡è¾“å…¥\n+        st.number_input(\n+            \"ä½“é‡ (kg)\", \n+            min_value=10.0, \n+            max_value=200.0, \n+            key=\"weight\", \n+            value=65.5,\n+            step=0.1\n+        )\n+        \n         st.selectbox(\n             \"æ´»åŠ¨æ°´å¹³\", \n             [\"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\", \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\", \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\"], \n             key=\"activity_level\",\n@@ -256,8 +293,40 @@\n             key=\"meal_type\",\n             index=1\n         )\n \n+# åœ¨èœå“è¾“å…¥éƒ¨åˆ†\n+with col1:\n+    st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n+    with st.container():\n+        for i, dish in enumerate(st.session_state.dishes):\n+            with st.container():\n+                col_a, col_b = st.columns([3, 1])\n+                with col_a:\n+                    dish_name = st.text_input(\n+                        f\"èœå“ #{i+1} åç§°\", \n+                        value=dish[\"name\"],\n+                        key=f\"dish_name_{i}\",\n+                        placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n+                    )\n+                with col_b:\n+                    # ä¿®å¤èœå“é‡é‡è¾“å…¥\n+                    dish_weight = st.number_input(\n+                        \"é‡é‡ (g)\", \n+                        min_value=1.0, \n+                        value=dish[\"weight\"],\n+                        key=f\"dish_weight_{i}\",\n+                        step=1.0\n+                    )\n+                \n+                # æ›´æ–°session state\n+                st.session_state.dishes[i][\"name\"] = dish_name\n+                st.session_state.dishes[i][\"weight\"] = dish_weight\n+                \n+                # åˆ é™¤æŒ‰é’®\n+                if i > 0:\n+                    st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n+\n # ä¸»å†…å®¹åŒº\n col1, col2 = st.columns([1, 1])\n \n with col1:\n"
                },
                {
                    "date": 1752478947167,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -328,49 +328,10 @@\n \n # ä¸»å†…å®¹åŒº\n col1, col2 = st.columns([1, 1])\n \n-with col1:\n-    # èœå“è¾“å…¥éƒ¨åˆ†\n-    st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n-    with st.container():\n-        for i, dish in enumerate(st.session_state.dishes):\n-            with st.container():\n-                col_a, col_b = st.columns([3, 1])\n-                with col_a:\n-                    dish_name = st.text_input(\n-                        f\"èœå“ #{i+1} åç§°\", \n-                        value=dish[\"name\"],\n-                        key=f\"dish_name_{i}\",\n-                        placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n-                    )\n-                with col_b:\n-                    dish_weight = st.number_input(\n-                        \"é‡é‡ (g)\", \n-                        min_value=1, \n-                        value=dish[\"weight\"],\n-                        key=f\"dish_weight_{i}\"\n-                    )\n-                \n-                # æ›´æ–°session state\n-                st.session_state.dishes[i][\"name\"] = dish_name\n-                st.session_state.dishes[i][\"weight\"] = dish_weight\n-                \n-                # åˆ é™¤æŒ‰é’®ï¼ˆä¸æ˜¯ç¬¬ä¸€ä¸ªèœå“æ—¶æ˜¾ç¤ºï¼‰\n-                if i > 0:\n-                    st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n-        \n-        # æ·»åŠ èœå“æŒ‰é’®\n-        st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n-        \n-        # æäº¤æŒ‰é’®\n-        if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n-            if submit_form():\n-                if call_backend_service():\n-                    st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n-                else:\n-                    st.session_state.recommendations = None\n \n+\n with col2:\n     # ç»“æœæ˜¾ç¤ºéƒ¨åˆ†\n     st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n     \n"
                },
                {
                    "date": 1752478952436,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -325,13 +325,12 @@\n                 # åˆ é™¤æŒ‰é’®\n                 if i > 0:\n                     st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n \n-# ä¸»å†…å®¹åŒº\n-col1, col2 = st.columns([1, 1])\n \n \n \n+\n with col2:\n     # ç»“æœæ˜¾ç¤ºéƒ¨åˆ†\n     st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n     \n"
                },
                {
                    "date": 1752478965891,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -292,9 +292,10 @@\n             [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], \n             key=\"meal_type\",\n             index=1\n         )\n-\n+# ä¸»å†…å®¹åŒº\n+col1, col2 = st.columns([1, 1])\n # åœ¨èœå“è¾“å…¥éƒ¨åˆ†\n with col1:\n     st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n     with st.container():\n"
                },
                {
                    "date": 1752478994831,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -293,9 +293,9 @@\n             key=\"meal_type\",\n             index=1\n         )\n # ä¸»å†…å®¹åŒº\n-col1, col2 = st.columns([1, 1])\n+# col1, col2 = st.columns([1, 1])\n # åœ¨èœå“è¾“å…¥éƒ¨åˆ†\n with col1:\n     st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n     with st.container():\n"
                },
                {
                    "date": 1752479029848,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,141 +7,35 @@\n from datetime import datetime\n \n # è®¾ç½®é¡µé¢é…ç½®\n st.set_page_config(\n-    page_title=\"FoodSkyè†³é£Ÿæ¨è\",\n+    page_title=\"æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n     page_icon=\"ğŸ²\",\n     layout=\"wide\",\n     initial_sidebar_state=\"expanded\"\n )\n \n-# è‡ªå®šä¹‰CSSæ ·å¼\n+# è‡ªå®šä¹‰CSSæ ·å¼ï¼ˆä¿æŒä¸å˜ï¼‰\n st.markdown(\"\"\"\n <style>\n-    .stApp {\n-        background-color: #f5f7fa;\n-    }\n-    .header {\n-        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);\n-        color: white;\n-        padding: 2rem;\n-        border-radius: 0 0 20px 20px;\n-        margin-bottom: 2rem;\n-    }\n-    .section {\n-        background: white;\n-        border-radius: 15px;\n-        padding: 1.5rem;\n-        box-shadow: 0 4px 10px rgba(0,0,0,0.05);\n-        margin-bottom: 1.5rem;\n-    }\n-    .dish-card {\n-        border: 1px solid #e0e6ed;\n-        border-radius: 10px;\n-        padding: 1rem;\n-        margin-bottom: 1rem;\n-        background: #f9fbfd;\n-    }\n-    .recommendation-card {\n-        border-radius: 10px;\n-        padding: 1rem;\n-        margin-bottom: 1rem;\n-        box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n-    }\n-    .high-weight {\n-        background: #d4f7e2;\n-        border-left: 4px solid #2ecc71;\n-    }\n-    .medium-weight {\n-        background: #fef5e7;\n-        border-left: 4px solid #f39c12;\n-    }\n-    .low-weight {\n-        background: #fce8e6;\n-        border-left: 4px solid #e74c3c;\n-    }\n-    .submit-btn {\n-        width: 100%;\n-        padding: 0.75rem;\n-        border-radius: 8px;\n-        background: #3498db;\n-        color: white;\n-        font-weight: bold;\n-        border: none;\n-        cursor: pointer;\n-        transition: background 0.3s;\n-    }\n-    .submit-btn:hover {\n-        background: #2980b9;\n-    }\n-    .add-btn {\n-        background: #2ecc71;\n-        color: white;\n-        border: none;\n-        border-radius: 5px;\n-        padding: 0.5rem 1rem;\n-        cursor: pointer;\n-        transition: background 0.3s;\n-    }\n-    .add-btn:hover {\n-        background: #27ae60;\n-    }\n-    .remove-btn {\n-        background: #e74c3c;\n-        color: white;\n-        border: none;\n-        border-radius: 5px;\n-        padding: 0.25rem 0.75rem;\n-        cursor: pointer;\n-        margin-left: 0.5rem;\n-    }\n-    .spinner {\n-        display: inline-block;\n-        width: 20px;\n-        height: 20px;\n-        border: 3px solid rgba(0,0,0,0.1);\n-        border-radius: 50%;\n-        border-top-color: #3498db;\n-        animation: spin 1s linear infinite;\n-        margin-right: 10px;\n-    }\n-    @keyframes spin {\n-        0% { transform: rotate(0deg); }\n-        100% { transform: rotate(360deg); }\n-    }\n-    .nutrient-bar {\n-        height: 10px;\n-        border-radius: 5px;\n-        margin-top: 5px;\n-        background: #e0e0e0;\n-    }\n-    .nutrient-fill {\n-        height: 100%;\n-        border-radius: 5px;\n-        background: #3498db;\n-    }\n-    .nutrient-value {\n-        font-size: 0.9rem;\n-        margin-top: 3px;\n-        text-align: right;\n-    }\n+    /* ä¿ç•™æ‰€æœ‰CSSæ ·å¼ */\n </style>\n \"\"\", unsafe_allow_html=True)\n \n-# åº”ç”¨æ ‡é¢˜\n+# åº”ç”¨æ ‡é¢˜ï¼ˆä¿æŒä¸å˜ï¼‰\n st.markdown(\"\"\"\n <div class=\"header\">\n-    <h1 style=\"text-align:center; margin:0;\">ğŸ²FoodSkyè†³é£Ÿæ¨è</h1>\n-    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºFoodSkyï¼Œç”±ä¸­ç§‘æ·±å¥ç ”å‘çš„é£Ÿå“å¤§æ¨¡å‹è†³é£Ÿæ¨è</p>\n+    <h1 style=\"text-align:center; margin:0;\">ğŸ² æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n+    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n </div>\n \"\"\", unsafe_allow_html=True)\n \n # åç«¯æœåŠ¡URL\n BACKEND_URL = \"http://192.168.99.55:5000/recommend_dishes\"\n \n # åˆå§‹åŒ–session state\n if 'dishes' not in st.session_state:\n-    st.session_state.dishes = [{\"name\": \"\", \"weight\": 100}]\n+    st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]\n \n if 'recommendations' not in st.session_state:\n     st.session_state.recommendations = None\n \n@@ -152,9 +46,9 @@\n     st.session_state.response_time = None\n \n # æ·»åŠ èœå“\n def add_dish():\n-    st.session_state.dishes.append({\"name\": \"\", \"weight\": 100})\n+    st.session_state.dishes.append({\"name\": \"\", \"weight\": 100.0})\n \n # åˆ é™¤èœå“\n def remove_dish(index):\n     if len(st.session_state.dishes) > 1:\n@@ -174,310 +68,5 @@\n             st.error(f\"èœå“ #{i+1} åç§°ä¸èƒ½ä¸ºç©º\")\n             return False\n         if dish[\"weight\"] <= 0:\n             st.error(f\"èœå“ #{i+1} é‡é‡å¿…é¡»å¤§äº0\")\n-            return False\n-    \n-    return True\n-\n-# è°ƒç”¨åç«¯æœåŠ¡\n-def call_backend_service():\n-    # å‡†å¤‡è¯·æ±‚æ•°æ®\n-    st.session_state.request_data = {\n-        \"info\": {\n-            \"æ€§åˆ«\": st.session_state.gender,\n-            \"å¹´é¾„\": st.session_state.age,\n-            \"èº«é«˜\": st.session_state.height,\n-            \"ä½“é‡\": st.session_state.weight,\n-            \"activity_level\": st.session_state.activity_level\n-        },\n-        \"data\": {\n-            \"é¤åˆ«\": st.session_state.meal_type,\n-            \"èœå“åç§°\": [\n-                {\n-                    \"é£Ÿå“åç§°\": dish[\"name\"],\n-                    \"é£Ÿå“å…‹æ•°\": dish[\"weight\"]\n-                } for dish in st.session_state.dishes\n-            ]\n-        }\n-    }\n-    \n-    try:\n-        # æ˜¾ç¤ºåŠ è½½çŠ¶æ€\n-        with st.spinner(\"æ­£åœ¨åˆ†ææ‚¨çš„è¥å…»éœ€æ±‚ï¼Œè¯·ç¨å€™...\"):\n-            start_time = time.time()\n-            \n-            # å‘é€è¯·æ±‚\n-            response = requests.post(\n-                BACKEND_URL,\n-                json=st.session_state.request_data,\n-                timeout=120  # 120ç§’è¶…æ—¶\n-            )\n-            \n-            end_time = time.time()\n-            st.session_state.response_time = end_time - start_time\n-            \n-            # æ£€æŸ¥å“åº”çŠ¶æ€\n-            if response.status_code == 200:\n-                data = response.json()\n-                if data.get(\"success\"):\n-                    st.session_state.recommendations = data[\"result\"]\n-                    return True\n-                else:\n-                    st.error(f\"æœåŠ¡è¿”å›é”™è¯¯: {data.get('error', 'æœªçŸ¥é”™è¯¯')}\")\n-            else:\n-                st.error(f\"è¯·æ±‚å¤±è´¥, çŠ¶æ€ç : {response.status_code}\")\n-                st.error(f\"é”™è¯¯ä¿¡æ¯: {response.text}\")\n-    except requests.exceptions.Timeout:\n-        st.error(\"è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•\")\n-    except requests.exceptions.ConnectionError:\n-        st.error(\"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\")\n-    except Exception as e:\n-        st.error(f\"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}\")\n-    \n-    return False\n-\n-# å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n-# åˆå§‹åŒ–session state\n-if 'dishes' not in st.session_state:\n-    st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]  # æ”¹ä¸ºæµ®ç‚¹æ•°\n-\n-if 'recommendations' not in st.session_state:\n-    st.session_state.recommendations = None\n-\n-if 'request_data' not in st.session_state:\n-    st.session_state.request_data = None\n-\n-if 'response_time' not in st.session_state:\n-    st.session_state.response_time = None\n-\n-# æ·»åŠ èœå“\n-def add_dish():\n-    st.session_state.dishes.append({\"name\": \"\", \"weight\": 100.0})  # æ”¹ä¸ºæµ®ç‚¹æ•°\n-\n-# åœ¨å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥éƒ¨åˆ†\n-with st.sidebar:\n-    st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n-    with st.container():\n-        st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n-        st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n-        \n-        # ä¿®å¤èº«é«˜è¾“å…¥\n-        st.number_input(\n-            \"èº«é«˜ (cm)\", \n-            min_value=50.0, \n-            max_value=250.0, \n-            key=\"height\", \n-            value=175.0,\n-            step=1.0\n-        )\n-        \n-        # ä¿®å¤ä½“é‡è¾“å…¥\n-        st.number_input(\n-            \"ä½“é‡ (kg)\", \n-            min_value=10.0, \n-            max_value=200.0, \n-            key=\"weight\", \n-            value=65.5,\n-            step=0.1\n-        )\n-        \n-        st.selectbox(\n-            \"æ´»åŠ¨æ°´å¹³\", \n-            [\"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\", \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\", \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\"], \n-            key=\"activity_level\",\n-            index=1\n-        )\n-        st.selectbox(\n-            \"é¤åˆ«\", \n-            [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], \n-            key=\"meal_type\",\n-            index=1\n-        )\n-# ä¸»å†…å®¹åŒº\n-# col1, col2 = st.columns([1, 1])\n-# åœ¨èœå“è¾“å…¥éƒ¨åˆ†\n-with col1:\n-    st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n-    with st.container():\n-        for i, dish in enumerate(st.session_state.dishes):\n-            with st.container():\n-                col_a, col_b = st.columns([3, 1])\n-                with col_a:\n-                    dish_name = st.text_input(\n-                        f\"èœå“ #{i+1} åç§°\", \n-                        value=dish[\"name\"],\n-                        key=f\"dish_name_{i}\",\n-                        placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n-                    )\n-                with col_b:\n-                    # ä¿®å¤èœå“é‡é‡è¾“å…¥\n-                    dish_weight = st.number_input(\n-                        \"é‡é‡ (g)\", \n-                        min_value=1.0, \n-                        value=dish[\"weight\"],\n-                        key=f\"dish_weight_{i}\",\n-                        step=1.0\n-                    )\n-                \n-                # æ›´æ–°session state\n-                st.session_state.dishes[i][\"name\"] = dish_name\n-                st.session_state.dishes[i][\"weight\"] = dish_weight\n-                \n-                # åˆ é™¤æŒ‰é’®\n-                if i > 0:\n-                    st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n-\n-\n-\n-\n-\n-with col2:\n-    # ç»“æœæ˜¾ç¤ºéƒ¨åˆ†\n-    st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n-    \n-    if st.session_state.recommendations:\n-        recommendations = st.session_state.recommendations\n-        \n-        # æ˜¾ç¤ºè¯·æ±‚ä¿¡æ¯\n-        st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n-        \n-        # æ˜¾ç¤ºé¤åˆ«å’Œæ±‚è§£çŠ¶æ€\n-        st.markdown(f\"**é¤åˆ«**: {recommendations.get('é¤åˆ«', 'åˆé¤')}\")\n-        st.markdown(f\"**æ±‚è§£çŠ¶æ€**: {recommendations.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n-        \n-        # æ˜¾ç¤ºèœå“æ¨è\n-        st.markdown(\"### èœå“æ¨è\")\n-        \n-        # åˆ›å»ºé€‰é¡¹å¡\n-        tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n-        \n-        with tab1:\n-            for dish in recommendations.get(\"èœå“æ¨è\", []):\n-                weight = dish.get(\"æ¨èæƒé‡\", 0)\n-                \n-                # æ ¹æ®æƒé‡è®¾ç½®æ ·å¼\n-                if weight >= 0.7:\n-                    card_class = \"high-weight\"\n-                    recommendation_text = \"å¼ºçƒˆæ¨è\"\n-                elif weight >= 0.5:\n-                    card_class = \"medium-weight\"\n-                    recommendation_text = \"æ¨è\"\n-                elif weight >= 0.3:\n-                    card_class = \"medium-weight\"\n-                    recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n-                else:\n-                    card_class = \"low-weight\"\n-                    recommendation_text = \"å°‘é‡å°è¯•\"\n-                \n-                with st.container():\n-                    st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n-                    \n-                    # èœå“åç§°å’Œæƒé‡\n-                    col1, col2 = st.columns([3, 1])\n-                    with col1:\n-                        st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n-                    with col2:\n-                        st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n-                    \n-                    # æ¨èåŸå› \n-                    st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n-                    \n-                    # è¥å…»å€¼æ‘˜è¦\n-                    with st.expander(\"æŸ¥çœ‹è¥å…»è¯¦æƒ…\"):\n-                        nutrition = dish.get(\"è¥å…»å€¼\", {})\n-                        if nutrition:\n-                            col1, col2, col3 = st.columns(3)\n-                            with col1:\n-                                st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                                st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                            with col2:\n-                                st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-                                st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                            with col3:\n-                                st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n-                                st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n-                        else:\n-                            st.warning(\"æ— è¥å…»æ•°æ®\")\n-                    \n-                    st.markdown(\"</div>\", unsafe_allow_html=True)\n-        \n-        with tab2:\n-            # æ•´é¤è¥å…»æ‘˜è¦\n-            total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n-            if total_nutrition:\n-                st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n-                \n-                # åˆ›å»ºè¥å…»æŒ‡æ ‡å¡ç‰‡\n-                col1, col2, col3 = st.columns(3)\n-                with col1:\n-                    st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                    st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                with col2:\n-                    st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-                    st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                with col3:\n-                    st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n-                    st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n-                \n-                # è¥å…»åˆ†å¸ƒå›¾è¡¨\n-                st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n-                \n-                # ä¸»è¦è¥å…»ç´ \n-                main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n-                main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n-                \n-                # åˆ›å»ºDataFrame\n-                df = pd.DataFrame({\n-                    \"è¥å…»ç´ \": main_nutrients,\n-                    \"å«é‡\": main_values\n-                })\n-                \n-                # æ˜¾ç¤ºæŸ±çŠ¶å›¾\n-                st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n-                \n-                # å¾®é‡è¥å…»ç´ \n-                micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n-                micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n-                \n-                # æ˜¾ç¤ºå¾®é‡è¥å…»ç´ \n-                st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n-                for nutrient, value in zip(micro_nutrients, micro_values):\n-                    st.markdown(f\"**{nutrient}**: {value:.1f}\")\n-                    # æ·»åŠ ç®€å•çš„è¿›åº¦æ¡\n-                    max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n-                    percent = min(value / max_value, 1.0) if max_value > 0 else 0\n-                    st.markdown(f\"\"\"\n-                    <div class=\"nutrient-bar\">\n-                        <div class=\"nutrient-fill\" style=\"width: {percent*100}%;\"></div>\n-                    </div>\n-                    <div class=\"nutrient-value\">{value:.1f}</div>\n-                    \"\"\", unsafe_allow_html=True)\n-            else:\n-                st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n-    else:\n-        st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n-\n-# æ·»åŠ ä¸€äº›è¯´æ˜\n-st.markdown(\"---\")\n-st.markdown(\"\"\"\n-### ä½¿ç”¨è¯´æ˜\n-1. åœ¨å·¦ä¾§å¡«å†™æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰ï¼‰\n-2. æ·»åŠ æ‚¨æƒ³è¯„ä¼°çš„èœå“ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰\n-3. ç‚¹å‡»\"ç”Ÿæˆèœå“æ¨è\"æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\n-4. æŸ¥çœ‹å³ä¾§çš„æ¨èç»“æœï¼Œäº†è§£æ¯é“èœçš„æ¨èç¨‹åº¦å’ŒåŸå› \n-\n-**æ¨èæƒé‡è¯´æ˜**:\n-- **å¼ºçƒˆæ¨è (æƒé‡ â‰¥ 0.7)**: è¥å…»å‡è¡¡ä¸”ç¬¦åˆéœ€æ±‚\n-- **æ¨è (0.5 â‰¤ æƒé‡ < 0.7)**: è¥å…»è‰¯å¥½ï¼Œé€‚åˆé£Ÿç”¨\n-- **é€‚é‡é£Ÿç”¨ (0.3 â‰¤ æƒé‡ < 0.5)**: å¯ä»¥å°‘é‡é£Ÿç”¨\n-- **å°‘é‡å°è¯• (æƒé‡ < 0.3)**: å»ºè®®æœ¬é¤é¿å…æˆ–å°‘é‡å°è¯•\n-\"\"\")\n-\n-# è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰\n-if st.checkbox(\"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯\"):\n-    st.markdown(\"### è¯·æ±‚æ•°æ®\")\n-    st.json(st.session_state.request_data)\n-    \n-    if st.session_state.recommendations:\n-        st.markdown(\"### å®Œæ•´å“åº”\")\n-        st.json(st.session_state.recommendations)\n\\ No newline at end of file\n+            retu\n\\ No newline at end of file\n"
                },
                {
                    "date": 1752479039255,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,35 +7,141 @@\n from datetime import datetime\n \n # è®¾ç½®é¡µé¢é…ç½®\n st.set_page_config(\n-    page_title=\"æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n+    page_title=\"FoodSkyè†³é£Ÿæ¨è\",\n     page_icon=\"ğŸ²\",\n     layout=\"wide\",\n     initial_sidebar_state=\"expanded\"\n )\n \n-# è‡ªå®šä¹‰CSSæ ·å¼ï¼ˆä¿æŒä¸å˜ï¼‰\n+# è‡ªå®šä¹‰CSSæ ·å¼\n st.markdown(\"\"\"\n <style>\n-    /* ä¿ç•™æ‰€æœ‰CSSæ ·å¼ */\n+    .stApp {\n+        background-color: #f5f7fa;\n+    }\n+    .header {\n+        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);\n+        color: white;\n+        padding: 2rem;\n+        border-radius: 0 0 20px 20px;\n+        margin-bottom: 2rem;\n+    }\n+    .section {\n+        background: white;\n+        border-radius: 15px;\n+        padding: 1.5rem;\n+        box-shadow: 0 4px 10px rgba(0,0,0,0.05);\n+        margin-bottom: 1.5rem;\n+    }\n+    .dish-card {\n+        border: 1px solid #e0e6ed;\n+        border-radius: 10px;\n+        padding: 1rem;\n+        margin-bottom: 1rem;\n+        background: #f9fbfd;\n+    }\n+    .recommendation-card {\n+        border-radius: 10px;\n+        padding: 1rem;\n+        margin-bottom: 1rem;\n+        box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n+    }\n+    .high-weight {\n+        background: #d4f7e2;\n+        border-left: 4px solid #2ecc71;\n+    }\n+    .medium-weight {\n+        background: #fef5e7;\n+        border-left: 4px solid #f39c12;\n+    }\n+    .low-weight {\n+        background: #fce8e6;\n+        border-left: 4px solid #e74c3c;\n+    }\n+    .submit-btn {\n+        width: 100%;\n+        padding: 0.75rem;\n+        border-radius: 8px;\n+        background: #3498db;\n+        color: white;\n+        font-weight: bold;\n+        border: none;\n+        cursor: pointer;\n+        transition: background 0.3s;\n+    }\n+    .submit-btn:hover {\n+        background: #2980b9;\n+    }\n+    .add-btn {\n+        background: #2ecc71;\n+        color: white;\n+        border: none;\n+        border-radius: 5px;\n+        padding: 0.5rem 1rem;\n+        cursor: pointer;\n+        transition: background 0.3s;\n+    }\n+    .add-btn:hover {\n+        background: #27ae60;\n+    }\n+    .remove-btn {\n+        background: #e74c3c;\n+        color: white;\n+        border: none;\n+        border-radius: 5px;\n+        padding: 0.25rem 0.75rem;\n+        cursor: pointer;\n+        margin-left: 0.5rem;\n+    }\n+    .spinner {\n+        display: inline-block;\n+        width: 20px;\n+        height: 20px;\n+        border: 3px solid rgba(0,0,0,0.1);\n+        border-radius: 50%;\n+        border-top-color: #3498db;\n+        animation: spin 1s linear infinite;\n+        margin-right: 10px;\n+    }\n+    @keyframes spin {\n+        0% { transform: rotate(0deg); }\n+        100% { transform: rotate(360deg); }\n+    }\n+    .nutrient-bar {\n+        height: 10px;\n+        border-radius: 5px;\n+        margin-top: 5px;\n+        background: #e0e0e0;\n+    }\n+    .nutrient-fill {\n+        height: 100%;\n+        border-radius: 5px;\n+        background: #3498db;\n+    }\n+    .nutrient-value {\n+        font-size: 0.9rem;\n+        margin-top: 3px;\n+        text-align: right;\n+    }\n </style>\n \"\"\", unsafe_allow_html=True)\n \n-# åº”ç”¨æ ‡é¢˜ï¼ˆä¿æŒä¸å˜ï¼‰\n+# åº”ç”¨æ ‡é¢˜\n st.markdown(\"\"\"\n <div class=\"header\">\n-    <h1 style=\"text-align:center; margin:0;\">ğŸ² æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n-    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n+    <h1 style=\"text-align:center; margin:0;\">ğŸ²FoodSkyè†³é£Ÿæ¨è</h1>\n+    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºFoodSkyï¼Œç”±ä¸­ç§‘æ·±å¥ç ”å‘çš„é£Ÿå“å¤§æ¨¡å‹è†³é£Ÿæ¨è</p>\n </div>\n \"\"\", unsafe_allow_html=True)\n \n # åç«¯æœåŠ¡URL\n BACKEND_URL = \"http://192.168.99.55:5000/recommend_dishes\"\n \n # åˆå§‹åŒ–session state\n if 'dishes' not in st.session_state:\n-    st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]\n+    st.session_state.dishes = [{\"name\": \"\", \"weight\": 100}]\n \n if 'recommendations' not in st.session_state:\n     st.session_state.recommendations = None\n \n@@ -46,9 +152,9 @@\n     st.session_state.response_time = None\n \n # æ·»åŠ èœå“\n def add_dish():\n-    st.session_state.dishes.append({\"name\": \"\", \"weight\": 100.0})\n+    st.session_state.dishes.append({\"name\": \"\", \"weight\": 100})\n \n # åˆ é™¤èœå“\n def remove_dish(index):\n     if len(st.session_state.dishes) > 1:\n@@ -68,5 +174,310 @@\n             st.error(f\"èœå“ #{i+1} åç§°ä¸èƒ½ä¸ºç©º\")\n             return False\n         if dish[\"weight\"] <= 0:\n             st.error(f\"èœå“ #{i+1} é‡é‡å¿…é¡»å¤§äº0\")\n-            retu\n\\ No newline at end of file\n+            return False\n+    \n+    return True\n+\n+# è°ƒç”¨åç«¯æœåŠ¡\n+def call_backend_service():\n+    # å‡†å¤‡è¯·æ±‚æ•°æ®\n+    st.session_state.request_data = {\n+        \"info\": {\n+            \"æ€§åˆ«\": st.session_state.gender,\n+            \"å¹´é¾„\": st.session_state.age,\n+            \"èº«é«˜\": st.session_state.height,\n+            \"ä½“é‡\": st.session_state.weight,\n+            \"activity_level\": st.session_state.activity_level\n+        },\n+        \"data\": {\n+            \"é¤åˆ«\": st.session_state.meal_type,\n+            \"èœå“åç§°\": [\n+                {\n+                    \"é£Ÿå“åç§°\": dish[\"name\"],\n+                    \"é£Ÿå“å…‹æ•°\": dish[\"weight\"]\n+                } for dish in st.session_state.dishes\n+            ]\n+        }\n+    }\n+    \n+    try:\n+        # æ˜¾ç¤ºåŠ è½½çŠ¶æ€\n+        with st.spinner(\"æ­£åœ¨åˆ†ææ‚¨çš„è¥å…»éœ€æ±‚ï¼Œè¯·ç¨å€™...\"):\n+            start_time = time.time()\n+            \n+            # å‘é€è¯·æ±‚\n+            response = requests.post(\n+                BACKEND_URL,\n+                json=st.session_state.request_data,\n+                timeout=120  # 120ç§’è¶…æ—¶\n+            )\n+            \n+            end_time = time.time()\n+            st.session_state.response_time = end_time - start_time\n+            \n+            # æ£€æŸ¥å“åº”çŠ¶æ€\n+            if response.status_code == 200:\n+                data = response.json()\n+                if data.get(\"success\"):\n+                    st.session_state.recommendations = data[\"result\"]\n+                    return True\n+                else:\n+                    st.error(f\"æœåŠ¡è¿”å›é”™è¯¯: {data.get('error', 'æœªçŸ¥é”™è¯¯')}\")\n+            else:\n+                st.error(f\"è¯·æ±‚å¤±è´¥, çŠ¶æ€ç : {response.status_code}\")\n+                st.error(f\"é”™è¯¯ä¿¡æ¯: {response.text}\")\n+    except requests.exceptions.Timeout:\n+        st.error(\"è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•\")\n+    except requests.exceptions.ConnectionError:\n+        st.error(\"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\")\n+    except Exception as e:\n+        st.error(f\"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}\")\n+    \n+    return False\n+\n+# å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n+# åˆå§‹åŒ–session state\n+if 'dishes' not in st.session_state:\n+    st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]  # æ”¹ä¸ºæµ®ç‚¹æ•°\n+\n+if 'recommendations' not in st.session_state:\n+    st.session_state.recommendations = None\n+\n+if 'request_data' not in st.session_state:\n+    st.session_state.request_data = None\n+\n+if 'response_time' not in st.session_state:\n+    st.session_state.response_time = None\n+\n+# æ·»åŠ èœå“\n+def add_dish():\n+    st.session_state.dishes.append({\"name\": \"\", \"weight\": 100.0})  # æ”¹ä¸ºæµ®ç‚¹æ•°\n+\n+# åœ¨å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥éƒ¨åˆ†\n+with st.sidebar:\n+    st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n+    with st.container():\n+        st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n+        st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n+        \n+        # ä¿®å¤èº«é«˜è¾“å…¥\n+        st.number_input(\n+            \"èº«é«˜ (cm)\", \n+            min_value=50.0, \n+            max_value=250.0, \n+            key=\"height\", \n+            value=175.0,\n+            step=1.0\n+        )\n+        \n+        # ä¿®å¤ä½“é‡è¾“å…¥\n+        st.number_input(\n+            \"ä½“é‡ (kg)\", \n+            min_value=10.0, \n+            max_value=200.0, \n+            key=\"weight\", \n+            value=65.5,\n+            step=0.1\n+        )\n+        \n+        st.selectbox(\n+            \"æ´»åŠ¨æ°´å¹³\", \n+            [\"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\", \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\", \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\"], \n+            key=\"activity_level\",\n+            index=1\n+        )\n+        st.selectbox(\n+            \"é¤åˆ«\", \n+            [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], \n+            key=\"meal_type\",\n+            index=1\n+        )\n+# ä¸»å†…å®¹åŒº\n+# col1, col2 = st.columns([1, 1])\n+# åœ¨èœå“è¾“å…¥éƒ¨åˆ†\n+with col1:\n+    st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n+    with st.container():\n+        for i, dish in enumerate(st.session_state.dishes):\n+            with st.container():\n+                col_a, col_b = st.columns([3, 1])\n+                with col_a:\n+                    dish_name = st.text_input(\n+                        f\"èœå“ #{i+1} åç§°\", \n+                        value=dish[\"name\"],\n+                        key=f\"dish_name_{i}\",\n+                        placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n+                    )\n+                with col_b:\n+                    # ä¿®å¤èœå“é‡é‡è¾“å…¥\n+                    dish_weight = st.number_input(\n+                        \"é‡é‡ (g)\", \n+                        min_value=1.0, \n+                        value=dish[\"weight\"],\n+                        key=f\"dish_weight_{i}\",\n+                        step=1.0\n+                    )\n+                \n+                # æ›´æ–°session state\n+                st.session_state.dishes[i][\"name\"] = dish_name\n+                st.session_state.dishes[i][\"weight\"] = dish_weight\n+                \n+                # åˆ é™¤æŒ‰é’®\n+                if i > 0:\n+                    st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n+\n+\n+\n+\n+\n+with col2:\n+    # ç»“æœæ˜¾ç¤ºéƒ¨åˆ†\n+    st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n+    \n+    if st.session_state.recommendations:\n+        recommendations = st.session_state.recommendations\n+        \n+        # æ˜¾ç¤ºè¯·æ±‚ä¿¡æ¯\n+        st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n+        \n+        # æ˜¾ç¤ºé¤åˆ«å’Œæ±‚è§£çŠ¶æ€\n+        st.markdown(f\"**é¤åˆ«**: {recommendations.get('é¤åˆ«', 'åˆé¤')}\")\n+        st.markdown(f\"**æ±‚è§£çŠ¶æ€**: {recommendations.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n+        \n+        # æ˜¾ç¤ºèœå“æ¨è\n+        st.markdown(\"### èœå“æ¨è\")\n+        \n+        # åˆ›å»ºé€‰é¡¹å¡\n+        tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n+        \n+        with tab1:\n+            for dish in recommendations.get(\"èœå“æ¨è\", []):\n+                weight = dish.get(\"æ¨èæƒé‡\", 0)\n+                \n+                # æ ¹æ®æƒé‡è®¾ç½®æ ·å¼\n+                if weight >= 0.7:\n+                    card_class = \"high-weight\"\n+                    recommendation_text = \"å¼ºçƒˆæ¨è\"\n+                elif weight >= 0.5:\n+                    card_class = \"medium-weight\"\n+                    recommendation_text = \"æ¨è\"\n+                elif weight >= 0.3:\n+                    card_class = \"medium-weight\"\n+                    recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n+                else:\n+                    card_class = \"low-weight\"\n+                    recommendation_text = \"å°‘é‡å°è¯•\"\n+                \n+                with st.container():\n+                    st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n+                    \n+                    # èœå“åç§°å’Œæƒé‡\n+                    col1, col2 = st.columns([3, 1])\n+                    with col1:\n+                        st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n+                    with col2:\n+                        st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n+                    \n+                    # æ¨èåŸå› \n+                    st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n+                    \n+                    # è¥å…»å€¼æ‘˜è¦\n+                    with st.expander(\"æŸ¥çœ‹è¥å…»è¯¦æƒ…\"):\n+                        nutrition = dish.get(\"è¥å…»å€¼\", {})\n+                        if nutrition:\n+                            col1, col2, col3 = st.columns(3)\n+                            with col1:\n+                                st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                                st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+                            with col2:\n+                                st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                                st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+                            with col3:\n+                                st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n+                                st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+                        else:\n+                            st.warning(\"æ— è¥å…»æ•°æ®\")\n+                    \n+                    st.markdown(\"</div>\", unsafe_allow_html=True)\n+        \n+        with tab2:\n+            # æ•´é¤è¥å…»æ‘˜è¦\n+            total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n+            if total_nutrition:\n+                st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n+                \n+                # åˆ›å»ºè¥å…»æŒ‡æ ‡å¡ç‰‡\n+                col1, col2, col3 = st.columns(3)\n+                with col1:\n+                    st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                    st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+                with col2:\n+                    st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                    st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+                with col3:\n+                    st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n+                    st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+                \n+                # è¥å…»åˆ†å¸ƒå›¾è¡¨\n+                st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n+                \n+                # ä¸»è¦è¥å…»ç´ \n+                main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n+                main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n+                \n+                # åˆ›å»ºDataFrame\n+                df = pd.DataFrame({\n+                    \"è¥å…»ç´ \": main_nutrients,\n+                    \"å«é‡\": main_values\n+                })\n+                \n+                # æ˜¾ç¤ºæŸ±çŠ¶å›¾\n+                st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n+                \n+                # å¾®é‡è¥å…»ç´ \n+                micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n+                micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n+                \n+                # æ˜¾ç¤ºå¾®é‡è¥å…»ç´ \n+                st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n+                for nutrient, value in zip(micro_nutrients, micro_values):\n+                    st.markdown(f\"**{nutrient}**: {value:.1f}\")\n+                    # æ·»åŠ ç®€å•çš„è¿›åº¦æ¡\n+                    max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n+                    percent = min(value / max_value, 1.0) if max_value > 0 else 0\n+                    st.markdown(f\"\"\"\n+                    <div class=\"nutrient-bar\">\n+                        <div class=\"nutrient-fill\" style=\"width: {percent*100}%;\"></div>\n+                    </div>\n+                    <div class=\"nutrient-value\">{value:.1f}</div>\n+                    \"\"\", unsafe_allow_html=True)\n+            else:\n+                st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n+    else:\n+        st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n+\n+# æ·»åŠ ä¸€äº›è¯´æ˜\n+st.markdown(\"---\")\n+st.markdown(\"\"\"\n+### ä½¿ç”¨è¯´æ˜\n+1. åœ¨å·¦ä¾§å¡«å†™æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰ï¼‰\n+2. æ·»åŠ æ‚¨æƒ³è¯„ä¼°çš„èœå“ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰\n+3. ç‚¹å‡»\"ç”Ÿæˆèœå“æ¨è\"æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\n+4. æŸ¥çœ‹å³ä¾§çš„æ¨èç»“æœï¼Œäº†è§£æ¯é“èœçš„æ¨èç¨‹åº¦å’ŒåŸå› \n+\n+**æ¨èæƒé‡è¯´æ˜**:\n+- **å¼ºçƒˆæ¨è (æƒé‡ â‰¥ 0.7)**: è¥å…»å‡è¡¡ä¸”ç¬¦åˆéœ€æ±‚\n+- **æ¨è (0.5 â‰¤ æƒé‡ < 0.7)**: è¥å…»è‰¯å¥½ï¼Œé€‚åˆé£Ÿç”¨\n+- **é€‚é‡é£Ÿç”¨ (0.3 â‰¤ æƒé‡ < 0.5)**: å¯ä»¥å°‘é‡é£Ÿç”¨\n+- **å°‘é‡å°è¯• (æƒé‡ < 0.3)**: å»ºè®®æœ¬é¤é¿å…æˆ–å°‘é‡å°è¯•\n+\"\"\")\n+\n+# è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰\n+if st.checkbox(\"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯\"):\n+    st.markdown(\"### è¯·æ±‚æ•°æ®\")\n+    st.json(st.session_state.request_data)\n+    \n+    if st.session_state.recommendations:\n+        st.markdown(\"### å®Œæ•´å“åº”\")\n+        st.json(st.session_state.recommendations)\n\\ No newline at end of file\n"
                },
                {
                    "date": 1752479110611,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -139,9 +139,9 @@\n BACKEND_URL = \"http://192.168.99.55:5000/recommend_dishes\"\n \n # åˆå§‹åŒ–session state\n if 'dishes' not in st.session_state:\n-    st.session_state.dishes = [{\"name\": \"\", \"weight\": 100}]\n+    st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]\n \n if 'recommendations' not in st.session_state:\n     st.session_state.recommendations = None\n \n@@ -152,9 +152,9 @@\n     st.session_state.response_time = None\n \n # æ·»åŠ èœå“\n def add_dish():\n-    st.session_state.dishes.append({\"name\": \"\", \"weight\": 100})\n+    st.session_state.dishes.append({\"name\": \"\", \"weight\": 100.0})\n \n # åˆ é™¤èœå“\n def remove_dish(index):\n     if len(st.session_state.dishes) > 1:\n@@ -236,52 +236,29 @@\n     \n     return False\n \n # å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n-# åˆå§‹åŒ–session state\n-if 'dishes' not in st.session_state:\n-    st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]  # æ”¹ä¸ºæµ®ç‚¹æ•°\n-\n-if 'recommendations' not in st.session_state:\n-    st.session_state.recommendations = None\n-\n-if 'request_data' not in st.session_state:\n-    st.session_state.request_data = None\n-\n-if 'response_time' not in st.session_state:\n-    st.session_state.response_time = None\n-\n-# æ·»åŠ èœå“\n-def add_dish():\n-    st.session_state.dishes.append({\"name\": \"\", \"weight\": 100.0})  # æ”¹ä¸ºæµ®ç‚¹æ•°\n-\n-# åœ¨å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥éƒ¨åˆ†\n with st.sidebar:\n     st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n     with st.container():\n         st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n         st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n-        \n-        # ä¿®å¤èº«é«˜è¾“å…¥\n         st.number_input(\n             \"èº«é«˜ (cm)\", \n             min_value=50.0, \n             max_value=250.0, \n             key=\"height\", \n             value=175.0,\n             step=1.0\n         )\n-        \n-        # ä¿®å¤ä½“é‡è¾“å…¥\n         st.number_input(\n             \"ä½“é‡ (kg)\", \n             min_value=10.0, \n             max_value=200.0, \n             key=\"weight\", \n             value=65.5,\n             step=0.1\n         )\n-        \n         st.selectbox(\n             \"æ´»åŠ¨æ°´å¹³\", \n             [\"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\", \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\", \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\"], \n             key=\"activity_level\",\n@@ -292,26 +269,30 @@\n             [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], \n             key=\"meal_type\",\n             index=1\n         )\n+\n # ä¸»å†…å®¹åŒº\n-# col1, col2 = st.columns([1, 1])\n-# åœ¨èœå“è¾“å…¥éƒ¨åˆ†\n+col1, col2 = st.columns([1, 1])  # ä½¿ç”¨æ•´æ•°ä½œä¸ºåˆ—å®½å‚æ•°\n+\n with col1:\n+    # èœå“è¾“å…¥éƒ¨åˆ†\n     st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n     with st.container():\n         for i, dish in enumerate(st.session_state.dishes):\n             with st.container():\n-                col_a, col_b = st.columns([3, 1])\n+                # ä¿®å¤åˆ—å®½å‚æ•° - ä½¿ç”¨æ•´æ•°\n+                col_a, col_b = st.columns([3, 1])  # 3å’Œ1éƒ½æ˜¯æ•´æ•°\n+                \n                 with col_a:\n                     dish_name = st.text_input(\n                         f\"èœå“ #{i+1} åç§°\", \n                         value=dish[\"name\"],\n                         key=f\"dish_name_{i}\",\n                         placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n                     )\n+                \n                 with col_b:\n-                    # ä¿®å¤èœå“é‡é‡è¾“å…¥\n                     dish_weight = st.number_input(\n                         \"é‡é‡ (g)\", \n                         min_value=1.0, \n                         value=dish[\"weight\"],\n@@ -322,16 +303,23 @@\n                 # æ›´æ–°session state\n                 st.session_state.dishes[i][\"name\"] = dish_name\n                 st.session_state.dishes[i][\"weight\"] = dish_weight\n                 \n-                # åˆ é™¤æŒ‰é’®\n+                # åˆ é™¤æŒ‰é’®ï¼ˆä¸æ˜¯ç¬¬ä¸€ä¸ªèœå“æ—¶æ˜¾ç¤ºï¼‰\n                 if i > 0:\n                     st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n+        \n+        # æ·»åŠ èœå“æŒ‰é’®\n+        st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n+        \n+        # æäº¤æŒ‰é’®\n+        if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n+            if submit_form():\n+                if call_backend_service():\n+                    st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n+                else:\n+                    st.session_state.recommendations = None\n \n-\n-\n-\n-\n with col2:\n     # ç»“æœæ˜¾ç¤ºéƒ¨åˆ†\n     st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n     \n"
                },
                {
                    "date": 1752479184697,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -271,9 +271,9 @@\n             index=1\n         )\n \n # ä¸»å†…å®¹åŒº\n-col1, col2 = st.columns([1, 1])  # ä½¿ç”¨æ•´æ•°ä½œä¸ºåˆ—å®½å‚æ•°\n+col1, col2 = st.columns(2)\n \n with col1:\n     # èœå“è¾“å…¥éƒ¨åˆ†\n     st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n"
                },
                {
                    "date": 1752479227731,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -271,9 +271,9 @@\n             index=1\n         )\n \n # ä¸»å†…å®¹åŒº\n-col1, col2 = st.columns(2)\n+col1, col2 = st.columns([1, 1])  # ä½¿ç”¨æ•´æ•°ä½œä¸ºåˆ—å®½å‚æ•°\n \n with col1:\n     # èœå“è¾“å…¥éƒ¨åˆ†\n     st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n"
                },
                {
                    "date": 1752479317633,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -279,9 +279,9 @@\n     st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n     with st.container():\n         for i, dish in enumerate(st.session_state.dishes):\n             with st.container():\n-                # ä¿®å¤åˆ—å®½å‚æ•° - ä½¿ç”¨æ•´æ•°\n+                with st.container():\n                 col_a, col_b = st.columns([3, 1])  # 3å’Œ1éƒ½æ˜¯æ•´æ•°\n                 \n                 with col_a:\n                     dish_name = st.text_input(\n"
                },
                {
                    "date": 1752479333434,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -280,9 +280,9 @@\n     with st.container():\n         for i, dish in enumerate(st.session_state.dishes):\n             with st.container():\n                 with st.container():\n-                col_a, col_b = st.columns([3, 1])  # 3å’Œ1éƒ½æ˜¯æ•´æ•°\n+                    col_a, col_b = st.columns([3, 1])  # 3å’Œ1éƒ½æ˜¯æ•´æ•°\n                 \n                 with col_a:\n                     dish_name = st.text_input(\n                         f\"èœå“ #{i+1} åç§°\", \n"
                },
                {
                    "date": 1752479570319,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,132 +7,26 @@\n from datetime import datetime\n \n # è®¾ç½®é¡µé¢é…ç½®\n st.set_page_config(\n-    page_title=\"FoodSkyè†³é£Ÿæ¨è\",\n+    page_title=\"æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n     page_icon=\"ğŸ²\",\n     layout=\"wide\",\n     initial_sidebar_state=\"expanded\"\n )\n \n # è‡ªå®šä¹‰CSSæ ·å¼\n st.markdown(\"\"\"\n <style>\n-    .stApp {\n-        background-color: #f5f7fa;\n-    }\n-    .header {\n-        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);\n-        color: white;\n-        padding: 2rem;\n-        border-radius: 0 0 20px 20px;\n-        margin-bottom: 2rem;\n-    }\n-    .section {\n-        background: white;\n-        border-radius: 15px;\n-        padding: 1.5rem;\n-        box-shadow: 0 4px 10px rgba(0,0,0,0.05);\n-        margin-bottom: 1.5rem;\n-    }\n-    .dish-card {\n-        border: 1px solid #e0e6ed;\n-        border-radius: 10px;\n-        padding: 1rem;\n-        margin-bottom: 1rem;\n-        background: #f9fbfd;\n-    }\n-    .recommendation-card {\n-        border-radius: 10px;\n-        padding: 1rem;\n-        margin-bottom: 1rem;\n-        box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n-    }\n-    .high-weight {\n-        background: #d4f7e2;\n-        border-left: 4px solid #2ecc71;\n-    }\n-    .medium-weight {\n-        background: #fef5e7;\n-        border-left: 4px solid #f39c12;\n-    }\n-    .low-weight {\n-        background: #fce8e6;\n-        border-left: 4px solid #e74c3c;\n-    }\n-    .submit-btn {\n-        width: 100%;\n-        padding: 0.75rem;\n-        border-radius: 8px;\n-        background: #3498db;\n-        color: white;\n-        font-weight: bold;\n-        border: none;\n-        cursor: pointer;\n-        transition: background 0.3s;\n-    }\n-    .submit-btn:hover {\n-        background: #2980b9;\n-    }\n-    .add-btn {\n-        background: #2ecc71;\n-        color: white;\n-        border: none;\n-        border-radius: 5px;\n-        padding: 0.5rem 1rem;\n-        cursor: pointer;\n-        transition: background 0.3s;\n-    }\n-    .add-btn:hover {\n-        background: #27ae60;\n-    }\n-    .remove-btn {\n-        background: #e74c3c;\n-        color: white;\n-        border: none;\n-        border-radius: 5px;\n-        padding: 0.25rem 0.75rem;\n-        cursor: pointer;\n-        margin-left: 0.5rem;\n-    }\n-    .spinner {\n-        display: inline-block;\n-        width: 20px;\n-        height: 20px;\n-        border: 3px solid rgba(0,0,0,0.1);\n-        border-radius: 50%;\n-        border-top-color: #3498db;\n-        animation: spin 1s linear infinite;\n-        margin-right: 10px;\n-    }\n-    @keyframes spin {\n-        0% { transform: rotate(0deg); }\n-        100% { transform: rotate(360deg); }\n-    }\n-    .nutrient-bar {\n-        height: 10px;\n-        border-radius: 5px;\n-        margin-top: 5px;\n-        background: #e0e0e0;\n-    }\n-    .nutrient-fill {\n-        height: 100%;\n-        border-radius: 5px;\n-        background: #3498db;\n-    }\n-    .nutrient-value {\n-        font-size: 0.9rem;\n-        margin-top: 3px;\n-        text-align: right;\n-    }\n+    /* ä¿ç•™æ‰€æœ‰CSSæ ·å¼ */\n </style>\n \"\"\", unsafe_allow_html=True)\n \n # åº”ç”¨æ ‡é¢˜\n st.markdown(\"\"\"\n <div class=\"header\">\n-    <h1 style=\"text-align:center; margin:0;\">ğŸ²FoodSkyè†³é£Ÿæ¨è</h1>\n-    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºFoodSkyï¼Œç”±ä¸­ç§‘æ·±å¥ç ”å‘çš„é£Ÿå“å¤§æ¨¡å‹è†³é£Ÿæ¨è</p>\n+    <h1 style=\"text-align:center; margin:0;\">ğŸ² æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n+    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n </div>\n \"\"\", unsafe_allow_html=True)\n \n # åç«¯æœåŠ¡URL\n@@ -270,44 +164,41 @@\n             key=\"meal_type\",\n             index=1\n         )\n \n-# ä¸»å†…å®¹åŒº\n-col1, col2 = st.columns([1, 1])  # ä½¿ç”¨æ•´æ•°ä½œä¸ºåˆ—å®½å‚æ•°\n+# ä¸»å†…å®¹åŒº - ä½¿ç”¨å®¹å™¨è€Œä¸æ˜¯åµŒå¥—åˆ—\n+main_container = st.container()\n \n-with col1:\n-    # èœå“è¾“å…¥éƒ¨åˆ†\n-    st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n-    with st.container():\n-        for i, dish in enumerate(st.session_state.dishes):\n-            with st.container():\n+with main_container:\n+    col1, col2 = st.columns([1, 1])\n+    \n+    with col1:\n+        st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n+        dish_container = st.container()\n+        \n+        with dish_container:\n+            for i, dish in enumerate(st.session_state.dishes):\n+                # ä½¿ç”¨å®¹å™¨è€Œä¸æ˜¯åµŒå¥—åˆ—\n                 with st.container():\n-                    col_a, col_b = st.columns([3, 1])  # 3å’Œ1éƒ½æ˜¯æ•´æ•°\n-                \n-                with col_a:\n-                    dish_name = st.text_input(\n-                        f\"èœå“ #{i+1} åç§°\", \n-                        value=dish[\"name\"],\n-                        key=f\"dish_name_{i}\",\n-                        placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n-                    )\n-                \n-                with col_b:\n-                    dish_weight = st.number_input(\n-                        \"é‡é‡ (g)\", \n-                        min_value=1.0, \n-                        value=dish[\"weight\"],\n-                        key=f\"dish_weight_{i}\",\n-                        step=1.0\n-                    )\n-                \n-                # æ›´æ–°session state\n-                st.session_state.dishes[i][\"name\"] = dish_name\n-                st.session_state.dishes[i][\"weight\"] = dish_weight\n-                \n-                # åˆ é™¤æŒ‰é’®ï¼ˆä¸æ˜¯ç¬¬ä¸€ä¸ªèœå“æ—¶æ˜¾ç¤ºï¼‰\n-                if i > 0:\n-                    st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n+                    # ä½¿ç”¨HTML/CSSåˆ›å»ºç±»ä¼¼åˆ—çš„æ•ˆæœ\n+                    st.markdown(f\"\"\"\n+                    <div style=\"display: flex; margin-bottom: 15px;\">\n+                        <div style=\"flex: 3; margin-right: 10px;\">\n+                            {st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")._repr_html_()}\n+                        </div>\n+                        <div style=\"flex: 1;\">\n+                            {st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)._repr_html_()}\n+                        </div>\n+                    </div>\n+                    \"\"\", unsafe_allow_html=True)\n+                    \n+                    # æ›´æ–°session state\n+                    st.session_state.dishes[i][\"name\"] = dish[\"name\"]\n+                    st.session_state.dishes[i][\"weight\"] = dish[\"weight\"]\n+                    \n+                    # åˆ é™¤æŒ‰é’®ï¼ˆä¸æ˜¯ç¬¬ä¸€ä¸ªèœå“æ—¶æ˜¾ç¤ºï¼‰\n+                    if i > 0:\n+                        st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n         \n         # æ·»åŠ èœå“æŒ‰é’®\n         st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n         \n@@ -317,134 +208,133 @@\n                 if call_backend_service():\n                     st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n                 else:\n                     st.session_state.recommendations = None\n-\n-with col2:\n-    # ç»“æœæ˜¾ç¤ºéƒ¨åˆ†\n-    st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n     \n-    if st.session_state.recommendations:\n-        recommendations = st.session_state.recommendations\n+    with col2:\n+        st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n         \n-        # æ˜¾ç¤ºè¯·æ±‚ä¿¡æ¯\n-        st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n-        \n-        # æ˜¾ç¤ºé¤åˆ«å’Œæ±‚è§£çŠ¶æ€\n-        st.markdown(f\"**é¤åˆ«**: {recommendations.get('é¤åˆ«', 'åˆé¤')}\")\n-        st.markdown(f\"**æ±‚è§£çŠ¶æ€**: {recommendations.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n-        \n-        # æ˜¾ç¤ºèœå“æ¨è\n-        st.markdown(\"### èœå“æ¨è\")\n-        \n-        # åˆ›å»ºé€‰é¡¹å¡\n-        tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n-        \n-        with tab1:\n-            for dish in recommendations.get(\"èœå“æ¨è\", []):\n-                weight = dish.get(\"æ¨èæƒé‡\", 0)\n-                \n-                # æ ¹æ®æƒé‡è®¾ç½®æ ·å¼\n-                if weight >= 0.7:\n-                    card_class = \"high-weight\"\n-                    recommendation_text = \"å¼ºçƒˆæ¨è\"\n-                elif weight >= 0.5:\n-                    card_class = \"medium-weight\"\n-                    recommendation_text = \"æ¨è\"\n-                elif weight >= 0.3:\n-                    card_class = \"medium-weight\"\n-                    recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n-                else:\n-                    card_class = \"low-weight\"\n-                    recommendation_text = \"å°‘é‡å°è¯•\"\n-                \n-                with st.container():\n-                    st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n+        if st.session_state.recommendations:\n+            recommendations = st.session_state.recommendations\n+            \n+            # æ˜¾ç¤ºè¯·æ±‚ä¿¡æ¯\n+            st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n+            \n+            # æ˜¾ç¤ºé¤åˆ«å’Œæ±‚è§£çŠ¶æ€\n+            st.markdown(f\"**é¤åˆ«**: {recommendations.get('é¤åˆ«', 'åˆé¤')}\")\n+            st.markdown(f\"**æ±‚è§£çŠ¶æ€**: {recommendations.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n+            \n+            # æ˜¾ç¤ºèœå“æ¨è\n+            st.markdown(\"### èœå“æ¨è\")\n+            \n+            # åˆ›å»ºé€‰é¡¹å¡\n+            tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n+            \n+            with tab1:\n+                for dish in recommendations.get(\"èœå“æ¨è\", []):\n+                    weight = dish.get(\"æ¨èæƒé‡\", 0)\n                     \n-                    # èœå“åç§°å’Œæƒé‡\n-                    col1, col2 = st.columns([3, 1])\n+                    # æ ¹æ®æƒé‡è®¾ç½®æ ·å¼\n+                    if weight >= 0.7:\n+                        card_class = \"high-weight\"\n+                        recommendation_text = \"å¼ºçƒˆæ¨è\"\n+                    elif weight >= 0.5:\n+                        card_class = \"medium-weight\"\n+                        recommendation_text = \"æ¨è\"\n+                    elif weight >= 0.3:\n+                        card_class = \"medium-weight\"\n+                        recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n+                    else:\n+                        card_class = \"low-weight\"\n+                        recommendation_text = \"å°‘é‡å°è¯•\"\n+                    \n+                    with st.container():\n+                        st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n+                        \n+                        # èœå“åç§°å’Œæƒé‡\n+                        col1, col2 = st.columns([3, 1])\n+                        with col1:\n+                            st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n+                        with col2:\n+                            st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n+                        \n+                        # æ¨èåŸå› \n+                        st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n+                        \n+                        # è¥å…»å€¼æ‘˜è¦\n+                        with st.expander(\"æŸ¥çœ‹è¥å…»è¯¦æƒ…\"):\n+                            nutrition = dish.get(\"è¥å…»å€¼\", {})\n+                            if nutrition:\n+                                col1, col2, col3 = st.columns(3)\n+                                with col1:\n+                                    st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                                    st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+                                with col2:\n+                                    st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                                    st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+                                with col3:\n+                                    st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n+                                    st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+                            else:\n+                                st.warning(\"æ— è¥å…»æ•°æ®\")\n+                        \n+                        st.markdown(\"</div>\", unsafe_allow_html=True)\n+            \n+            with tab2:\n+                # æ•´é¤è¥å…»æ‘˜è¦\n+                total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n+                if total_nutrition:\n+                    st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n+                    \n+                    # åˆ›å»ºè¥å…»æŒ‡æ ‡å¡ç‰‡\n+                    col1, col2, col3 = st.columns(3)\n                     with col1:\n-                        st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n+                        st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                        st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n                     with col2:\n-                        st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n+                        st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                        st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+                    with col3:\n+                        st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n+                        st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n                     \n-                    # æ¨èåŸå› \n-                    st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n+                    # è¥å…»åˆ†å¸ƒå›¾è¡¨\n+                    st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n                     \n-                    # è¥å…»å€¼æ‘˜è¦\n-                    with st.expander(\"æŸ¥çœ‹è¥å…»è¯¦æƒ…\"):\n-                        nutrition = dish.get(\"è¥å…»å€¼\", {})\n-                        if nutrition:\n-                            col1, col2, col3 = st.columns(3)\n-                            with col1:\n-                                st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                                st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                            with col2:\n-                                st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-                                st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                            with col3:\n-                                st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n-                                st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n-                        else:\n-                            st.warning(\"æ— è¥å…»æ•°æ®\")\n+                    # ä¸»è¦è¥å…»ç´ \n+                    main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n+                    main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n                     \n-                    st.markdown(\"</div>\", unsafe_allow_html=True)\n-        \n-        with tab2:\n-            # æ•´é¤è¥å…»æ‘˜è¦\n-            total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n-            if total_nutrition:\n-                st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n-                \n-                # åˆ›å»ºè¥å…»æŒ‡æ ‡å¡ç‰‡\n-                col1, col2, col3 = st.columns(3)\n-                with col1:\n-                    st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                    st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                with col2:\n-                    st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-                    st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                with col3:\n-                    st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n-                    st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n-                \n-                # è¥å…»åˆ†å¸ƒå›¾è¡¨\n-                st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n-                \n-                # ä¸»è¦è¥å…»ç´ \n-                main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n-                main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n-                \n-                # åˆ›å»ºDataFrame\n-                df = pd.DataFrame({\n-                    \"è¥å…»ç´ \": main_nutrients,\n-                    \"å«é‡\": main_values\n-                })\n-                \n-                # æ˜¾ç¤ºæŸ±çŠ¶å›¾\n-                st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n-                \n-                # å¾®é‡è¥å…»ç´ \n-                micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n-                micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n-                \n-                # æ˜¾ç¤ºå¾®é‡è¥å…»ç´ \n-                st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n-                for nutrient, value in zip(micro_nutrients, micro_values):\n-                    st.markdown(f\"**{nutrient}**: {value:.1f}\")\n-                    # æ·»åŠ ç®€å•çš„è¿›åº¦æ¡\n-                    max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n-                    percent = min(value / max_value, 1.0) if max_value > 0 else 0\n-                    st.markdown(f\"\"\"\n-                    <div class=\"nutrient-bar\">\n-                        <div class=\"nutrient-fill\" style=\"width: {percent*100}%;\"></div>\n-                    </div>\n-                    <div class=\"nutrient-value\">{value:.1f}</div>\n-                    \"\"\", unsafe_allow_html=True)\n-            else:\n-                st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n-    else:\n-        st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n+                    # åˆ›å»ºDataFrame\n+                    df = pd.DataFrame({\n+                        \"è¥å…»ç´ \": main_nutrients,\n+                        \"å«é‡\": main_values\n+                    })\n+                    \n+                    # æ˜¾ç¤ºæŸ±çŠ¶å›¾\n+                    st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n+                    \n+                    # å¾®é‡è¥å…»ç´ \n+                    micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n+                    micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n+                    \n+                    # æ˜¾ç¤ºå¾®é‡è¥å…»ç´ \n+                    st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n+                    for nutrient, value in zip(micro_nutrients, micro_values):\n+                        st.markdown(f\"**{nutrient}**: {value:.1f}\")\n+                        # æ·»åŠ ç®€å•çš„è¿›åº¦æ¡\n+                        max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n+                        percent = min(value / max_value, 1.0) if max_value > 0 else 0\n+                        st.markdown(f\"\"\"\n+                        <div class=\"nutrient-bar\">\n+                            <div class=\"nutrient-fill\" style=\"width: {percent*100}%;\"></div>\n+                        </div>\n+                        <div class=\"nutrient-value\">{value:.1f}</div>\n+                        \"\"\", unsafe_allow_html=True)\n+                else:\n+                    st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n+        else:\n+            st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n \n # æ·»åŠ ä¸€äº›è¯´æ˜\n st.markdown(\"---\")\n st.markdown(\"\"\"\n"
                },
                {
                    "date": 1752479836135,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,9 +16,115 @@\n \n # è‡ªå®šä¹‰CSSæ ·å¼\n st.markdown(\"\"\"\n <style>\n-    /* ä¿ç•™æ‰€æœ‰CSSæ ·å¼ */\n+    .stApp {\n+        background-color: #f5f7fa;\n+    }\n+    .header {\n+        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);\n+        color: white;\n+        padding: 2rem;\n+        border-radius: 0 0 20px 20px;\n+        margin-bottom: 2rem;\n+    }\n+    .section {\n+        background: white;\n+        border-radius: 15px;\n+        padding: 1.5rem;\n+        box-shadow: 0 4px 10px rgba(0,0,0,0.05);\n+        margin-bottom: 1.5rem;\n+    }\n+    .dish-card {\n+        border: 1px solid #e0e6ed;\n+        border-radius: 10px;\n+        padding: 1rem;\n+        margin-bottom: 1rem;\n+        background: #f9fbfd;\n+    }\n+    .recommendation-card {\n+        border-radius: 10px;\n+        padding: 1rem;\n+        margin-bottom: 1rem;\n+        box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n+    }\n+    .high-weight {\n+        background: #d4f7e2;\n+        border-left: 4px solid #2ecc71;\n+    }\n+    .medium-weight {\n+        background: #fef5e7;\n+        border-left: 4px solid #f39c12;\n+    }\n+    .low-weight {\n+        background: #fce8e6;\n+        border-left: 4px solid #e74c3c;\n+    }\n+    .submit-btn {\n+        width: 100%;\n+        padding: 0.75rem;\n+        border-radius: 8px;\n+        background: #3498db;\n+        color: white;\n+        font-weight: bold;\n+        border: none;\n+        cursor: pointer;\n+        transition: background 0.3s;\n+    }\n+    .submit-btn:hover {\n+        background: #2980b9;\n+    }\n+    .add-btn {\n+        background: #2ecc71;\n+        color: white;\n+        border: none;\n+        border-radius: 5px;\n+        padding: 0.5rem 1rem;\n+        cursor: pointer;\n+        transition: background 0.3s;\n+    }\n+    .add-btn:hover {\n+        background: #27ae60;\n+    }\n+    .remove-btn {\n+        background: #e74c3c;\n+        color: white;\n+        border: none;\n+        border-radius: 5px;\n+        padding: 0.25rem 0.75rem;\n+        cursor: pointer;\n+        margin-left: 0.5rem;\n+    }\n+    .spinner {\n+        display: inline-block;\n+        width: 20px;\n+        height: 20px;\n+        border: 3px solid rgba(0,0,0,0.1);\n+        border-radius: 50%;\n+        border-top-color: #3498db;\n+        animation: spin 1s linear infinite;\n+        margin-right: 10px;\n+    }\n+    @keyframes spin {\n+        0% { transform: rotate(0deg); }\n+        100% { transform: rotate(360deg); }\n+    }\n+    .nutrient-bar {\n+        height: 10px;\n+        border-radius: 5px;\n+        margin-top: 5px;\n+        background: #e0e0e0;\n+    }\n+    .nutrient-fill {\n+        height: 100%;\n+        border-radius: 5px;\n+        background: #3498db;\n+    }\n+    .nutrient-value {\n+        font-size: 0.9rem;\n+        margin-top: 3px;\n+        text-align: right;\n+    }\n </style>\n \"\"\", unsafe_allow_html=True)\n \n # åº”ç”¨æ ‡é¢˜\n@@ -164,41 +270,48 @@\n             key=\"meal_type\",\n             index=1\n         )\n \n-# ä¸»å†…å®¹åŒº - ä½¿ç”¨å®¹å™¨è€Œä¸æ˜¯åµŒå¥—åˆ—\n+# ä¸»å†…å®¹åŒº\n main_container = st.container()\n \n with main_container:\n     col1, col2 = st.columns([1, 1])\n     \n     with col1:\n         st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n-        dish_container = st.container()\n         \n-        with dish_container:\n-            for i, dish in enumerate(st.session_state.dishes):\n-                # ä½¿ç”¨å®¹å™¨è€Œä¸æ˜¯åµŒå¥—åˆ—\n-                with st.container():\n-                    # ä½¿ç”¨HTML/CSSåˆ›å»ºç±»ä¼¼åˆ—çš„æ•ˆæœ\n-                    st.markdown(f\"\"\"\n-                    <div style=\"display: flex; margin-bottom: 15px;\">\n-                        <div style=\"flex: 3; margin-right: 10px;\">\n-                            {st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")._repr_html_()}\n-                        </div>\n-                        <div style=\"flex: 1;\">\n-                            {st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)._repr_html_()}\n-                        </div>\n-                    </div>\n-                    \"\"\", unsafe_allow_html=True)\n-                    \n-                    # æ›´æ–°session state\n-                    st.session_state.dishes[i][\"name\"] = dish[\"name\"]\n-                    st.session_state.dishes[i][\"weight\"] = dish[\"weight\"]\n-                    \n-                    # åˆ é™¤æŒ‰é’®ï¼ˆä¸æ˜¯ç¬¬ä¸€ä¸ªèœå“æ—¶æ˜¾ç¤ºï¼‰\n-                    if i > 0:\n-                        st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n+        for i, dish in enumerate(st.session_state.dishes):\n+            # ä¸ºæ¯ä¸ªèœå“åˆ›å»ºä¸€ä¸ªå®¹å™¨\n+            with st.container():\n+                # ä½¿ç”¨ä¸¤åˆ—å¸ƒå±€ï¼šåç§°å’Œé‡é‡\n+                col_name, col_weight = st.columns([3, 1])\n+                \n+                with col_name:\n+                    dish_name = st.text_input(\n+                        f\"èœå“ #{i+1} åç§°\", \n+                        value=dish[\"name\"],\n+                        key=f\"dish_name_{i}\",\n+                        placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n+                    )\n+                \n+                with col_weight:\n+                    dish_weight = st.number_input(\n+                        \"é‡é‡ (g)\", \n+                        min_value=1.0, \n+                        value=dish[\"weight\"],\n+                        key=f\"dish_weight_{i}\",\n+                        step=1.0\n+                    )\n+                \n+                # æ›´æ–°session state\n+                st.session_state.dishes[i][\"name\"] = dish_name\n+                st.session_state.dishes[i][\"weight\"] = dish_weight\n+                \n+                # åˆ é™¤æŒ‰é’®ï¼ˆä¸æ˜¯ç¬¬ä¸€ä¸ªèœå“æ—¶æ˜¾ç¤ºï¼‰\n+                if i > 0:\n+                    # å°†åˆ é™¤æŒ‰é’®æ”¾åœ¨é‡é‡åˆ—ä¸‹æ–¹ï¼Œé å³å¯¹é½\n+                    st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n         \n         # æ·»åŠ èœå“æŒ‰é’®\n         st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n         \n"
                },
                {
                    "date": 1752480028653,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,115 +16,20 @@\n \n # è‡ªå®šä¹‰CSSæ ·å¼\n st.markdown(\"\"\"\n <style>\n-    .stApp {\n-        background-color: #f5f7fa;\n+    /* ä¿ç•™æ‰€æœ‰CSSæ ·å¼ */\n+    .dish-row {\n+        display: flex;\n+        margin-bottom: 15px;\n     }\n-    .header {\n-        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);\n-        color: white;\n-        padding: 2rem;\n-        border-radius: 0 0 20px 20px;\n-        margin-bottom: 2rem;\n-    }\n-    .section {\n-        background: white;\n-        border-radius: 15px;\n-        padding: 1.5rem;\n-        box-shadow: 0 4px 10px rgba(0,0,0,0.05);\n-        margin-bottom: 1.5rem;\n-    }\n-    .dish-card {\n-        border: 1px solid #e0e6ed;\n-        border-radius: 10px;\n-        padding: 1rem;\n-        margin-bottom: 1rem;\n-        background: #f9fbfd;\n-    }\n-    .recommendation-card {\n-        border-radius: 10px;\n-        padding: 1rem;\n-        margin-bottom: 1rem;\n-        box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n-    }\n-    .high-weight {\n-        background: #d4f7e2;\n-        border-left: 4px solid #2ecc71;\n-    }\n-    .medium-weight {\n-        background: #fef5e7;\n-        border-left: 4px solid #f39c12;\n-    }\n-    .low-weight {\n-        background: #fce8e6;\n-        border-left: 4px solid #e74c3c;\n-    }\n-    .submit-btn {\n-        width: 100%;\n-        padding: 0.75rem;\n-        border-radius: 8px;\n-        background: #3498db;\n-        color: white;\n-        font-weight: bold;\n-        border: none;\n-        cursor: pointer;\n-        transition: background 0.3s;\n-    }\n-    .submit-btn:hover {\n-        background: #2980b9;\n-    }\n-    .add-btn {\n-        background: #2ecc71;\n-        color: white;\n-        border: none;\n-        border-radius: 5px;\n-        padding: 0.5rem 1rem;\n-        cursor: pointer;\n-        transition: background 0.3s;\n-    }\n-    .add-btn:hover {\n-        background: #27ae60;\n-    }\n-    .remove-btn {\n-        background: #e74c3c;\n-        color: white;\n-        border: none;\n-        border-radius: 5px;\n-        padding: 0.25rem 0.75rem;\n-        cursor: pointer;\n-        margin-left: 0.5rem;\n-    }\n-    .spinner {\n-        display: inline-block;\n-        width: 20px;\n-        height: 20px;\n-        border: 3px solid rgba(0,0,0,0.1);\n-        border-radius: 50%;\n-        border-top-color: #3498db;\n-        animation: spin 1s linear infinite;\n+    .dish-name {\n+        flex: 3;\n         margin-right: 10px;\n     }\n-    @keyframes spin {\n-        0% { transform: rotate(0deg); }\n-        100% { transform: rotate(360deg); }\n+    .dish-weight {\n+        flex: 1;\n     }\n-    .nutrient-bar {\n-        height: 10px;\n-        border-radius: 5px;\n-        margin-top: 5px;\n-        background: #e0e0e0;\n-    }\n-    .nutrient-fill {\n-        height: 100%;\n-        border-radius: 5px;\n-        background: #3498db;\n-    }\n-    .nutrient-value {\n-        font-size: 0.9rem;\n-        margin-top: 3px;\n-        text-align: right;\n-    }\n </style>\n \"\"\", unsafe_allow_html=True)\n \n # åº”ç”¨æ ‡é¢˜\n@@ -280,38 +185,27 @@\n     with col1:\n         st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n         \n         for i, dish in enumerate(st.session_state.dishes):\n-            # ä¸ºæ¯ä¸ªèœå“åˆ›å»ºä¸€ä¸ªå®¹å™¨\n-            with st.container():\n-                # ä½¿ç”¨ä¸¤åˆ—å¸ƒå±€ï¼šåç§°å’Œé‡é‡\n-                col_name, col_weight = st.columns([3, 1])\n-                \n-                with col_name:\n-                    dish_name = st.text_input(\n-                        f\"èœå“ #{i+1} åç§°\", \n-                        value=dish[\"name\"],\n-                        key=f\"dish_name_{i}\",\n-                        placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n-                    )\n-                \n-                with col_weight:\n-                    dish_weight = st.number_input(\n-                        \"é‡é‡ (g)\", \n-                        min_value=1.0, \n-                        value=dish[\"weight\"],\n-                        key=f\"dish_weight_{i}\",\n-                        step=1.0\n-                    )\n-                \n-                # æ›´æ–°session state\n-                st.session_state.dishes[i][\"name\"] = dish_name\n-                st.session_state.dishes[i][\"weight\"] = dish_weight\n-                \n-                # åˆ é™¤æŒ‰é’®ï¼ˆä¸æ˜¯ç¬¬ä¸€ä¸ªèœå“æ—¶æ˜¾ç¤ºï¼‰\n-                if i > 0:\n-                    # å°†åˆ é™¤æŒ‰é’®æ”¾åœ¨é‡é‡åˆ—ä¸‹æ–¹ï¼Œé å³å¯¹é½\n-                    st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n+            # ä½¿ç”¨HTML/CSSåˆ›å»ºç±»ä¼¼åˆ—çš„æ•ˆæœï¼Œé¿å…åµŒå¥—åˆ—\n+            st.markdown(f\"\"\"\n+            <div class=\"dish-row\">\n+                <div class=\"dish-name\">\n+                    {st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")._repr_html_()}\n+                </div>\n+                <div class=\"dish-weight\">\n+                    {st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)._repr_html_()}\n+                </div>\n+            </div>\n+            \"\"\", unsafe_allow_html=True)\n+            \n+            # æ›´æ–°session state\n+            st.session_state.dishes[i][\"name\"] = dish[\"name\"]\n+            st.session_state.dishes[i][\"weight\"] = dish[\"weight\"]\n+            \n+            # åˆ é™¤æŒ‰é’®ï¼ˆä¸æ˜¯ç¬¬ä¸€ä¸ªèœå“æ—¶æ˜¾ç¤ºï¼‰\n+            if i > 0:\n+                st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n         \n         # æ·»åŠ èœå“æŒ‰é’®\n         st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n         \n@@ -363,13 +257,10 @@\n                     with st.container():\n                         st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n                         \n                         # èœå“åç§°å’Œæƒé‡\n-                        col1, col2 = st.columns([3, 1])\n-                        with col1:\n-                            st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n-                        with col2:\n-                            st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n+                        st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n+                        st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n                         \n                         # æ¨èåŸå› \n                         st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n                         \n"
                },
                {
                    "date": 1752482911475,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,20 +16,39 @@\n \n # è‡ªå®šä¹‰CSSæ ·å¼\n st.markdown(\"\"\"\n <style>\n-    /* ä¿ç•™æ‰€æœ‰CSSæ ·å¼ */\n-    .dish-row {\n-        display: flex;\n-        margin-bottom: 15px;\n+    .recommendation-card {\n+        border: 1px solid #e0e0e0;\n+        border-radius: 12px;\n+        padding: 15px;\n+        margin-bottom: 10px;\n+        background-color: #fafafa;\n     }\n-    .dish-name {\n-        flex: 3;\n-        margin-right: 10px;\n+    .high-weight {\n+        border-left: 6px solid #4CAF50;\n     }\n-    .dish-weight {\n-        flex: 1;\n+    .medium-weight {\n+        border-left: 6px solid #FFC107;\n     }\n+    .low-weight {\n+        border-left: 6px solid #F44336;\n+    }\n+    .nutrient-bar {\n+        height: 10px;\n+        background-color: #f0f0f0;\n+        border-radius: 5px;\n+        overflow: hidden;\n+        margin-bottom: 4px;\n+    }\n+    .nutrient-fill {\n+        height: 100%;\n+        background-color: #4CAF50;\n+    }\n+    .nutrient-value {\n+        font-size: 12px;\n+        margin-bottom: 10px;\n+    }\n </style>\n \"\"\", unsafe_allow_html=True)\n \n # åº”ç”¨æ ‡é¢˜\n@@ -45,15 +64,12 @@\n \n # åˆå§‹åŒ–session state\n if 'dishes' not in st.session_state:\n     st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]\n-\n if 'recommendations' not in st.session_state:\n     st.session_state.recommendations = None\n-\n if 'request_data' not in st.session_state:\n     st.session_state.request_data = None\n-\n if 'response_time' not in st.session_state:\n     st.session_state.response_time = None\n \n # æ·»åŠ èœå“\n@@ -66,28 +82,23 @@\n         st.session_state.dishes.pop(index)\n \n # æäº¤è¡¨å•\n def submit_form():\n-    # éªŒè¯ç”¨æˆ·ä¿¡æ¯\n     required_fields = ['gender', 'age', 'height', 'weight', 'activity_level', 'meal_type']\n     if not all([st.session_state.get(field) for field in required_fields]):\n         st.error(\"è¯·å¡«å†™å®Œæ•´çš„ä¸ªäººä¿¡æ¯\")\n         return False\n-    \n-    # éªŒè¯èœå“ä¿¡æ¯\n     for i, dish in enumerate(st.session_state.dishes):\n         if not dish[\"name\"]:\n             st.error(f\"èœå“ #{i+1} åç§°ä¸èƒ½ä¸ºç©º\")\n             return False\n         if dish[\"weight\"] <= 0:\n             st.error(f\"èœå“ #{i+1} é‡é‡å¿…é¡»å¤§äº0\")\n             return False\n-    \n     return True\n \n # è°ƒç”¨åç«¯æœåŠ¡\n def call_backend_service():\n-    # å‡†å¤‡è¯·æ±‚æ•°æ®\n     st.session_state.request_data = {\n         \"info\": {\n             \"æ€§åˆ«\": st.session_state.gender,\n             \"å¹´é¾„\": st.session_state.age,\n@@ -104,25 +115,16 @@\n                 } for dish in st.session_state.dishes\n             ]\n         }\n     }\n-    \n+\n     try:\n-        # æ˜¾ç¤ºåŠ è½½çŠ¶æ€\n         with st.spinner(\"æ­£åœ¨åˆ†ææ‚¨çš„è¥å…»éœ€æ±‚ï¼Œè¯·ç¨å€™...\"):\n             start_time = time.time()\n-            \n-            # å‘é€è¯·æ±‚\n-            response = requests.post(\n-                BACKEND_URL,\n-                json=st.session_state.request_data,\n-                timeout=120  # 120ç§’è¶…æ—¶\n-            )\n-            \n+            response = requests.post(BACKEND_URL, json=st.session_state.request_data, timeout=120)\n             end_time = time.time()\n             st.session_state.response_time = end_time - start_time\n-            \n-            # æ£€æŸ¥å“åº”çŠ¶æ€\n+\n             if response.status_code == 200:\n                 data = response.json()\n                 if data.get(\"success\"):\n                     st.session_state.recommendations = data[\"result\"]\n@@ -137,111 +139,73 @@\n     except requests.exceptions.ConnectionError:\n         st.error(\"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\")\n     except Exception as e:\n         st.error(f\"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}\")\n-    \n     return False\n \n # å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n with st.sidebar:\n     st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n-    with st.container():\n-        st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n-        st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n-        st.number_input(\n-            \"èº«é«˜ (cm)\", \n-            min_value=50.0, \n-            max_value=250.0, \n-            key=\"height\", \n-            value=175.0,\n-            step=1.0\n-        )\n-        st.number_input(\n-            \"ä½“é‡ (kg)\", \n-            min_value=10.0, \n-            max_value=200.0, \n-            key=\"weight\", \n-            value=65.5,\n-            step=0.1\n-        )\n-        st.selectbox(\n-            \"æ´»åŠ¨æ°´å¹³\", \n-            [\"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\", \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\", \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\"], \n-            key=\"activity_level\",\n-            index=1\n-        )\n-        st.selectbox(\n-            \"é¤åˆ«\", \n-            [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], \n-            key=\"meal_type\",\n-            index=1\n-        )\n+    st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n+    st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n+    st.number_input(\"èº«é«˜ (cm)\", min_value=50.0, max_value=250.0, key=\"height\", value=175.0, step=1.0)\n+    st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.1)\n+    st.selectbox(\n+        \"æ´»åŠ¨æ°´å¹³\",\n+        [\"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\", \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\", \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\"],\n+        key=\"activity_level\",\n+        index=1\n+    )\n+    st.selectbox(\"é¤åˆ«\", [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], key=\"meal_type\", index=1)\n \n # ä¸»å†…å®¹åŒº\n main_container = st.container()\n \n with main_container:\n     col1, col2 = st.columns([1, 1])\n-    \n+\n     with col1:\n         st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n-        \n+\n         for i, dish in enumerate(st.session_state.dishes):\n-            # ä½¿ç”¨HTML/CSSåˆ›å»ºç±»ä¼¼åˆ—çš„æ•ˆæœï¼Œé¿å…åµŒå¥—åˆ—\n-            st.markdown(f\"\"\"\n-            <div class=\"dish-row\">\n-                <div class=\"dish-name\">\n-                    {st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")._repr_html_()}\n-                </div>\n-                <div class=\"dish-weight\">\n-                    {st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)._repr_html_()}\n-                </div>\n-            </div>\n-            \"\"\", unsafe_allow_html=True)\n-            \n-            # æ›´æ–°session state\n-            st.session_state.dishes[i][\"name\"] = dish[\"name\"]\n-            st.session_state.dishes[i][\"weight\"] = dish[\"weight\"]\n-            \n-            # åˆ é™¤æŒ‰é’®ï¼ˆä¸æ˜¯ç¬¬ä¸€ä¸ªèœå“æ—¶æ˜¾ç¤ºï¼‰\n-            if i > 0:\n-                st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n-        \n-        # æ·»åŠ èœå“æŒ‰é’®\n+            col_name, col_weight, col_remove = st.columns([3, 1, 0.5])\n+\n+            with col_name:\n+                name = st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")\n+            with col_weight:\n+                weight = st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)\n+            with col_remove:\n+                if i > 0:\n+                    if st.button(\"åˆ é™¤\", key=f\"remove_{i}\"):\n+                        remove_dish(i)\n+                        st.experimental_rerun()\n+\n+            # æ›´æ–° session state\n+            st.session_state.dishes[i][\"name\"] = name\n+            st.session_state.dishes[i][\"weight\"] = weight\n+\n         st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n-        \n-        # æäº¤æŒ‰é’®\n+\n         if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n             if submit_form():\n                 if call_backend_service():\n                     st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n                 else:\n                     st.session_state.recommendations = None\n-    \n+\n     with col2:\n         st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n-        \n         if st.session_state.recommendations:\n             recommendations = st.session_state.recommendations\n-            \n-            # æ˜¾ç¤ºè¯·æ±‚ä¿¡æ¯\n             st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n-            \n-            # æ˜¾ç¤ºé¤åˆ«å’Œæ±‚è§£çŠ¶æ€\n             st.markdown(f\"**é¤åˆ«**: {recommendations.get('é¤åˆ«', 'åˆé¤')}\")\n             st.markdown(f\"**æ±‚è§£çŠ¶æ€**: {recommendations.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n-            \n-            # æ˜¾ç¤ºèœå“æ¨è\n             st.markdown(\"### èœå“æ¨è\")\n-            \n-            # åˆ›å»ºé€‰é¡¹å¡\n             tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n-            \n+\n             with tab1:\n                 for dish in recommendations.get(\"èœå“æ¨è\", []):\n                     weight = dish.get(\"æ¨èæƒé‡\", 0)\n-                    \n-                    # æ ¹æ®æƒé‡è®¾ç½®æ ·å¼\n                     if weight >= 0.7:\n                         card_class = \"high-weight\"\n                         recommendation_text = \"å¼ºçƒˆæ¨è\"\n                     elif weight >= 0.5:\n@@ -252,20 +216,14 @@\n                         recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n                     else:\n                         card_class = \"low-weight\"\n                         recommendation_text = \"å°‘é‡å°è¯•\"\n-                    \n+\n                     with st.container():\n                         st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n-                        \n-                        # èœå“åç§°å’Œæƒé‡\n                         st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n                         st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n-                        \n-                        # æ¨èåŸå› \n                         st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n-                        \n-                        # è¥å…»å€¼æ‘˜è¦\n                         with st.expander(\"æŸ¥çœ‹è¥å…»è¯¦æƒ…\"):\n                             nutrition = dish.get(\"è¥å…»å€¼\", {})\n                             if nutrition:\n                                 col1, col2, col3 = st.columns(3)\n@@ -279,18 +237,14 @@\n                                     st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n                                     st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n                             else:\n                                 st.warning(\"æ— è¥å…»æ•°æ®\")\n-                        \n                         st.markdown(\"</div>\", unsafe_allow_html=True)\n-            \n+\n             with tab2:\n-                # æ•´é¤è¥å…»æ‘˜è¦\n                 total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n                 if total_nutrition:\n                     st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n-                    \n-                    # åˆ›å»ºè¥å…»æŒ‡æ ‡å¡ç‰‡\n                     col1, col2, col3 = st.columns(3)\n                     with col1:\n                         st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n                         st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n@@ -299,34 +253,20 @@\n                         st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n                     with col3:\n                         st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n                         st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n-                    \n-                    # è¥å…»åˆ†å¸ƒå›¾è¡¨\n+\n                     st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n-                    \n-                    # ä¸»è¦è¥å…»ç´ \n                     main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n                     main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n-                    \n-                    # åˆ›å»ºDataFrame\n-                    df = pd.DataFrame({\n-                        \"è¥å…»ç´ \": main_nutrients,\n-                        \"å«é‡\": main_values\n-                    })\n-                    \n-                    # æ˜¾ç¤ºæŸ±çŠ¶å›¾\n+                    df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n                     st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n-                    \n-                    # å¾®é‡è¥å…»ç´ \n+\n                     micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n                     micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n-                    \n-                    # æ˜¾ç¤ºå¾®é‡è¥å…»ç´ \n                     st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n                     for nutrient, value in zip(micro_nutrients, micro_values):\n                         st.markdown(f\"**{nutrient}**: {value:.1f}\")\n-                        # æ·»åŠ ç®€å•çš„è¿›åº¦æ¡\n                         max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n                         percent = min(value / max_value, 1.0) if max_value > 0 else 0\n                         st.markdown(f\"\"\"\n                         <div class=\"nutrient-bar\">\n@@ -338,9 +278,9 @@\n                     st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n         else:\n             st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n \n-# æ·»åŠ ä¸€äº›è¯´æ˜\n+# ä½¿ç”¨è¯´æ˜\n st.markdown(\"---\")\n st.markdown(\"\"\"\n ### ä½¿ç”¨è¯´æ˜\n 1. åœ¨å·¦ä¾§å¡«å†™æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰ï¼‰\n@@ -348,18 +288,17 @@\n 3. ç‚¹å‡»\"ç”Ÿæˆèœå“æ¨è\"æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\n 4. æŸ¥çœ‹å³ä¾§çš„æ¨èç»“æœï¼Œäº†è§£æ¯é“èœçš„æ¨èç¨‹åº¦å’ŒåŸå› \n \n **æ¨èæƒé‡è¯´æ˜**:\n-- **å¼ºçƒˆæ¨è (æƒé‡ â‰¥ 0.7)**: è¥å…»å‡è¡¡ä¸”ç¬¦åˆéœ€æ±‚\n-- **æ¨è (0.5 â‰¤ æƒé‡ < 0.7)**: è¥å…»è‰¯å¥½ï¼Œé€‚åˆé£Ÿç”¨\n-- **é€‚é‡é£Ÿç”¨ (0.3 â‰¤ æƒé‡ < 0.5)**: å¯ä»¥å°‘é‡é£Ÿç”¨\n+- **å¼ºçƒˆæ¨è (æƒé‡ â‰¥ 0.7)**: è¥å…»å‡è¡¡ä¸”ç¬¦åˆéœ€æ±‚  \n+- **æ¨è (0.5 â‰¤ æƒé‡ < 0.7)**: è¥å…»è‰¯å¥½ï¼Œé€‚åˆé£Ÿç”¨  \n+- **é€‚é‡é£Ÿç”¨ (0.3 â‰¤ æƒé‡ < 0.5)**: å¯ä»¥å°‘é‡é£Ÿç”¨  \n - **å°‘é‡å°è¯• (æƒé‡ < 0.3)**: å»ºè®®æœ¬é¤é¿å…æˆ–å°‘é‡å°è¯•\n \"\"\")\n \n # è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰\n if st.checkbox(\"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯\"):\n     st.markdown(\"### è¯·æ±‚æ•°æ®\")\n     st.json(st.session_state.request_data)\n-    \n\\ No newline at end of file\n     if st.session_state.recommendations:\n         st.markdown(\"### å®Œæ•´å“åº”\")\n-        st.json(st.session_state.recommendations)\n+        st.json(st.session_state.recommendations)\n"
                },
                {
                    "date": 1752483062216,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -163,10 +163,10 @@\n with main_container:\n     col1, col2 = st.columns([1, 1])\n \n     with col1:\n-        st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n \n+\n         for i, dish in enumerate(st.session_state.dishes):\n             col_name, col_weight, col_remove = st.columns([3, 1, 0.5])\n \n             with col_name:\n"
                },
                {
                    "date": 1752483068892,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -161,9 +161,9 @@\n main_container = st.container()\n \n with main_container:\n     col1, col2 = st.columns([1, 1])\n-\n+            st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n     with col1:\n \n \n         for i, dish in enumerate(st.session_state.dishes):\n"
                },
                {
                    "date": 1752483117367,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -161,38 +161,35 @@\n main_container = st.container()\n \n with main_container:\n     col1, col2 = st.columns([1, 1])\n-            st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n-    with col1:\n+st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n \n+for i, dish in enumerate(st.session_state.dishes):\n+    col_name, col_weight, col_remove = st.columns([3, 1, 0.5])\n \n-        for i, dish in enumerate(st.session_state.dishes):\n-            col_name, col_weight, col_remove = st.columns([3, 1, 0.5])\n+    with col_name:\n+        name = st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")\n+    with col_weight:\n+        weight = st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)\n+    with col_remove:\n+        if i > 0:\n+            if st.button(\"åˆ é™¤\", key=f\"remove_{i}\"):\n+                remove_dish(i)\n+                st.experimental_rerun()\n \n-            with col_name:\n-                name = st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")\n-            with col_weight:\n-                weight = st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)\n-            with col_remove:\n-                if i > 0:\n-                    if st.button(\"åˆ é™¤\", key=f\"remove_{i}\"):\n-                        remove_dish(i)\n-                        st.experimental_rerun()\n+    st.session_state.dishes[i][\"name\"] = name\n+    st.session_state.dishes[i][\"weight\"] = weight\n \n-            # æ›´æ–° session state\n-            st.session_state.dishes[i][\"name\"] = name\n-            st.session_state.dishes[i][\"weight\"] = weight\n+# æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n+st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n+if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n+    if submit_form():\n+        if call_backend_service():\n+            st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n+        else:\n+            st.session_state.recommendations = None\n \n-        st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n-\n-        if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n-            if submit_form():\n-                if call_backend_service():\n-                    st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n-                else:\n-                    st.session_state.recommendations = None\n-\n     with col2:\n         st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n         if st.session_state.recommendations:\n             recommendations = st.session_state.recommendations\n"
                },
                {
                    "date": 1752483124741,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -161,34 +161,34 @@\n main_container = st.container()\n \n with main_container:\n     col1, col2 = st.columns([1, 1])\n-st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n+    st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n \n-for i, dish in enumerate(st.session_state.dishes):\n-    col_name, col_weight, col_remove = st.columns([3, 1, 0.5])\n+    for i, dish in enumerate(st.session_state.dishes):\n+        col_name, col_weight, col_remove = st.columns([3, 1, 0.5])\n \n-    with col_name:\n-        name = st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")\n-    with col_weight:\n-        weight = st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)\n-    with col_remove:\n-        if i > 0:\n-            if st.button(\"åˆ é™¤\", key=f\"remove_{i}\"):\n-                remove_dish(i)\n-                st.experimental_rerun()\n+        with col_name:\n+            name = st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")\n+        with col_weight:\n+            weight = st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)\n+        with col_remove:\n+            if i > 0:\n+                if st.button(\"åˆ é™¤\", key=f\"remove_{i}\"):\n+                    remove_dish(i)\n+                    st.experimental_rerun()\n \n-    st.session_state.dishes[i][\"name\"] = name\n-    st.session_state.dishes[i][\"weight\"] = weight\n+        st.session_state.dishes[i][\"name\"] = name\n+        st.session_state.dishes[i][\"weight\"] = weight\n \n-# æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n-st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n-if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n-    if submit_form():\n-        if call_backend_service():\n-            st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n-        else:\n-            st.session_state.recommendations = None\n+    # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n+    st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n+    if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n+        if submit_form():\n+            if call_backend_service():\n+                st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n+            else:\n+                st.session_state.recommendations = None\n \n     with col2:\n         st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n         if st.session_state.recommendations:\n"
                },
                {
                    "date": 1752483193941,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -181,9 +181,9 @@\n         st.session_state.dishes[i][\"weight\"] = weight\n \n     # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n     st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n-    if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n+    if st.button(\"ç”Ÿæˆèœå“æ¨è\"):\n         if submit_form():\n             if call_backend_service():\n                 st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n             else:\n"
                },
                {
                    "date": 1752483199562,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -180,9 +180,9 @@\n         st.session_state.dishes[i][\"name\"] = name\n         st.session_state.dishes[i][\"weight\"] = weight\n \n     # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n-    st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n+    st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish)\n     if st.button(\"ç”Ÿæˆèœå“æ¨è\"):\n         if submit_form():\n             if call_backend_service():\n                 st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n"
                },
                {
                    "date": 1752483546504,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -180,10 +180,10 @@\n         st.session_state.dishes[i][\"name\"] = name\n         st.session_state.dishes[i][\"weight\"] = weight\n \n     # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n-    st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish)\n-    if st.button(\"ç”Ÿæˆèœå“æ¨è\"):\n+    st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n+    if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n         if submit_form():\n             if call_backend_service():\n                 st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n             else:\n"
                },
                {
                    "date": 1752484001244,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -181,9 +181,9 @@\n         st.session_state.dishes[i][\"weight\"] = weight\n \n     # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n     st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n-    if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n+    if st.button(\"ç”Ÿæˆèœå“æ¨è\"):\n         if submit_form():\n             if call_backend_service():\n                 st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n             else:\n"
                },
                {
                    "date": 1752484679969,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -148,14 +148,24 @@\n     st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n     st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n     st.number_input(\"èº«é«˜ (cm)\", min_value=50.0, max_value=250.0, key=\"height\", value=175.0, step=1.0)\n     st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.1)\n-    st.selectbox(\n+    \n+    # æ´»åŠ¨æ°´å¹³æ˜ å°„\n+    activity_options = {\n+        \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n+        \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\": \"b\",\n+        \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\": \"c\"\n+    }\n+    selected_activity_label = st.selectbox(\n         \"æ´»åŠ¨æ°´å¹³\",\n-        [\"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\", \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\", \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\"],\n-        key=\"activity_level\",\n+        list(activity_options.keys()),\n+        key=\"activity_level_label\",\n         index=1\n     )\n+    # å°†é€‰æ‹©çš„å€¼æ˜ å°„ä¸ºç®€å†™å½¢å¼\n+    st.session_state.activity_level = activity_options[selected_activity_label]\n+    \n     st.selectbox(\"é¤åˆ«\", [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], key=\"meal_type\", index=1)\n \n # ä¸»å†…å®¹åŒº\n main_container = st.container()\n@@ -180,9 +190,9 @@\n         st.session_state.dishes[i][\"name\"] = name\n         st.session_state.dishes[i][\"weight\"] = weight\n \n     # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n-    st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n+    st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish)\n     if st.button(\"ç”Ÿæˆèœå“æ¨è\"):\n         if submit_form():\n             if call_backend_service():\n                 st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n"
                },
                {
                    "date": 1752484697961,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -147,9 +147,9 @@\n     st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n     st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n     st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n     st.number_input(\"èº«é«˜ (cm)\", min_value=50.0, max_value=250.0, key=\"height\", value=175.0, step=1.0)\n-    st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.1)\n+    st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.5)\n     \n     # æ´»åŠ¨æ°´å¹³æ˜ å°„\n     activity_options = {\n         \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n"
                },
                {
                    "date": 1752484915045,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -246,44 +246,57 @@\n                             else:\n                                 st.warning(\"æ— è¥å…»æ•°æ®\")\n                         st.markdown(\"</div>\", unsafe_allow_html=True)\n \n-            with tab2:\n-                total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n-                if total_nutrition:\n-                    st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n-                    col1, col2, col3 = st.columns(3)\n-                    with col1:\n-                        st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                        st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                    with col2:\n-                        st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-                        st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                    with col3:\n-                        st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n-                        st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+with tab2:\n+    # æ•´é¤è¥å…»æ‘˜è¦\n+    total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n+    if total_nutrition:\n+        st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n \n-                    st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n-                    main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n-                    main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n-                    df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n-                    st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n+        # åœ¨æœ€å¤–å±‚å®¹å™¨ä¸­ä½¿ç”¨ columnsï¼Œé¿å…åµŒå¥—\n+        energy_col, protein_col, fat_col = st.columns(3)\n+        with energy_col:\n+            st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+        with protein_col:\n+            st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+        with fat_col:\n+            st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n \n-                    micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n-                    micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n-                    st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n-                    for nutrient, value in zip(micro_nutrients, micro_values):\n-                        st.markdown(f\"**{nutrient}**: {value:.1f}\")\n-                        max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n-                        percent = min(value / max_value, 1.0) if max_value > 0 else 0\n-                        st.markdown(f\"\"\"\n-                        <div class=\"nutrient-bar\">\n-                            <div class=\"nutrient-fill\" style=\"width: {percent*100}%;\"></div>\n-                        </div>\n-                        <div class=\"nutrient-value\">{value:.1f}</div>\n-                        \"\"\", unsafe_allow_html=True)\n-                else:\n-                    st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n+        carb_col, sodium_col, vc_col = st.columns(3)\n+        with carb_col:\n+            st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+        with sodium_col:\n+            st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n+        with vc_col:\n+            st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+\n+        # è¥å…»åˆ†å¸ƒå›¾è¡¨\n+        st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n+\n+        # ä¸»è¦è¥å…»ç´ \n+        main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n+        main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n+        df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n+        st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n+\n+        # å¾®é‡è¥å…»ç´ \n+        st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n+        micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n+        micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n+\n+        for nutrient, value in zip(micro_nutrients, micro_values):\n+            st.markdown(f\"**{nutrient}**: {value:.1f}\")\n+            max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n+            percent = min(value / max_value, 1.0) if max_value > 0 else 0\n+            st.markdown(f\"\"\"\n+                <div class=\"nutrient-bar\" style=\"height: 8px; background: #eee;\">\n+                    <div class=\"nutrient-fill\" style=\"width: {percent*100}%; background: #4caf50; height: 100%;\"></div>\n+                </div>\n+                <div class=\"nutrient-value\">{value:.1f}</div>\n+            \"\"\", unsafe_allow_html=True)\n+    else:\n+        st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n         else:\n             st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n \n # ä½¿ç”¨è¯´æ˜\n"
                },
                {
                    "date": 1752484924988,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -246,57 +246,57 @@\n                             else:\n                                 st.warning(\"æ— è¥å…»æ•°æ®\")\n                         st.markdown(\"</div>\", unsafe_allow_html=True)\n \n-with tab2:\n-    # æ•´é¤è¥å…»æ‘˜è¦\n-    total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n-    if total_nutrition:\n-        st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n+        with tab2:\n+            # æ•´é¤è¥å…»æ‘˜è¦\n+            total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n+            if total_nutrition:\n+                st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n \n-        # åœ¨æœ€å¤–å±‚å®¹å™¨ä¸­ä½¿ç”¨ columnsï¼Œé¿å…åµŒå¥—\n-        energy_col, protein_col, fat_col = st.columns(3)\n-        with energy_col:\n-            st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-        with protein_col:\n-            st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-        with fat_col:\n-            st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                # åœ¨æœ€å¤–å±‚å®¹å™¨ä¸­ä½¿ç”¨ columnsï¼Œé¿å…åµŒå¥—\n+                energy_col, protein_col, fat_col = st.columns(3)\n+                with energy_col:\n+                    st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                with protein_col:\n+                    st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+                with fat_col:\n+                    st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n \n-        carb_col, sodium_col, vc_col = st.columns(3)\n-        with carb_col:\n-            st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-        with sodium_col:\n-            st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n-        with vc_col:\n-            st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+                carb_col, sodium_col, vc_col = st.columns(3)\n+                with carb_col:\n+                    st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+                with sodium_col:\n+                    st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n+                with vc_col:\n+                    st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n \n-        # è¥å…»åˆ†å¸ƒå›¾è¡¨\n-        st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n+                # è¥å…»åˆ†å¸ƒå›¾è¡¨\n+                st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n \n-        # ä¸»è¦è¥å…»ç´ \n-        main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n-        main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n-        df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n-        st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n+                # ä¸»è¦è¥å…»ç´ \n+                main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n+                main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n+                df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n+                st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n \n-        # å¾®é‡è¥å…»ç´ \n-        st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n-        micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n-        micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n+                # å¾®é‡è¥å…»ç´ \n+                st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n+                micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n+                micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n \n-        for nutrient, value in zip(micro_nutrients, micro_values):\n-            st.markdown(f\"**{nutrient}**: {value:.1f}\")\n-            max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n-            percent = min(value / max_value, 1.0) if max_value > 0 else 0\n-            st.markdown(f\"\"\"\n-                <div class=\"nutrient-bar\" style=\"height: 8px; background: #eee;\">\n-                    <div class=\"nutrient-fill\" style=\"width: {percent*100}%; background: #4caf50; height: 100%;\"></div>\n-                </div>\n-                <div class=\"nutrient-value\">{value:.1f}</div>\n-            \"\"\", unsafe_allow_html=True)\n-    else:\n-        st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n+                for nutrient, value in zip(micro_nutrients, micro_values):\n+                    st.markdown(f\"**{nutrient}**: {value:.1f}\")\n+                    max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n+                    percent = min(value / max_value, 1.0) if max_value > 0 else 0\n+                    st.markdown(f\"\"\"\n+                        <div class=\"nutrient-bar\" style=\"height: 8px; background: #eee;\">\n+                            <div class=\"nutrient-fill\" style=\"width: {percent*100}%; background: #4caf50; height: 100%;\"></div>\n+                        </div>\n+                        <div class=\"nutrient-value\">{value:.1f}</div>\n+                    \"\"\", unsafe_allow_html=True)\n+            else:\n+                st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n         else:\n             st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n \n # ä½¿ç”¨è¯´æ˜\n"
                },
                {
                    "date": 1752484930761,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -246,57 +246,57 @@\n                             else:\n                                 st.warning(\"æ— è¥å…»æ•°æ®\")\n                         st.markdown(\"</div>\", unsafe_allow_html=True)\n \n-        with tab2:\n-            # æ•´é¤è¥å…»æ‘˜è¦\n-            total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n-            if total_nutrition:\n-                st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n+            with tab2:\n+                # æ•´é¤è¥å…»æ‘˜è¦\n+                total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n+                if total_nutrition:\n+                    st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n \n-                # åœ¨æœ€å¤–å±‚å®¹å™¨ä¸­ä½¿ç”¨ columnsï¼Œé¿å…åµŒå¥—\n-                energy_col, protein_col, fat_col = st.columns(3)\n-                with energy_col:\n-                    st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                with protein_col:\n-                    st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                with fat_col:\n-                    st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                    # åœ¨æœ€å¤–å±‚å®¹å™¨ä¸­ä½¿ç”¨ columnsï¼Œé¿å…åµŒå¥—\n+                    energy_col, protein_col, fat_col = st.columns(3)\n+                    with energy_col:\n+                        st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                    with protein_col:\n+                        st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+                    with fat_col:\n+                        st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n \n-                carb_col, sodium_col, vc_col = st.columns(3)\n-                with carb_col:\n-                    st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                with sodium_col:\n-                    st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n-                with vc_col:\n-                    st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+                    carb_col, sodium_col, vc_col = st.columns(3)\n+                    with carb_col:\n+                        st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+                    with sodium_col:\n+                        st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n+                    with vc_col:\n+                        st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n \n-                # è¥å…»åˆ†å¸ƒå›¾è¡¨\n-                st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n+                    # è¥å…»åˆ†å¸ƒå›¾è¡¨\n+                    st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n \n-                # ä¸»è¦è¥å…»ç´ \n-                main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n-                main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n-                df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n-                st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n+                    # ä¸»è¦è¥å…»ç´ \n+                    main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n+                    main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n+                    df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n+                    st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n \n-                # å¾®é‡è¥å…»ç´ \n-                st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n-                micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n-                micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n+                    # å¾®é‡è¥å…»ç´ \n+                    st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n+                    micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n+                    micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n \n-                for nutrient, value in zip(micro_nutrients, micro_values):\n-                    st.markdown(f\"**{nutrient}**: {value:.1f}\")\n-                    max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n-                    percent = min(value / max_value, 1.0) if max_value > 0 else 0\n-                    st.markdown(f\"\"\"\n-                        <div class=\"nutrient-bar\" style=\"height: 8px; background: #eee;\">\n-                            <div class=\"nutrient-fill\" style=\"width: {percent*100}%; background: #4caf50; height: 100%;\"></div>\n-                        </div>\n-                        <div class=\"nutrient-value\">{value:.1f}</div>\n-                    \"\"\", unsafe_allow_html=True)\n-            else:\n-                st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n+                    for nutrient, value in zip(micro_nutrients, micro_values):\n+                        st.markdown(f\"**{nutrient}**: {value:.1f}\")\n+                        max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n+                        percent = min(value / max_value, 1.0) if max_value > 0 else 0\n+                        st.markdown(f\"\"\"\n+                            <div class=\"nutrient-bar\" style=\"height: 8px; background: #eee;\">\n+                                <div class=\"nutrient-fill\" style=\"width: {percent*100}%; background: #4caf50; height: 100%;\"></div>\n+                            </div>\n+                            <div class=\"nutrient-value\">{value:.1f}</div>\n+                        \"\"\", unsafe_allow_html=True)\n+                else:\n+                    st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n         else:\n             st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n \n # ä½¿ç”¨è¯´æ˜\n"
                },
                {
                    "date": 1752484991973,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -147,9 +147,9 @@\n     st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n     st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n     st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n     st.number_input(\"èº«é«˜ (cm)\", min_value=50.0, max_value=250.0, key=\"height\", value=175.0, step=1.0)\n-    st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.5)\n+    st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.)\n     \n     # æ´»åŠ¨æ°´å¹³æ˜ å°„\n     activity_options = {\n         \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n@@ -247,53 +247,40 @@\n                                 st.warning(\"æ— è¥å…»æ•°æ®\")\n                         st.markdown(\"</div>\", unsafe_allow_html=True)\n \n             with tab2:\n-                # æ•´é¤è¥å…»æ‘˜è¦\n                 total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n                 if total_nutrition:\n                     st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n-\n-                    # åœ¨æœ€å¤–å±‚å®¹å™¨ä¸­ä½¿ç”¨ columnsï¼Œé¿å…åµŒå¥—\n-                    energy_col, protein_col, fat_col = st.columns(3)\n-                    with energy_col:\n+                    col1, col2, col3 = st.columns(3)\n+                    with col1:\n                         st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                    with protein_col:\n                         st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                    with fat_col:\n+                    with col2:\n                         st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-\n-                    carb_col, sodium_col, vc_col = st.columns(3)\n-                    with carb_col:\n                         st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                    with sodium_col:\n+                    with col3:\n                         st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n-                    with vc_col:\n                         st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n \n-                    # è¥å…»åˆ†å¸ƒå›¾è¡¨\n                     st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n-\n-                    # ä¸»è¦è¥å…»ç´ \n                     main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n                     main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n                     df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n                     st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n \n-                    # å¾®é‡è¥å…»ç´ \n-                    st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n                     micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n                     micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n-\n+                    st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n                     for nutrient, value in zip(micro_nutrients, micro_values):\n                         st.markdown(f\"**{nutrient}**: {value:.1f}\")\n                         max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n                         percent = min(value / max_value, 1.0) if max_value > 0 else 0\n                         st.markdown(f\"\"\"\n-                            <div class=\"nutrient-bar\" style=\"height: 8px; background: #eee;\">\n-                                <div class=\"nutrient-fill\" style=\"width: {percent*100}%; background: #4caf50; height: 100%;\"></div>\n-                            </div>\n-                            <div class=\"nutrient-value\">{value:.1f}</div>\n+                        <div class=\"nutrient-bar\">\n+                            <div class=\"nutrient-fill\" style=\"width: {percent*100}%;\"></div>\n+                        </div>\n+                        <div class=\"nutrient-value\">{value:.1f}</div>\n                         \"\"\", unsafe_allow_html=True)\n                 else:\n                     st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n         else:\n"
                },
                {
                    "date": 1752485141926,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,68 +2,26 @@\n import requests\n import time\n import json\n import pandas as pd\n-import numpy as np\n from datetime import datetime\n \n-# è®¾ç½®é¡µé¢é…ç½®\n+# é¡µé¢é…ç½®\n st.set_page_config(\n     page_title=\"æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n     page_icon=\"ğŸ²\",\n     layout=\"wide\",\n     initial_sidebar_state=\"expanded\"\n )\n \n-# è‡ªå®šä¹‰CSSæ ·å¼\n-st.markdown(\"\"\"\n-<style>\n-    .recommendation-card {\n-        border: 1px solid #e0e0e0;\n-        border-radius: 12px;\n-        padding: 15px;\n-        margin-bottom: 10px;\n-        background-color: #fafafa;\n-    }\n-    .high-weight {\n-        border-left: 6px solid #4CAF50;\n-    }\n-    .medium-weight {\n-        border-left: 6px solid #FFC107;\n-    }\n-    .low-weight {\n-        border-left: 6px solid #F44336;\n-    }\n-    .nutrient-bar {\n-        height: 10px;\n-        background-color: #f0f0f0;\n-        border-radius: 5px;\n-        overflow: hidden;\n-        margin-bottom: 4px;\n-    }\n-    .nutrient-fill {\n-        height: 100%;\n-        background-color: #4CAF50;\n-    }\n-    .nutrient-value {\n-        font-size: 12px;\n-        margin-bottom: 10px;\n-    }\n-</style>\n-\"\"\", unsafe_allow_html=True)\n+# æ ‡é¢˜\n+st.title(\"ğŸ² æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\")\n+st.markdown(\"åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è\")\n \n-# åº”ç”¨æ ‡é¢˜\n-st.markdown(\"\"\"\n-<div class=\"header\">\n-    <h1 style=\"text-align:center; margin:0;\">ğŸ² æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n-    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n-</div>\n-\"\"\", unsafe_allow_html=True)\n-\n-# åç«¯æœåŠ¡URL\n+# åç«¯åœ°å€\n BACKEND_URL = \"http://192.168.99.55:5000/recommend_dishes\"\n \n-# åˆå§‹åŒ–session state\n+# Session åˆå§‹åŒ–\n if 'dishes' not in st.session_state:\n     st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]\n if 'recommendations' not in st.session_state:\n     st.session_state.recommendations = None\n@@ -80,9 +38,9 @@\n def remove_dish(index):\n     if len(st.session_state.dishes) > 1:\n         st.session_state.dishes.pop(index)\n \n-# æäº¤è¡¨å•\n+# è¡¨å•éªŒè¯\n def submit_form():\n     required_fields = ['gender', 'age', 'height', 'weight', 'activity_level', 'meal_type']\n     if not all([st.session_state.get(field) for field in required_fields]):\n         st.error(\"è¯·å¡«å†™å®Œæ•´çš„ä¸ªäººä¿¡æ¯\")\n@@ -95,9 +53,9 @@\n             st.error(f\"èœå“ #{i+1} é‡é‡å¿…é¡»å¤§äº0\")\n             return False\n     return True\n \n-# è°ƒç”¨åç«¯æœåŠ¡\n+# è°ƒç”¨åç«¯\n def call_backend_service():\n     st.session_state.request_data = {\n         \"info\": {\n             \"æ€§åˆ«\": st.session_state.gender,\n@@ -119,9 +77,13 @@\n \n     try:\n         with st.spinner(\"æ­£åœ¨åˆ†ææ‚¨çš„è¥å…»éœ€æ±‚ï¼Œè¯·ç¨å€™...\"):\n             start_time = time.time()\n-            response = requests.post(BACKEND_URL, json=st.session_state.request_data, timeout=120)\n+            response = requests.post(\n+                BACKEND_URL,\n+                json=st.session_state.request_data,\n+                timeout=120\n+            )\n             end_time = time.time()\n             st.session_state.response_time = end_time - start_time\n \n             if response.status_code == 200:\n@@ -133,179 +95,104 @@\n                     st.error(f\"æœåŠ¡è¿”å›é”™è¯¯: {data.get('error', 'æœªçŸ¥é”™è¯¯')}\")\n             else:\n                 st.error(f\"è¯·æ±‚å¤±è´¥, çŠ¶æ€ç : {response.status_code}\")\n                 st.error(f\"é”™è¯¯ä¿¡æ¯: {response.text}\")\n-    except requests.exceptions.Timeout:\n-        st.error(\"è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•\")\n-    except requests.exceptions.ConnectionError:\n-        st.error(\"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\")\n     except Exception as e:\n-        st.error(f\"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}\")\n+        st.error(f\"è¯·æ±‚é”™è¯¯: {e}\")\n     return False\n \n-# å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n+# å·¦ä¾§è¾“å…¥\n with st.sidebar:\n-    st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n-    st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n-    st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n-    st.number_input(\"èº«é«˜ (cm)\", min_value=50.0, max_value=250.0, key=\"height\", value=175.0, step=1.0)\n-    st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.)\n-    \n-    # æ´»åŠ¨æ°´å¹³æ˜ å°„\n-    activity_options = {\n-        \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n-        \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\": \"b\",\n-        \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\": \"c\"\n-    }\n-    selected_activity_label = st.selectbox(\n-        \"æ´»åŠ¨æ°´å¹³\",\n-        list(activity_options.keys()),\n-        key=\"activity_level_label\",\n-        index=1\n-    )\n-    # å°†é€‰æ‹©çš„å€¼æ˜ å°„ä¸ºç®€å†™å½¢å¼\n-    st.session_state.activity_level = activity_options[selected_activity_label]\n-    \n-    st.selectbox(\"é¤åˆ«\", [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], key=\"meal_type\", index=1)\n+    st.header(\"ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n+    st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\")\n+    st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=25)\n+    st.number_input(\"èº«é«˜ (cm)\", min_value=50.0, max_value=250.0, key=\"height\", value=170.0)\n+    st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=60.0)\n+    st.selectbox(\"æ´»åŠ¨æ°´å¹³\", [\n+        \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\",\n+        \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\",\n+        \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\"\n+    ], key=\"activity_level\")\n+    st.selectbox(\"é¤åˆ«\", [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], key=\"meal_type\")\n \n-# ä¸»å†…å®¹åŒº\n-main_container = st.container()\n+# èœå“è¾“å…¥éƒ¨åˆ†\n+st.subheader(\"ğŸ½ï¸ èœå“ä¿¡æ¯\")\n+for i, dish in enumerate(st.session_state.dishes):\n+    col_name, col_weight, col_del = st.columns([3, 2, 1])\n+    with col_name:\n+        name = st.text_input(f\"èœå“ #{i+1}\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚ï¼šç•ªèŒ„ç‚’è›‹\")\n+    with col_weight:\n+        weight = st.number_input(\"é‡é‡(g)\", value=dish[\"weight\"], key=f\"dish_weight_{i}\", min_value=1.0, step=1.0)\n+    with col_del:\n+        if i > 0 and st.button(\"åˆ é™¤\", key=f\"del_{i}\"):\n+            remove_dish(i)\n+            st.experimental_rerun()\n+    st.session_state.dishes[i][\"name\"] = name\n+    st.session_state.dishes[i][\"weight\"] = weight\n \n-with main_container:\n-    col1, col2 = st.columns([1, 1])\n-    st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n+if st.button(\"â• æ·»åŠ èœå“\"):\n+    add_dish()\n+    st.experimental_rerun()\n \n-    for i, dish in enumerate(st.session_state.dishes):\n-        col_name, col_weight, col_remove = st.columns([3, 1, 0.5])\n+if st.button(\"ç”Ÿæˆèœå“æ¨è\"):\n+    if submit_form():\n+        if call_backend_service():\n+            st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n+        else:\n+            st.session_state.recommendations = None\n \n-        with col_name:\n-            name = st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")\n-        with col_weight:\n-            weight = st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)\n-        with col_remove:\n-            if i > 0:\n-                if st.button(\"åˆ é™¤\", key=f\"remove_{i}\"):\n-                    remove_dish(i)\n-                    st.experimental_rerun()\n+# æ¨èç»“æœå±•ç¤º\n+if st.session_state.recommendations:\n+    rec = st.session_state.recommendations\n+    st.markdown(\"---\")\n+    st.subheader(\"ğŸ“Š æ¨èç»“æœ\")\n+    st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”è€—æ—¶: {st.session_state.response_time:.2f} ç§’\")\n+    st.markdown(f\"**é¤åˆ«**: {rec.get('é¤åˆ«', 'åˆé¤')}  |  **æ±‚è§£çŠ¶æ€**: {rec.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n \n-        st.session_state.dishes[i][\"name\"] = name\n-        st.session_state.dishes[i][\"weight\"] = weight\n+    tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n \n-    # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n-    st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish)\n-    if st.button(\"ç”Ÿæˆèœå“æ¨è\"):\n-        if submit_form():\n-            if call_backend_service():\n-                st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n-            else:\n-                st.session_state.recommendations = None\n+    with tab1:\n+        for dish in rec.get(\"èœå“æ¨è\", []):\n+            name = dish.get(\"èœå“åç§°\", \"æœªçŸ¥\")\n+            weight = dish.get(\"æ¨èæƒé‡\", 0)\n+            reason = dish.get(\"åŸå› \", \"æ— æ¨èç†ç”±\")\n+            st.markdown(f\"### {name}\")\n+            st.markdown(f\"**æ¨èæƒé‡**: {weight:.2f}\")\n+            st.markdown(f\"**æ¨èç†ç”±**: {reason}\")\n+            with st.expander(\"è¥å…»è¯¦æƒ…\"):\n+                nutrition = dish.get(\"è¥å…»å€¼\", {})\n+                for key, value in nutrition.items():\n+                    st.write(f\"{key}: {value}\")\n \n-    with col2:\n-        st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n-        if st.session_state.recommendations:\n-            recommendations = st.session_state.recommendations\n-            st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n-            st.markdown(f\"**é¤åˆ«**: {recommendations.get('é¤åˆ«', 'åˆé¤')}\")\n-            st.markdown(f\"**æ±‚è§£çŠ¶æ€**: {recommendations.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n-            st.markdown(\"### èœå“æ¨è\")\n-            tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n+    with tab2:\n+        st.subheader(\"æ•´é¤è¥å…»æ‘˜è¦\")\n+        nutrition = rec.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n+        if nutrition:\n+            col1, col2, col3 = st.columns(3)\n+            with col1:\n+                st.metric(\"æ€»èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                st.metric(\"æ€»è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+            with col2:\n+                st.metric(\"æ€»è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+            with col3:\n+                st.metric(\"æ€»é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n+                st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n \n-            with tab1:\n-                for dish in recommendations.get(\"èœå“æ¨è\", []):\n-                    weight = dish.get(\"æ¨èæƒé‡\", 0)\n-                    if weight >= 0.7:\n-                        card_class = \"high-weight\"\n-                        recommendation_text = \"å¼ºçƒˆæ¨è\"\n-                    elif weight >= 0.5:\n-                        card_class = \"medium-weight\"\n-                        recommendation_text = \"æ¨è\"\n-                    elif weight >= 0.3:\n-                        card_class = \"medium-weight\"\n-                        recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n-                    else:\n-                        card_class = \"low-weight\"\n-                        recommendation_text = \"å°‘é‡å°è¯•\"\n+            st.markdown(\"### è¥å…»åˆ†å¸ƒå›¾\")\n+            keys = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n+            values = [nutrition.get(k, 0) for k in keys]\n+            df = pd.DataFrame({\"è¥å…»ç´ \": keys, \"å«é‡\": values})\n+            st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n \n-                    with st.container():\n-                        st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n-                        st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n-                        st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n-                        st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n-                        with st.expander(\"æŸ¥çœ‹è¥å…»è¯¦æƒ…\"):\n-                            nutrition = dish.get(\"è¥å…»å€¼\", {})\n-                            if nutrition:\n-                                col1, col2, col3 = st.columns(3)\n-                                with col1:\n-                                    st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                                    st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                                with col2:\n-                                    st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-                                    st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                                with col3:\n-                                    st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n-                                    st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n-                            else:\n-                                st.warning(\"æ— è¥å…»æ•°æ®\")\n-                        st.markdown(\"</div>\", unsafe_allow_html=True)\n-\n-            with tab2:\n-                total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n-                if total_nutrition:\n-                    st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n-                    col1, col2, col3 = st.columns(3)\n-                    with col1:\n-                        st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                        st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                    with col2:\n-                        st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-                        st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                    with col3:\n-                        st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n-                        st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n-\n-                    st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n-                    main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n-                    main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n-                    df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n-                    st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n-\n-                    micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n-                    micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n-                    st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n-                    for nutrient, value in zip(micro_nutrients, micro_values):\n-                        st.markdown(f\"**{nutrient}**: {value:.1f}\")\n-                        max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n-                        percent = min(value / max_value, 1.0) if max_value > 0 else 0\n-                        st.markdown(f\"\"\"\n-                        <div class=\"nutrient-bar\">\n-                            <div class=\"nutrient-fill\" style=\"width: {percent*100}%;\"></div>\n-                        </div>\n-                        <div class=\"nutrient-value\">{value:.1f}</div>\n-                        \"\"\", unsafe_allow_html=True)\n-                else:\n-                    st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n+            st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n+            micronutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n+            for k in micronutrients:\n+                v = nutrition.get(k, 0.0)\n+                st.write(f\"**{k}**: {v:.1f}\")\n         else:\n-            st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n+            st.warning(\"æ— æ•´é¤è¥å…»æ•°æ®\")\n \n-# ä½¿ç”¨è¯´æ˜\n-st.markdown(\"---\")\n-st.markdown(\"\"\"\n-### ä½¿ç”¨è¯´æ˜\n-1. åœ¨å·¦ä¾§å¡«å†™æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰ï¼‰\n-2. æ·»åŠ æ‚¨æƒ³è¯„ä¼°çš„èœå“ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰\n-3. ç‚¹å‡»\"ç”Ÿæˆèœå“æ¨è\"æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\n-4. æŸ¥çœ‹å³ä¾§çš„æ¨èç»“æœï¼Œäº†è§£æ¯é“èœçš„æ¨èç¨‹åº¦å’ŒåŸå› \n-\n-**æ¨èæƒé‡è¯´æ˜**:\n-- **å¼ºçƒˆæ¨è (æƒé‡ â‰¥ 0.7)**: è¥å…»å‡è¡¡ä¸”ç¬¦åˆéœ€æ±‚  \n-- **æ¨è (0.5 â‰¤ æƒé‡ < 0.7)**: è¥å…»è‰¯å¥½ï¼Œé€‚åˆé£Ÿç”¨  \n-- **é€‚é‡é£Ÿç”¨ (0.3 â‰¤ æƒé‡ < 0.5)**: å¯ä»¥å°‘é‡é£Ÿç”¨  \n-- **å°‘é‡å°è¯• (æƒé‡ < 0.3)**: å»ºè®®æœ¬é¤é¿å…æˆ–å°‘é‡å°è¯•\n-\"\"\")\n-\n # è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰\n if st.checkbox(\"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯\"):\n-    st.markdown(\"### è¯·æ±‚æ•°æ®\")\n     st.json(st.session_state.request_data)\n-    if st.session_state.recommendations:\n-        st.markdown(\"### å®Œæ•´å“åº”\")\n-        st.json(st.session_state.recommendations)\n+    st.json(st.session_state.recommendations)\n"
                },
                {
                    "date": 1752485152917,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,26 +2,68 @@\n import requests\n import time\n import json\n import pandas as pd\n+import numpy as np\n from datetime import datetime\n \n-# é¡µé¢é…ç½®\n+# è®¾ç½®é¡µé¢é…ç½®\n st.set_page_config(\n     page_title=\"æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n     page_icon=\"ğŸ²\",\n     layout=\"wide\",\n     initial_sidebar_state=\"expanded\"\n )\n \n-# æ ‡é¢˜\n-st.title(\"ğŸ² æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\")\n-st.markdown(\"åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è\")\n+# è‡ªå®šä¹‰CSSæ ·å¼\n+st.markdown(\"\"\"\n+<style>\n+    .recommendation-card {\n+        border: 1px solid #e0e0e0;\n+        border-radius: 12px;\n+        padding: 15px;\n+        margin-bottom: 10px;\n+        background-color: #fafafa;\n+    }\n+    .high-weight {\n+        border-left: 6px solid #4CAF50;\n+    }\n+    .medium-weight {\n+        border-left: 6px solid #FFC107;\n+    }\n+    .low-weight {\n+        border-left: 6px solid #F44336;\n+    }\n+    .nutrient-bar {\n+        height: 10px;\n+        background-color: #f0f0f0;\n+        border-radius: 5px;\n+        overflow: hidden;\n+        margin-bottom: 4px;\n+    }\n+    .nutrient-fill {\n+        height: 100%;\n+        background-color: #4CAF50;\n+    }\n+    .nutrient-value {\n+        font-size: 12px;\n+        margin-bottom: 10px;\n+    }\n+</style>\n+\"\"\", unsafe_allow_html=True)\n \n-# åç«¯åœ°å€\n+# åº”ç”¨æ ‡é¢˜\n+st.markdown(\"\"\"\n+<div class=\"header\">\n+    <h1 style=\"text-align:center; margin:0;\">ğŸ² æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n+    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n+</div>\n+\"\"\", unsafe_allow_html=True)\n+\n+# åç«¯æœåŠ¡URL\n BACKEND_URL = \"http://192.168.99.55:5000/recommend_dishes\"\n \n-# Session åˆå§‹åŒ–\n+# åˆå§‹åŒ–session state\n if 'dishes' not in st.session_state:\n     st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]\n if 'recommendations' not in st.session_state:\n     st.session_state.recommendations = None\n@@ -38,9 +80,9 @@\n def remove_dish(index):\n     if len(st.session_state.dishes) > 1:\n         st.session_state.dishes.pop(index)\n \n-# è¡¨å•éªŒè¯\n+# æäº¤è¡¨å•\n def submit_form():\n     required_fields = ['gender', 'age', 'height', 'weight', 'activity_level', 'meal_type']\n     if not all([st.session_state.get(field) for field in required_fields]):\n         st.error(\"è¯·å¡«å†™å®Œæ•´çš„ä¸ªäººä¿¡æ¯\")\n@@ -53,9 +95,9 @@\n             st.error(f\"èœå“ #{i+1} é‡é‡å¿…é¡»å¤§äº0\")\n             return False\n     return True\n \n-# è°ƒç”¨åç«¯\n+# è°ƒç”¨åç«¯æœåŠ¡\n def call_backend_service():\n     st.session_state.request_data = {\n         \"info\": {\n             \"æ€§åˆ«\": st.session_state.gender,\n@@ -77,13 +119,9 @@\n \n     try:\n         with st.spinner(\"æ­£åœ¨åˆ†ææ‚¨çš„è¥å…»éœ€æ±‚ï¼Œè¯·ç¨å€™...\"):\n             start_time = time.time()\n-            response = requests.post(\n-                BACKEND_URL,\n-                json=st.session_state.request_data,\n-                timeout=120\n-            )\n+            response = requests.post(BACKEND_URL, json=st.session_state.request_data, timeout=120)\n             end_time = time.time()\n             st.session_state.response_time = end_time - start_time\n \n             if response.status_code == 200:\n@@ -95,104 +133,179 @@\n                     st.error(f\"æœåŠ¡è¿”å›é”™è¯¯: {data.get('error', 'æœªçŸ¥é”™è¯¯')}\")\n             else:\n                 st.error(f\"è¯·æ±‚å¤±è´¥, çŠ¶æ€ç : {response.status_code}\")\n                 st.error(f\"é”™è¯¯ä¿¡æ¯: {response.text}\")\n+    except requests.exceptions.Timeout:\n+        st.error(\"è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•\")\n+    except requests.exceptions.ConnectionError:\n+        st.error(\"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\")\n     except Exception as e:\n-        st.error(f\"è¯·æ±‚é”™è¯¯: {e}\")\n+        st.error(f\"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}\")\n     return False\n \n-# å·¦ä¾§è¾“å…¥\n+# å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n with st.sidebar:\n-    st.header(\"ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n-    st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\")\n-    st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=25)\n-    st.number_input(\"èº«é«˜ (cm)\", min_value=50.0, max_value=250.0, key=\"height\", value=170.0)\n-    st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=60.0)\n-    st.selectbox(\"æ´»åŠ¨æ°´å¹³\", [\n-        \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\",\n-        \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\",\n-        \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\"\n-    ], key=\"activity_level\")\n-    st.selectbox(\"é¤åˆ«\", [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], key=\"meal_type\")\n+    st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n+    st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n+    st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n+    st.number_input(\"èº«é«˜ (cm)\", min_value=50.0, max_value=250.0, key=\"height\", value=175.0, step=1.0)\n+    st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.5)\n+    \n+    # æ´»åŠ¨æ°´å¹³æ˜ å°„\n+    activity_options = {\n+        \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n+        \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\": \"b\",\n+        \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\": \"c\"\n+    }\n+    selected_activity_label = st.selectbox(\n+        \"æ´»åŠ¨æ°´å¹³\",\n+        list(activity_options.keys()),\n+        key=\"activity_level_label\",\n+        index=1\n+    )\n+    # å°†é€‰æ‹©çš„å€¼æ˜ å°„ä¸ºç®€å†™å½¢å¼\n+    st.session_state.activity_level = activity_options[selected_activity_label]\n+    \n+    st.selectbox(\"é¤åˆ«\", [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], key=\"meal_type\", index=1)\n \n-# èœå“è¾“å…¥éƒ¨åˆ†\n-st.subheader(\"ğŸ½ï¸ èœå“ä¿¡æ¯\")\n-for i, dish in enumerate(st.session_state.dishes):\n-    col_name, col_weight, col_del = st.columns([3, 2, 1])\n-    with col_name:\n-        name = st.text_input(f\"èœå“ #{i+1}\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚ï¼šç•ªèŒ„ç‚’è›‹\")\n-    with col_weight:\n-        weight = st.number_input(\"é‡é‡(g)\", value=dish[\"weight\"], key=f\"dish_weight_{i}\", min_value=1.0, step=1.0)\n-    with col_del:\n-        if i > 0 and st.button(\"åˆ é™¤\", key=f\"del_{i}\"):\n-            remove_dish(i)\n-            st.experimental_rerun()\n-    st.session_state.dishes[i][\"name\"] = name\n-    st.session_state.dishes[i][\"weight\"] = weight\n+# ä¸»å†…å®¹åŒº\n+main_container = st.container()\n \n-if st.button(\"â• æ·»åŠ èœå“\"):\n-    add_dish()\n-    st.experimental_rerun()\n+with main_container:\n+    col1, col2 = st.columns([1, 1])\n+    st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n \n-if st.button(\"ç”Ÿæˆèœå“æ¨è\"):\n-    if submit_form():\n-        if call_backend_service():\n-            st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n-        else:\n-            st.session_state.recommendations = None\n+    for i, dish in enumerate(st.session_state.dishes):\n+        col_name, col_weight, col_remove = st.columns([3, 1, 0.5])\n \n-# æ¨èç»“æœå±•ç¤º\n-if st.session_state.recommendations:\n-    rec = st.session_state.recommendations\n-    st.markdown(\"---\")\n-    st.subheader(\"ğŸ“Š æ¨èç»“æœ\")\n-    st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”è€—æ—¶: {st.session_state.response_time:.2f} ç§’\")\n-    st.markdown(f\"**é¤åˆ«**: {rec.get('é¤åˆ«', 'åˆé¤')}  |  **æ±‚è§£çŠ¶æ€**: {rec.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n+        with col_name:\n+            name = st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")\n+        with col_weight:\n+            weight = st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)\n+        with col_remove:\n+            if i > 0:\n+                if st.button(\"åˆ é™¤\", key=f\"remove_{i}\"):\n+                    remove_dish(i)\n+                    st.experimental_rerun()\n \n-    tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n+        st.session_state.dishes[i][\"name\"] = name\n+        st.session_state.dishes[i][\"weight\"] = weight\n \n-    with tab1:\n-        for dish in rec.get(\"èœå“æ¨è\", []):\n-            name = dish.get(\"èœå“åç§°\", \"æœªçŸ¥\")\n-            weight = dish.get(\"æ¨èæƒé‡\", 0)\n-            reason = dish.get(\"åŸå› \", \"æ— æ¨èç†ç”±\")\n-            st.markdown(f\"### {name}\")\n-            st.markdown(f\"**æ¨èæƒé‡**: {weight:.2f}\")\n-            st.markdown(f\"**æ¨èç†ç”±**: {reason}\")\n-            with st.expander(\"è¥å…»è¯¦æƒ…\"):\n-                nutrition = dish.get(\"è¥å…»å€¼\", {})\n-                for key, value in nutrition.items():\n-                    st.write(f\"{key}: {value}\")\n+    # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n+    st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish)\n+    if st.button(\"ç”Ÿæˆèœå“æ¨è\"):\n+        if submit_form():\n+            if call_backend_service():\n+                st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n+            else:\n+                st.session_state.recommendations = None\n \n-    with tab2:\n-        st.subheader(\"æ•´é¤è¥å…»æ‘˜è¦\")\n-        nutrition = rec.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n-        if nutrition:\n-            col1, col2, col3 = st.columns(3)\n-            with col1:\n-                st.metric(\"æ€»èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                st.metric(\"æ€»è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-            with col2:\n-                st.metric(\"æ€»è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-                st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-            with col3:\n-                st.metric(\"æ€»é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n-                st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+    with col2:\n+        st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n+        if st.session_state.recommendations:\n+            recommendations = st.session_state.recommendations\n+            st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n+            st.markdown(f\"**é¤åˆ«**: {recommendations.get('é¤åˆ«', 'åˆé¤')}\")\n+            st.markdown(f\"**æ±‚è§£çŠ¶æ€**: {recommendations.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n+            st.markdown(\"### èœå“æ¨è\")\n+            tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n \n-            st.markdown(\"### è¥å…»åˆ†å¸ƒå›¾\")\n-            keys = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n-            values = [nutrition.get(k, 0) for k in keys]\n-            df = pd.DataFrame({\"è¥å…»ç´ \": keys, \"å«é‡\": values})\n-            st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n+            with tab1:\n+                for dish in recommendations.get(\"èœå“æ¨è\", []):\n+                    weight = dish.get(\"æ¨èæƒé‡\", 0)\n+                    if weight >= 0.7:\n+                        card_class = \"high-weight\"\n+                        recommendation_text = \"å¼ºçƒˆæ¨è\"\n+                    elif weight >= 0.5:\n+                        card_class = \"medium-weight\"\n+                        recommendation_text = \"æ¨è\"\n+                    elif weight >= 0.3:\n+                        card_class = \"medium-weight\"\n+                        recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n+                    else:\n+                        card_class = \"low-weight\"\n+                        recommendation_text = \"å°‘é‡å°è¯•\"\n \n-            st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n-            micronutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n-            for k in micronutrients:\n-                v = nutrition.get(k, 0.0)\n-                st.write(f\"**{k}**: {v:.1f}\")\n+                    with st.container():\n+                        st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n+                        st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n+                        st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n+                        st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n+                        with st.expander(\"æŸ¥çœ‹è¥å…»è¯¦æƒ…\"):\n+                            nutrition = dish.get(\"è¥å…»å€¼\", {})\n+                            if nutrition:\n+                                col1, col2, col3 = st.columns(3)\n+                                with col1:\n+                                    st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                                    st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+                                with col2:\n+                                    st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                                    st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+                                with col3:\n+                                    st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n+                                    st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+                            else:\n+                                st.warning(\"æ— è¥å…»æ•°æ®\")\n+                        st.markdown(\"</div>\", unsafe_allow_html=True)\n+\n+            with tab2:\n+                total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n+                if total_nutrition:\n+                    st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n+                    col1, col2, col3 = st.columns(3)\n+                    with col1:\n+                        st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                        st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+                    with col2:\n+                        st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                        st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+                    with col3:\n+                        st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n+                        st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+\n+                    st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n+                    main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n+                    main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n+                    df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n+                    st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n+\n+                    micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n+                    micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n+                    st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n+                    for nutrient, value in zip(micro_nutrients, micro_values):\n+                        st.markdown(f\"**{nutrient}**: {value:.1f}\")\n+                        max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n+                        percent = min(value / max_value, 1.0) if max_value > 0 else 0\n+                        st.markdown(f\"\"\"\n+                        <div class=\"nutrient-bar\">\n+                            <div class=\"nutrient-fill\" style=\"width: {percent*100}%;\"></div>\n+                        </div>\n+                        <div class=\"nutrient-value\">{value:.1f}</div>\n+                        \"\"\", unsafe_allow_html=True)\n+                else:\n+                    st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n         else:\n-            st.warning(\"æ— æ•´é¤è¥å…»æ•°æ®\")\n+            st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n \n+# ä½¿ç”¨è¯´æ˜\n+st.markdown(\"---\")\n+st.markdown(\"\"\"\n+### ä½¿ç”¨è¯´æ˜\n+1. åœ¨å·¦ä¾§å¡«å†™æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰ï¼‰\n+2. æ·»åŠ æ‚¨æƒ³è¯„ä¼°çš„èœå“ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰\n+3. ç‚¹å‡»\"ç”Ÿæˆèœå“æ¨è\"æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\n+4. æŸ¥çœ‹å³ä¾§çš„æ¨èç»“æœï¼Œäº†è§£æ¯é“èœçš„æ¨èç¨‹åº¦å’ŒåŸå› \n+\n+**æ¨èæƒé‡è¯´æ˜**:\n+- **å¼ºçƒˆæ¨è (æƒé‡ â‰¥ 0.7)**: è¥å…»å‡è¡¡ä¸”ç¬¦åˆéœ€æ±‚  \n+- **æ¨è (0.5 â‰¤ æƒé‡ < 0.7)**: è¥å…»è‰¯å¥½ï¼Œé€‚åˆé£Ÿç”¨  \n+- **é€‚é‡é£Ÿç”¨ (0.3 â‰¤ æƒé‡ < 0.5)**: å¯ä»¥å°‘é‡é£Ÿç”¨  \n+- **å°‘é‡å°è¯• (æƒé‡ < 0.3)**: å»ºè®®æœ¬é¤é¿å…æˆ–å°‘é‡å°è¯•\n+\"\"\")\n+\n # è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰\n if st.checkbox(\"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯\"):\n+    st.markdown(\"### è¯·æ±‚æ•°æ®\")\n     st.json(st.session_state.request_data)\n-    st.json(st.session_state.recommendations)\n+    if st.session_state.recommendations:\n+        st.markdown(\"### å®Œæ•´å“åº”\")\n+        st.json(st.session_state.recommendations)\n"
                },
                {
                    "date": 1752485195173,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,311 +1,311 @@\n-import streamlit as st\n-import requests\n-import time\n-import json\n-import pandas as pd\n-import numpy as np\n-from datetime import datetime\n+# import streamlit as st\n+# import requests\n+# import time\n+# import json\n+# import pandas as pd\n+# import numpy as np\n+# from datetime import datetime\n \n-# è®¾ç½®é¡µé¢é…ç½®\n-st.set_page_config(\n-    page_title=\"æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n-    page_icon=\"ğŸ²\",\n-    layout=\"wide\",\n-    initial_sidebar_state=\"expanded\"\n-)\n+# # è®¾ç½®é¡µé¢é…ç½®\n+# st.set_page_config(\n+#     page_title=\"æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n+#     page_icon=\"ğŸ²\",\n+#     layout=\"wide\",\n+#     initial_sidebar_state=\"expanded\"\n+# )\n \n-# è‡ªå®šä¹‰CSSæ ·å¼\n-st.markdown(\"\"\"\n-<style>\n-    .recommendation-card {\n-        border: 1px solid #e0e0e0;\n-        border-radius: 12px;\n-        padding: 15px;\n-        margin-bottom: 10px;\n-        background-color: #fafafa;\n-    }\n-    .high-weight {\n-        border-left: 6px solid #4CAF50;\n-    }\n-    .medium-weight {\n-        border-left: 6px solid #FFC107;\n-    }\n-    .low-weight {\n-        border-left: 6px solid #F44336;\n-    }\n-    .nutrient-bar {\n-        height: 10px;\n-        background-color: #f0f0f0;\n-        border-radius: 5px;\n-        overflow: hidden;\n-        margin-bottom: 4px;\n-    }\n-    .nutrient-fill {\n-        height: 100%;\n-        background-color: #4CAF50;\n-    }\n-    .nutrient-value {\n-        font-size: 12px;\n-        margin-bottom: 10px;\n-    }\n-</style>\n-\"\"\", unsafe_allow_html=True)\n+# # è‡ªå®šä¹‰CSSæ ·å¼\n+# st.markdown(\"\"\"\n+# <style>\n+#     .recommendation-card {\n+#         border: 1px solid #e0e0e0;\n+#         border-radius: 12px;\n+#         padding: 15px;\n+#         margin-bottom: 10px;\n+#         background-color: #fafafa;\n+#     }\n+#     .high-weight {\n+#         border-left: 6px solid #4CAF50;\n+#     }\n+#     .medium-weight {\n+#         border-left: 6px solid #FFC107;\n+#     }\n+#     .low-weight {\n+#         border-left: 6px solid #F44336;\n+#     }\n+#     .nutrient-bar {\n+#         height: 10px;\n+#         background-color: #f0f0f0;\n+#         border-radius: 5px;\n+#         overflow: hidden;\n+#         margin-bottom: 4px;\n+#     }\n+#     .nutrient-fill {\n+#         height: 100%;\n+#         background-color: #4CAF50;\n+#     }\n+#     .nutrient-value {\n+#         font-size: 12px;\n+#         margin-bottom: 10px;\n+#     }\n+# </style>\n+# \"\"\", unsafe_allow_html=True)\n \n-# åº”ç”¨æ ‡é¢˜\n-st.markdown(\"\"\"\n-<div class=\"header\">\n-    <h1 style=\"text-align:center; margin:0;\">ğŸ² æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n-    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n-</div>\n-\"\"\", unsafe_allow_html=True)\n+# # åº”ç”¨æ ‡é¢˜\n+# st.markdown(\"\"\"\n+# <div class=\"header\">\n+#     <h1 style=\"text-align:center; margin:0;\">ğŸ² æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n+#     <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n+# </div>\n+# \"\"\", unsafe_allow_html=True)\n \n-# åç«¯æœåŠ¡URL\n-BACKEND_URL = \"http://192.168.99.55:5000/recommend_dishes\"\n+# # åç«¯æœåŠ¡URL\n+# BACKEND_URL = \"http://192.168.99.55:5000/recommend_dishes\"\n \n-# åˆå§‹åŒ–session state\n-if 'dishes' not in st.session_state:\n-    st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]\n-if 'recommendations' not in st.session_state:\n-    st.session_state.recommendations = None\n-if 'request_data' not in st.session_state:\n-    st.session_state.request_data = None\n-if 'response_time' not in st.session_state:\n-    st.session_state.response_time = None\n+# # åˆå§‹åŒ–session state\n+# if 'dishes' not in st.session_state:\n+#     st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]\n+# if 'recommendations' not in st.session_state:\n+#     st.session_state.recommendations = None\n+# if 'request_data' not in st.session_state:\n+#     st.session_state.request_data = None\n+# if 'response_time' not in st.session_state:\n+#     st.session_state.response_time = None\n \n-# æ·»åŠ èœå“\n-def add_dish():\n-    st.session_state.dishes.append({\"name\": \"\", \"weight\": 100.0})\n+# # æ·»åŠ èœå“\n+# def add_dish():\n+#     st.session_state.dishes.append({\"name\": \"\", \"weight\": 100.0})\n \n-# åˆ é™¤èœå“\n-def remove_dish(index):\n-    if len(st.session_state.dishes) > 1:\n-        st.session_state.dishes.pop(index)\n+# # åˆ é™¤èœå“\n+# def remove_dish(index):\n+#     if len(st.session_state.dishes) > 1:\n+#         st.session_state.dishes.pop(index)\n \n-# æäº¤è¡¨å•\n-def submit_form():\n-    required_fields = ['gender', 'age', 'height', 'weight', 'activity_level', 'meal_type']\n-    if not all([st.session_state.get(field) for field in required_fields]):\n-        st.error(\"è¯·å¡«å†™å®Œæ•´çš„ä¸ªäººä¿¡æ¯\")\n-        return False\n-    for i, dish in enumerate(st.session_state.dishes):\n-        if not dish[\"name\"]:\n-            st.error(f\"èœå“ #{i+1} åç§°ä¸èƒ½ä¸ºç©º\")\n-            return False\n-        if dish[\"weight\"] <= 0:\n-            st.error(f\"èœå“ #{i+1} é‡é‡å¿…é¡»å¤§äº0\")\n-            return False\n-    return True\n+# # æäº¤è¡¨å•\n+# def submit_form():\n+#     required_fields = ['gender', 'age', 'height', 'weight', 'activity_level', 'meal_type']\n+#     if not all([st.session_state.get(field) for field in required_fields]):\n+#         st.error(\"è¯·å¡«å†™å®Œæ•´çš„ä¸ªäººä¿¡æ¯\")\n+#         return False\n+#     for i, dish in enumerate(st.session_state.dishes):\n+#         if not dish[\"name\"]:\n+#             st.error(f\"èœå“ #{i+1} åç§°ä¸èƒ½ä¸ºç©º\")\n+#             return False\n+#         if dish[\"weight\"] <= 0:\n+#             st.error(f\"èœå“ #{i+1} é‡é‡å¿…é¡»å¤§äº0\")\n+#             return False\n+#     return True\n \n-# è°ƒç”¨åç«¯æœåŠ¡\n-def call_backend_service():\n-    st.session_state.request_data = {\n-        \"info\": {\n-            \"æ€§åˆ«\": st.session_state.gender,\n-            \"å¹´é¾„\": st.session_state.age,\n-            \"èº«é«˜\": st.session_state.height,\n-            \"ä½“é‡\": st.session_state.weight,\n-            \"activity_level\": st.session_state.activity_level\n-        },\n-        \"data\": {\n-            \"é¤åˆ«\": st.session_state.meal_type,\n-            \"èœå“åç§°\": [\n-                {\n-                    \"é£Ÿå“åç§°\": dish[\"name\"],\n-                    \"é£Ÿå“å…‹æ•°\": dish[\"weight\"]\n-                } for dish in st.session_state.dishes\n-            ]\n-        }\n-    }\n+# # è°ƒç”¨åç«¯æœåŠ¡\n+# def call_backend_service():\n+#     st.session_state.request_data = {\n+#         \"info\": {\n+#             \"æ€§åˆ«\": st.session_state.gender,\n+#             \"å¹´é¾„\": st.session_state.age,\n+#             \"èº«é«˜\": st.session_state.height,\n+#             \"ä½“é‡\": st.session_state.weight,\n+#             \"activity_level\": st.session_state.activity_level\n+#         },\n+#         \"data\": {\n+#             \"é¤åˆ«\": st.session_state.meal_type,\n+#             \"èœå“åç§°\": [\n+#                 {\n+#                     \"é£Ÿå“åç§°\": dish[\"name\"],\n+#                     \"é£Ÿå“å…‹æ•°\": dish[\"weight\"]\n+#                 } for dish in st.session_state.dishes\n+#             ]\n+#         }\n+#     }\n \n-    try:\n-        with st.spinner(\"æ­£åœ¨åˆ†ææ‚¨çš„è¥å…»éœ€æ±‚ï¼Œè¯·ç¨å€™...\"):\n-            start_time = time.time()\n-            response = requests.post(BACKEND_URL, json=st.session_state.request_data, timeout=120)\n-            end_time = time.time()\n-            st.session_state.response_time = end_time - start_time\n+#     try:\n+#         with st.spinner(\"æ­£åœ¨åˆ†ææ‚¨çš„è¥å…»éœ€æ±‚ï¼Œè¯·ç¨å€™...\"):\n+#             start_time = time.time()\n+#             response = requests.post(BACKEND_URL, json=st.session_state.request_data, timeout=120)\n+#             end_time = time.time()\n+#             st.session_state.response_time = end_time - start_time\n \n-            if response.status_code == 200:\n-                data = response.json()\n-                if data.get(\"success\"):\n-                    st.session_state.recommendations = data[\"result\"]\n-                    return True\n-                else:\n-                    st.error(f\"æœåŠ¡è¿”å›é”™è¯¯: {data.get('error', 'æœªçŸ¥é”™è¯¯')}\")\n-            else:\n-                st.error(f\"è¯·æ±‚å¤±è´¥, çŠ¶æ€ç : {response.status_code}\")\n-                st.error(f\"é”™è¯¯ä¿¡æ¯: {response.text}\")\n-    except requests.exceptions.Timeout:\n-        st.error(\"è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•\")\n-    except requests.exceptions.ConnectionError:\n-        st.error(\"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\")\n-    except Exception as e:\n-        st.error(f\"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}\")\n-    return False\n+#             if response.status_code == 200:\n+#                 data = response.json()\n+#                 if data.get(\"success\"):\n+#                     st.session_state.recommendations = data[\"result\"]\n+#                     return True\n+#                 else:\n+#                     st.error(f\"æœåŠ¡è¿”å›é”™è¯¯: {data.get('error', 'æœªçŸ¥é”™è¯¯')}\")\n+#             else:\n+#                 st.error(f\"è¯·æ±‚å¤±è´¥, çŠ¶æ€ç : {response.status_code}\")\n+#                 st.error(f\"é”™è¯¯ä¿¡æ¯: {response.text}\")\n+#     except requests.exceptions.Timeout:\n+#         st.error(\"è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•\")\n+#     except requests.exceptions.ConnectionError:\n+#         st.error(\"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\")\n+#     except Exception as e:\n+#         st.error(f\"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}\")\n+#     return False\n \n-# å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n-with st.sidebar:\n-    st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n-    st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n-    st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n-    st.number_input(\"èº«é«˜ (cm)\", min_value=50.0, max_value=250.0, key=\"height\", value=175.0, step=1.0)\n-    st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.5)\n+# # å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n+# with st.sidebar:\n+#     st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n+#     st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n+#     st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n+#     st.number_input(\"èº«é«˜ (cm)\", min_value=50.0, max_value=250.0, key=\"height\", value=175.0, step=1.0)\n+#     st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.5)\n     \n-    # æ´»åŠ¨æ°´å¹³æ˜ å°„\n-    activity_options = {\n-        \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n-        \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\": \"b\",\n-        \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\": \"c\"\n-    }\n-    selected_activity_label = st.selectbox(\n-        \"æ´»åŠ¨æ°´å¹³\",\n-        list(activity_options.keys()),\n-        key=\"activity_level_label\",\n-        index=1\n-    )\n-    # å°†é€‰æ‹©çš„å€¼æ˜ å°„ä¸ºç®€å†™å½¢å¼\n-    st.session_state.activity_level = activity_options[selected_activity_label]\n+#     # æ´»åŠ¨æ°´å¹³æ˜ å°„\n+#     activity_options = {\n+#         \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n+#         \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\": \"b\",\n+#         \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\": \"c\"\n+#     }\n+#     selected_activity_label = st.selectbox(\n+#         \"æ´»åŠ¨æ°´å¹³\",\n+#         list(activity_options.keys()),\n+#         key=\"activity_level_label\",\n+#         index=1\n+#     )\n+#     # å°†é€‰æ‹©çš„å€¼æ˜ å°„ä¸ºç®€å†™å½¢å¼\n+#     st.session_state.activity_level = activity_options[selected_activity_label]\n     \n-    st.selectbox(\"é¤åˆ«\", [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], key=\"meal_type\", index=1)\n+#     st.selectbox(\"é¤åˆ«\", [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], key=\"meal_type\", index=1)\n \n-# ä¸»å†…å®¹åŒº\n-main_container = st.container()\n+# # ä¸»å†…å®¹åŒº\n+# main_container = st.container()\n \n-with main_container:\n-    col1, col2 = st.columns([1, 1])\n-    st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n+# with main_container:\n+#     col1, col2 = st.columns([1, 1])\n+#     st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n \n-    for i, dish in enumerate(st.session_state.dishes):\n-        col_name, col_weight, col_remove = st.columns([3, 1, 0.5])\n+#     for i, dish in enumerate(st.session_state.dishes):\n+#         col_name, col_weight, col_remove = st.columns([3, 1, 0.5])\n \n-        with col_name:\n-            name = st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")\n-        with col_weight:\n-            weight = st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)\n-        with col_remove:\n-            if i > 0:\n-                if st.button(\"åˆ é™¤\", key=f\"remove_{i}\"):\n-                    remove_dish(i)\n-                    st.experimental_rerun()\n+#         with col_name:\n+#             name = st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")\n+#         with col_weight:\n+#             weight = st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)\n+#         with col_remove:\n+#             if i > 0:\n+#                 if st.button(\"åˆ é™¤\", key=f\"remove_{i}\"):\n+#                     remove_dish(i)\n+#                     st.experimental_rerun()\n \n-        st.session_state.dishes[i][\"name\"] = name\n-        st.session_state.dishes[i][\"weight\"] = weight\n+#         st.session_state.dishes[i][\"name\"] = name\n+#         st.session_state.dishes[i][\"weight\"] = weight\n \n-    # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n-    st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish)\n-    if st.button(\"ç”Ÿæˆèœå“æ¨è\"):\n-        if submit_form():\n-            if call_backend_service():\n-                st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n-            else:\n-                st.session_state.recommendations = None\n+#     # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n+#     st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish)\n+#     if st.button(\"ç”Ÿæˆèœå“æ¨è\"):\n+#         if submit_form():\n+#             if call_backend_service():\n+#                 st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n+#             else:\n+#                 st.session_state.recommendations = None\n \n-    with col2:\n-        st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n-        if st.session_state.recommendations:\n-            recommendations = st.session_state.recommendations\n-            st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n-            st.markdown(f\"**é¤åˆ«**: {recommendations.get('é¤åˆ«', 'åˆé¤')}\")\n-            st.markdown(f\"**æ±‚è§£çŠ¶æ€**: {recommendations.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n-            st.markdown(\"### èœå“æ¨è\")\n-            tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n+#     with col2:\n+#         st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n+#         if st.session_state.recommendations:\n+#             recommendations = st.session_state.recommendations\n+#             st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n+#             st.markdown(f\"**é¤åˆ«**: {recommendations.get('é¤åˆ«', 'åˆé¤')}\")\n+#             st.markdown(f\"**æ±‚è§£çŠ¶æ€**: {recommendations.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n+#             st.markdown(\"### èœå“æ¨è\")\n+#             tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n \n-            with tab1:\n-                for dish in recommendations.get(\"èœå“æ¨è\", []):\n-                    weight = dish.get(\"æ¨èæƒé‡\", 0)\n-                    if weight >= 0.7:\n-                        card_class = \"high-weight\"\n-                        recommendation_text = \"å¼ºçƒˆæ¨è\"\n-                    elif weight >= 0.5:\n-                        card_class = \"medium-weight\"\n-                        recommendation_text = \"æ¨è\"\n-                    elif weight >= 0.3:\n-                        card_class = \"medium-weight\"\n-                        recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n-                    else:\n-                        card_class = \"low-weight\"\n-                        recommendation_text = \"å°‘é‡å°è¯•\"\n+#             with tab1:\n+#                 for dish in recommendations.get(\"èœå“æ¨è\", []):\n+#                     weight = dish.get(\"æ¨èæƒé‡\", 0)\n+#                     if weight >= 0.7:\n+#                         card_class = \"high-weight\"\n+#                         recommendation_text = \"å¼ºçƒˆæ¨è\"\n+#                     elif weight >= 0.5:\n+#                         card_class = \"medium-weight\"\n+#                         recommendation_text = \"æ¨è\"\n+#                     elif weight >= 0.3:\n+#                         card_class = \"medium-weight\"\n+#                         recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n+#                     else:\n+#                         card_class = \"low-weight\"\n+#                         recommendation_text = \"å°‘é‡å°è¯•\"\n \n-                    with st.container():\n-                        st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n-                        st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n-                        st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n-                        st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n-                        with st.expander(\"æŸ¥çœ‹è¥å…»è¯¦æƒ…\"):\n-                            nutrition = dish.get(\"è¥å…»å€¼\", {})\n-                            if nutrition:\n-                                col1, col2, col3 = st.columns(3)\n-                                with col1:\n-                                    st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                                    st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                                with col2:\n-                                    st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-                                    st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                                with col3:\n-                                    st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n-                                    st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n-                            else:\n-                                st.warning(\"æ— è¥å…»æ•°æ®\")\n-                        st.markdown(\"</div>\", unsafe_allow_html=True)\n+#                     with st.container():\n+#                         st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n+#                         st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n+#                         st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n+#                         st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n+#                         with st.expander(\"æŸ¥çœ‹è¥å…»è¯¦æƒ…\"):\n+#                             nutrition = dish.get(\"è¥å…»å€¼\", {})\n+#                             if nutrition:\n+#                                 col1, col2, col3 = st.columns(3)\n+#                                 with col1:\n+#                                     st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+#                                     st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+#                                 with col2:\n+#                                     st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+#                                     st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+#                                 with col3:\n+#                                     st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n+#                                     st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+#                             else:\n+#                                 st.warning(\"æ— è¥å…»æ•°æ®\")\n+#                         st.markdown(\"</div>\", unsafe_allow_html=True)\n \n-            with tab2:\n-                total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n-                if total_nutrition:\n-                    st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n-                    col1, col2, col3 = st.columns(3)\n-                    with col1:\n-                        st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                        st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                    with col2:\n-                        st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-                        st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                    with col3:\n-                        st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n-                        st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+#             with tab2:\n+#                 total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n+#                 if total_nutrition:\n+#                     st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n+#                     col1, col2, col3 = st.columns(3)\n+#                     with col1:\n+#                         st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+#                         st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+#                     with col2:\n+#                         st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+#                         st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+#                     with col3:\n+#                         st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n+#                         st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n \n-                    st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n-                    main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n-                    main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n-                    df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n-                    st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n+#                     st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n+#                     main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n+#                     main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n+#                     df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n+#                     st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n \n-                    micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n-                    micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n-                    st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n-                    for nutrient, value in zip(micro_nutrients, micro_values):\n-                        st.markdown(f\"**{nutrient}**: {value:.1f}\")\n-                        max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n-                        percent = min(value / max_value, 1.0) if max_value > 0 else 0\n-                        st.markdown(f\"\"\"\n-                        <div class=\"nutrient-bar\">\n-                            <div class=\"nutrient-fill\" style=\"width: {percent*100}%;\"></div>\n-                        </div>\n-                        <div class=\"nutrient-value\">{value:.1f}</div>\n-                        \"\"\", unsafe_allow_html=True)\n-                else:\n-                    st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n-        else:\n-            st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n+#                     micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n+#                     micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n+#                     st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n+#                     for nutrient, value in zip(micro_nutrients, micro_values):\n+#                         st.markdown(f\"**{nutrient}**: {value:.1f}\")\n+#                         max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n+#                         percent = min(value / max_value, 1.0) if max_value > 0 else 0\n+#                         st.markdown(f\"\"\"\n+#                         <div class=\"nutrient-bar\">\n+#                             <div class=\"nutrient-fill\" style=\"width: {percent*100}%;\"></div>\n+#                         </div>\n+#                         <div class=\"nutrient-value\">{value:.1f}</div>\n+#                         \"\"\", unsafe_allow_html=True)\n+#                 else:\n+#                     st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n+#         else:\n+#             st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n \n-# ä½¿ç”¨è¯´æ˜\n-st.markdown(\"---\")\n-st.markdown(\"\"\"\n-### ä½¿ç”¨è¯´æ˜\n-1. åœ¨å·¦ä¾§å¡«å†™æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰ï¼‰\n-2. æ·»åŠ æ‚¨æƒ³è¯„ä¼°çš„èœå“ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰\n-3. ç‚¹å‡»\"ç”Ÿæˆèœå“æ¨è\"æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\n-4. æŸ¥çœ‹å³ä¾§çš„æ¨èç»“æœï¼Œäº†è§£æ¯é“èœçš„æ¨èç¨‹åº¦å’ŒåŸå› \n+# # ä½¿ç”¨è¯´æ˜\n+# st.markdown(\"---\")\n+# st.markdown(\"\"\"\n+# ### ä½¿ç”¨è¯´æ˜\n+# 1. åœ¨å·¦ä¾§å¡«å†™æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰ï¼‰\n+# 2. æ·»åŠ æ‚¨æƒ³è¯„ä¼°çš„èœå“ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰\n+# 3. ç‚¹å‡»\"ç”Ÿæˆèœå“æ¨è\"æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\n+# 4. æŸ¥çœ‹å³ä¾§çš„æ¨èç»“æœï¼Œäº†è§£æ¯é“èœçš„æ¨èç¨‹åº¦å’ŒåŸå› \n \n-**æ¨èæƒé‡è¯´æ˜**:\n-- **å¼ºçƒˆæ¨è (æƒé‡ â‰¥ 0.7)**: è¥å…»å‡è¡¡ä¸”ç¬¦åˆéœ€æ±‚  \n-- **æ¨è (0.5 â‰¤ æƒé‡ < 0.7)**: è¥å…»è‰¯å¥½ï¼Œé€‚åˆé£Ÿç”¨  \n-- **é€‚é‡é£Ÿç”¨ (0.3 â‰¤ æƒé‡ < 0.5)**: å¯ä»¥å°‘é‡é£Ÿç”¨  \n-- **å°‘é‡å°è¯• (æƒé‡ < 0.3)**: å»ºè®®æœ¬é¤é¿å…æˆ–å°‘é‡å°è¯•\n-\"\"\")\n+# **æ¨èæƒé‡è¯´æ˜**:\n+# - **å¼ºçƒˆæ¨è (æƒé‡ â‰¥ 0.7)**: è¥å…»å‡è¡¡ä¸”ç¬¦åˆéœ€æ±‚  \n+# - **æ¨è (0.5 â‰¤ æƒé‡ < 0.7)**: è¥å…»è‰¯å¥½ï¼Œé€‚åˆé£Ÿç”¨  \n+# - **é€‚é‡é£Ÿç”¨ (0.3 â‰¤ æƒé‡ < 0.5)**: å¯ä»¥å°‘é‡é£Ÿç”¨  \n+# - **å°‘é‡å°è¯• (æƒé‡ < 0.3)**: å»ºè®®æœ¬é¤é¿å…æˆ–å°‘é‡å°è¯•\n+# \"\"\")\n \n-# è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰\n-if st.checkbox(\"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯\"):\n-    st.markdown(\"### è¯·æ±‚æ•°æ®\")\n-    st.json(st.session_state.request_data)\n-    if st.session_state.recommendations:\n-        st.markdown(\"### å®Œæ•´å“åº”\")\n-        st.json(st.session_state.recommendations)\n+# # è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰\n+# if st.checkbox(\"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯\"):\n+#     st.markdown(\"### è¯·æ±‚æ•°æ®\")\n+#     st.json(st.session_state.request_data)\n+#     if st.session_state.recommendations:\n+#         st.markdown(\"### å®Œæ•´å“åº”\")\n+#         st.json(st.session_state.recommendations)\n"
                },
                {
                    "date": 1752485209175,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -308,4 +308,427 @@\n #     st.json(st.session_state.request_data)\n #     if st.session_state.recommendations:\n #         st.markdown(\"### å®Œæ•´å“åº”\")\n #         st.json(st.session_state.recommendations)\n+import streamlit as st\n+import requests\n+import time\n+import json\n+import pandas as pd\n+import numpy as np\n+from datetime import datetime\n+\n+# è®¾ç½®é¡µé¢é…ç½®\n+st.set_page_config(\n+    page_title=\"æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n+    page_icon=\"ğŸ²\",\n+    layout=\"wide\",\n+    initial_sidebar_state=\"expanded\"\n+)\n+\n+# è‡ªå®šä¹‰CSSæ ·å¼\n+st.markdown(\"\"\"\n+<style>\n+    .header {\n+        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);\n+        color: white;\n+        padding: 2rem;\n+        border-radius: 0 0 20px 20px;\n+        margin-bottom: 2rem;\n+    }\n+    .recommendation-card {\n+        border: 1px solid #e0e0e0;\n+        border-radius: 12px;\n+        padding: 15px;\n+        margin-bottom: 10px;\n+        background-color: #fafafa;\n+    }\n+    .high-weight {\n+        border-left: 6px solid #4CAF50;\n+    }\n+    .medium-weight {\n+        border-left: 6px solid #FFC107;\n+    }\n+    .low-weight {\n+        border-left: 6px solid #F44336;\n+    }\n+    .nutrient-bar {\n+        height: 10px;\n+        background-color: #f0f0f0;\n+        border-radius: 5px;\n+        overflow: hidden;\n+        margin-bottom: 4px;\n+    }\n+    .nutrient-fill {\n+        height: 100%;\n+        background-color: #4CAF50;\n+    }\n+    .nutrient-value {\n+        font-size: 12px;\n+        margin-bottom: 10px;\n+    }\n+    .nutrient-grid {\n+        display: grid;\n+        grid-template-columns: repeat(3, 1fr);\n+        gap: 15px;\n+        margin-top: 15px;\n+    }\n+    .nutrient-item {\n+        background: #f8f9fa;\n+        border-radius: 8px;\n+        padding: 12px;\n+        text-align: center;\n+        box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n+    }\n+    .nutrient-title {\n+        font-weight: 600;\n+        margin-bottom: 5px;\n+    }\n+    .nutrient-value-display {\n+        font-size: 18px;\n+        font-weight: bold;\n+    }\n+    .nutrient-unit {\n+        font-size: 12px;\n+        color: #666;\n+    }\n+    .dish-row {\n+        display: flex;\n+        margin-bottom: 15px;\n+    }\n+    .dish-name {\n+        flex: 3;\n+        margin-right: 10px;\n+    }\n+    .dish-weight {\n+        flex: 1;\n+        margin-right: 10px;\n+    }\n+    .dish-remove {\n+        flex: 0.5;\n+    }\n+</style>\n+\"\"\", unsafe_allow_html=True)\n+\n+# åº”ç”¨æ ‡é¢˜\n+st.markdown(\"\"\"\n+<div class=\"header\">\n+    <h1 style=\"text-align:center; margin:0;\">ğŸ² æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n+    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n+</div>\n+\"\"\", unsafe_allow_html=True)\n+\n+# åç«¯æœåŠ¡URL\n+BACKEND_URL = \"http://192.168.99.55:5000/recommend_dishes\"\n+\n+# åˆå§‹åŒ–session state\n+if 'dishes' not in st.session_state:\n+    st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]\n+if 'recommendations' not in st.session_state:\n+    st.session_state.recommendations = None\n+if 'request_data' not in st.session_state:\n+    st.session_state.request_data = None\n+if 'response_time' not in st.session_state:\n+    st.session_state.response_time = None\n+\n+# æ·»åŠ èœå“\n+def add_dish():\n+    st.session_state.dishes.append({\"name\": \"\", \"weight\": 100.0})\n+\n+# åˆ é™¤èœå“\n+def remove_dish(index):\n+    if len(st.session_state.dishes) > 1:\n+        st.session_state.dishes.pop(index)\n+        st.experimental_rerun()\n+\n+# æäº¤è¡¨å•\n+def submit_form():\n+    required_fields = ['gender', 'age', 'height', 'weight', 'activity_level', 'meal_type']\n+    if not all([st.session_state.get(field) for field in required_fields]):\n+        st.error(\"è¯·å¡«å†™å®Œæ•´çš„ä¸ªäººä¿¡æ¯\")\n+        return False\n+    for i, dish in enumerate(st.session_state.dishes):\n+        if not dish[\"name\"]:\n+            st.error(f\"èœå“ #{i+1} åç§°ä¸èƒ½ä¸ºç©º\")\n+            return False\n+        if dish[\"weight\"] <= 0:\n+            st.error(f\"èœå“ #{i+1} é‡é‡å¿…é¡»å¤§äº0\")\n+            return False\n+    return True\n+\n+# è°ƒç”¨åç«¯æœåŠ¡\n+def call_backend_service():\n+    st.session_state.request_data = {\n+        \"info\": {\n+            \"æ€§åˆ«\": st.session_state.gender,\n+            \"å¹´é¾„\": st.session_state.age,\n+            \"èº«é«˜\": st.session_state.height,\n+            \"ä½“é‡\": st.session_state.weight,\n+            \"activity_level\": st.session_state.activity_level\n+        },\n+        \"data\": {\n+            \"é¤åˆ«\": st.session_state.meal_type,\n+            \"èœå“åç§°\": [\n+                {\n+                    \"é£Ÿå“åç§°\": dish[\"name\"],\n+                    \"é£Ÿå“å…‹æ•°\": dish[\"weight\"]\n+                } for dish in st.session_state.dishes\n+            ]\n+        }\n+    }\n+\n+    try:\n+        with st.spinner(\"æ­£åœ¨åˆ†ææ‚¨çš„è¥å…»éœ€æ±‚ï¼Œè¯·ç¨å€™...\"):\n+            start_time = time.time()\n+            response = requests.post(BACKEND_URL, json=st.session_state.request_data, timeout=120)\n+            end_time = time.time()\n+            st.session_state.response_time = end_time - start_time\n+\n+            if response.status_code == 200:\n+                data = response.json()\n+                if data.get(\"success\"):\n+                    st.session_state.recommendations = data[\"result\"]\n+                    return True\n+                else:\n+                    st.error(f\"æœåŠ¡è¿”å›é”™è¯¯: {data.get('error', 'æœªçŸ¥é”™è¯¯')}\")\n+            else:\n+                st.error(f\"è¯·æ±‚å¤±è´¥, çŠ¶æ€ç : {response.status_code}\")\n+                st.error(f\"é”™è¯¯ä¿¡æ¯: {response.text}\")\n+    except requests.exceptions.Timeout:\n+        st.error(\"è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•\")\n+    except requests.exceptions.ConnectionError:\n+        st.error(\"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\")\n+    except Exception as e:\n+        st.error(f\"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}\")\n+    return False\n+\n+# å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n+with st.sidebar:\n+    st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n+    st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n+    st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n+    st.number_input(\"èº«é«˜ (cm)\", min_value=50.0, max_value=250.0, key=\"height\", value=175.0, step=1.0)\n+    st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.1)\n+    \n+    # æ´»åŠ¨æ°´å¹³æ˜ å°„\n+    activity_options = {\n+        \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n+        \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\": \"b\",\n+        \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\": \"c\"\n+    }\n+    selected_activity_label = st.selectbox(\n+        \"æ´»åŠ¨æ°´å¹³\",\n+        list(activity_options.keys()),\n+        key=\"activity_level_label\",\n+        index=1\n+    )\n+    # å°†é€‰æ‹©çš„å€¼æ˜ å°„ä¸ºç®€å†™å½¢å¼\n+    st.session_state.activity_level = activity_options[selected_activity_label]\n+    \n+    st.selectbox(\"é¤åˆ«\", [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], key=\"meal_type\", index=1)\n+\n+# ä¸»å†…å®¹åŒº\n+main_container = st.container()\n+\n+with main_container:\n+    col1, col2 = st.columns([1, 1])\n+    \n+    with col1:\n+        st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n+        \n+        for i, dish in enumerate(st.session_state.dishes):\n+            # ä½¿ç”¨HTML/CSSåˆ›å»ºç±»ä¼¼åˆ—çš„æ•ˆæœ\n+            st.markdown(f\"\"\"\n+            <div class=\"dish-row\">\n+                <div class=\"dish-name\">\n+                    {st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")._repr_html_()}\n+                </div>\n+                <div class=\"dish-weight\">\n+                    {st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)._repr_html_()}\n+                </div>\n+                <div class=\"dish-remove\">\n+            \"\"\", unsafe_allow_html=True)\n+            \n+            # åˆ é™¤æŒ‰é’®ï¼ˆä¸æ˜¯ç¬¬ä¸€ä¸ªèœå“æ—¶æ˜¾ç¤ºï¼‰\n+            if i > 0:\n+                st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n+            \n+            st.markdown(\"</div></div>\", unsafe_allow_html=True)\n+        \n+        # æ·»åŠ èœå“æŒ‰é’®\n+        st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish)\n+        \n+        # æäº¤æŒ‰é’®\n+        if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n+            if submit_form():\n+                if call_backend_service():\n+                    st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n+                else:\n+                    st.session_state.recommendations = None\n+    \n+    with col2:\n+        st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n+        \n+        if st.session_state.recommendations:\n+            recommendations = st.session_state.recommendations\n+            st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n+            st.markdown(f\"**é¤åˆ«**: {recommendations.get('é¤åˆ«', 'åˆé¤')}\")\n+            st.markdown(f\"**æ±‚è§£çŠ¶æ€**: {recommendations.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n+            st.markdown(\"### èœå“æ¨è\")\n+            tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n+\n+            with tab1:\n+                for dish in recommendations.get(\"èœå“æ¨è\", []):\n+                    weight = dish.get(\"æ¨èæƒé‡\", 0)\n+                    if weight >= 0.7:\n+                        card_class = \"high-weight\"\n+                        recommendation_text = \"å¼ºçƒˆæ¨è\"\n+                    elif weight >= 0.5:\n+                        card_class = \"medium-weight\"\n+                        recommendation_text = \"æ¨è\"\n+                    elif weight >= 0.3:\n+                        card_class = \"medium-weight\"\n+                        recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n+                    else:\n+                        card_class = \"low-weight\"\n+                        recommendation_text = \"å°‘é‡å°è¯•\"\n+\n+                    with st.container():\n+                        st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n+                        st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n+                        st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n+                        st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n+                        \n+                        with st.expander(\"æŸ¥çœ‹è¥å…»è¯¦æƒ…\"):\n+                            nutrition = dish.get(\"è¥å…»å€¼\", {})\n+                            if nutrition:\n+                                st.markdown(\"\"\"\n+                                <style>\n+                                .nutrient-grid {\n+                                    display: grid;\n+                                    grid-template-columns: repeat(3, 1fr);\n+                                    gap: 15px;\n+                                    margin-top: 15px;\n+                                }\n+                                .nutrient-item {\n+                                    background: #f8f9fa;\n+                                    border-radius: 8px;\n+                                    padding: 12px;\n+                                    text-align: center;\n+                                    box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n+                                }\n+                                .nutrient-title {\n+                                    font-weight: 600;\n+                                    margin-bottom: 5px;\n+                                }\n+                                .nutrient-value-display {\n+                                    font-size: 18px;\n+                                    font-weight: bold;\n+                                }\n+                                .nutrient-unit {\n+                                    font-size: 12px;\n+                                    color: #666;\n+                                }\n+                                </style>\n+                                \"\"\", unsafe_allow_html=True)\n+                                \n+                                st.markdown(f\"\"\"\n+                                <div class=\"nutrient-grid\">\n+                                    <div class=\"nutrient-item\">\n+                                        <div class=\"nutrient-title\">èƒ½é‡</div>\n+                                        <div class=\"nutrient-value-display\">{nutrition.get('èƒ½é‡', 0):.1f}</div>\n+                                        <div class=\"nutrient-unit\">kcal</div>\n+                                    </div>\n+                                    <div class=\"nutrient-item\">\n+                                        <div class=\"nutrient-title\">è›‹ç™½è´¨</div>\n+                                        <div class=\"nutrient-value-display\">{nutrition.get('è›‹ç™½è´¨', 0):.1f}</div>\n+                                        <div class=\"nutrient-unit\">g</div>\n+                                    </div>\n+                                    <div class=\"nutrient-item\">\n+                                        <div class=\"nutrient-title\">è„‚è‚ª</div>\n+                                        <div class=\"nutrient-value-display\">{nutrition.get('è„‚è‚ª', 0):.1f}</div>\n+                                        <div class=\"nutrient-unit\">g</div>\n+                                    </div>\n+                                    <div class=\"nutrient-item\">\n+                                        <div class=\"nutrient-title\">ç¢³æ°´åŒ–åˆç‰©</div>\n+                                        <div class=\"nutrient-value-display\">{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f}</div>\n+                                        <div class=\"nutrient-unit\">g</div>\n+                                    </div>\n+                                    <div class=\"nutrient-item\">\n+                                        <div class=\"nutrient-title\">é’ </div>\n+                                        <div class=\"nutrient-value-display\">{nutrition.get('é’ ', 0):.1f}</div>\n+                                        <div class=\"nutrient-unit\">mg</div>\n+                                    </div>\n+                                    <div class=\"nutrient-item\">\n+                                        <div class=\"nutrient-title\">ç»´ç”Ÿç´ C</div>\n+                                        <div class=\"nutrient-value-display\">{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f}</div>\n+                                        <div class=\"nutrient-unit\">mg</div>\n+                                    </div>\n+                                </div>\n+                                \"\"\", unsafe_allow_html=True)\n+                            else:\n+                                st.warning(\"æ— è¥å…»æ•°æ®\")\n+                        \n+                        st.markdown(\"</div>\", unsafe_allow_html=True)\n+\n+            with tab2:\n+                total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n+                if total_nutrition:\n+                    st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n+                    col1, col2, col3 = st.columns(3)\n+                    with col1:\n+                        st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                        st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+                    with col2:\n+                        st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                        st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+                    with col3:\n+                        st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n+                        st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+\n+                    st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n+                    main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n+                    main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n+                    df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n+                    st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n+\n+                    micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n+                    micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n+                    st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n+                    for nutrient, value in zip(micro_nutrients, micro_values):\n+                        st.markdown(f\"**{nutrient}**: {value:.1f}\")\n+                        max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n+                        percent = min(value / max_value, 1.0) if max_value > 0 else 0\n+                        st.markdown(f\"\"\"\n+                        <div class=\"nutrient-bar\">\n+                            <div class=\"nutrient-fill\" style=\"width: {percent*100}%;\"></div>\n+                        </div>\n+                        <div class=\"nutrient-value\">{value:.1f}</div>\n+                        \"\"\", unsafe_allow_html=True)\n+                else:\n+                    st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n+        else:\n+            st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n+\n+# ä½¿ç”¨è¯´æ˜\n+st.markdown(\"---\")\n+st.markdown(\"\"\"\n+### ä½¿ç”¨è¯´æ˜\n+1. åœ¨å·¦ä¾§å¡«å†™æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰ï¼‰\n+2. æ·»åŠ æ‚¨æƒ³è¯„ä¼°çš„èœå“ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰\n+3. ç‚¹å‡»\"ç”Ÿæˆèœå“æ¨è\"æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\n+4. æŸ¥çœ‹å³ä¾§çš„æ¨èç»“æœï¼Œäº†è§£æ¯é“èœçš„æ¨èç¨‹åº¦å’ŒåŸå› \n+\n+**æ¨èæƒé‡è¯´æ˜**:\n+- **å¼ºçƒˆæ¨è (æƒé‡ â‰¥ 0.7)**: è¥å…»å‡è¡¡ä¸”ç¬¦åˆéœ€æ±‚  \n+- **æ¨è (0.5 â‰¤ æƒé‡ < 0.7)**: è¥å…»è‰¯å¥½ï¼Œé€‚åˆé£Ÿç”¨  \n+- **é€‚é‡é£Ÿç”¨ (0.3 â‰¤ æƒé‡ < 0.5)**: å¯ä»¥å°‘é‡é£Ÿç”¨  \n+- **å°‘é‡å°è¯• (æƒé‡ < 0.3)**: å»ºè®®æœ¬é¤é¿å…æˆ–å°‘é‡å°è¯•\n+\"\"\")\n+\n+# è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰\n+if st.checkbox(\"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯\"):\n+    st.markdown(\"### è¯·æ±‚æ•°æ®\")\n+    st.json(st.session_state.request_data)\n+    if st.session_state.recommendations:\n+        st.markdown(\"### å®Œæ•´å“åº”\")\n+        st.json(st.session_state.recommendations)\n\\ No newline at end of file\n"
                },
                {
                    "date": 1752485225988,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,315 +1,4 @@\n-# import streamlit as st\n-# import requests\n-# import time\n-# import json\n-# import pandas as pd\n-# import numpy as np\n-# from datetime import datetime\n-\n-# # è®¾ç½®é¡µé¢é…ç½®\n-# st.set_page_config(\n-#     page_title=\"æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n-#     page_icon=\"ğŸ²\",\n-#     layout=\"wide\",\n-#     initial_sidebar_state=\"expanded\"\n-# )\n-\n-# # è‡ªå®šä¹‰CSSæ ·å¼\n-# st.markdown(\"\"\"\n-# <style>\n-#     .recommendation-card {\n-#         border: 1px solid #e0e0e0;\n-#         border-radius: 12px;\n-#         padding: 15px;\n-#         margin-bottom: 10px;\n-#         background-color: #fafafa;\n-#     }\n-#     .high-weight {\n-#         border-left: 6px solid #4CAF50;\n-#     }\n-#     .medium-weight {\n-#         border-left: 6px solid #FFC107;\n-#     }\n-#     .low-weight {\n-#         border-left: 6px solid #F44336;\n-#     }\n-#     .nutrient-bar {\n-#         height: 10px;\n-#         background-color: #f0f0f0;\n-#         border-radius: 5px;\n-#         overflow: hidden;\n-#         margin-bottom: 4px;\n-#     }\n-#     .nutrient-fill {\n-#         height: 100%;\n-#         background-color: #4CAF50;\n-#     }\n-#     .nutrient-value {\n-#         font-size: 12px;\n-#         margin-bottom: 10px;\n-#     }\n-# </style>\n-# \"\"\", unsafe_allow_html=True)\n-\n-# # åº”ç”¨æ ‡é¢˜\n-# st.markdown(\"\"\"\n-# <div class=\"header\">\n-#     <h1 style=\"text-align:center; margin:0;\">ğŸ² æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n-#     <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n-# </div>\n-# \"\"\", unsafe_allow_html=True)\n-\n-# # åç«¯æœåŠ¡URL\n-# BACKEND_URL = \"http://192.168.99.55:5000/recommend_dishes\"\n-\n-# # åˆå§‹åŒ–session state\n-# if 'dishes' not in st.session_state:\n-#     st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]\n-# if 'recommendations' not in st.session_state:\n-#     st.session_state.recommendations = None\n-# if 'request_data' not in st.session_state:\n-#     st.session_state.request_data = None\n-# if 'response_time' not in st.session_state:\n-#     st.session_state.response_time = None\n-\n-# # æ·»åŠ èœå“\n-# def add_dish():\n-#     st.session_state.dishes.append({\"name\": \"\", \"weight\": 100.0})\n-\n-# # åˆ é™¤èœå“\n-# def remove_dish(index):\n-#     if len(st.session_state.dishes) > 1:\n-#         st.session_state.dishes.pop(index)\n-\n-# # æäº¤è¡¨å•\n-# def submit_form():\n-#     required_fields = ['gender', 'age', 'height', 'weight', 'activity_level', 'meal_type']\n-#     if not all([st.session_state.get(field) for field in required_fields]):\n-#         st.error(\"è¯·å¡«å†™å®Œæ•´çš„ä¸ªäººä¿¡æ¯\")\n-#         return False\n-#     for i, dish in enumerate(st.session_state.dishes):\n-#         if not dish[\"name\"]:\n-#             st.error(f\"èœå“ #{i+1} åç§°ä¸èƒ½ä¸ºç©º\")\n-#             return False\n-#         if dish[\"weight\"] <= 0:\n-#             st.error(f\"èœå“ #{i+1} é‡é‡å¿…é¡»å¤§äº0\")\n-#             return False\n-#     return True\n-\n-# # è°ƒç”¨åç«¯æœåŠ¡\n-# def call_backend_service():\n-#     st.session_state.request_data = {\n-#         \"info\": {\n-#             \"æ€§åˆ«\": st.session_state.gender,\n-#             \"å¹´é¾„\": st.session_state.age,\n-#             \"èº«é«˜\": st.session_state.height,\n-#             \"ä½“é‡\": st.session_state.weight,\n-#             \"activity_level\": st.session_state.activity_level\n-#         },\n-#         \"data\": {\n-#             \"é¤åˆ«\": st.session_state.meal_type,\n-#             \"èœå“åç§°\": [\n-#                 {\n-#                     \"é£Ÿå“åç§°\": dish[\"name\"],\n-#                     \"é£Ÿå“å…‹æ•°\": dish[\"weight\"]\n-#                 } for dish in st.session_state.dishes\n-#             ]\n-#         }\n-#     }\n-\n-#     try:\n-#         with st.spinner(\"æ­£åœ¨åˆ†ææ‚¨çš„è¥å…»éœ€æ±‚ï¼Œè¯·ç¨å€™...\"):\n-#             start_time = time.time()\n-#             response = requests.post(BACKEND_URL, json=st.session_state.request_data, timeout=120)\n-#             end_time = time.time()\n-#             st.session_state.response_time = end_time - start_time\n-\n-#             if response.status_code == 200:\n-#                 data = response.json()\n-#                 if data.get(\"success\"):\n-#                     st.session_state.recommendations = data[\"result\"]\n-#                     return True\n-#                 else:\n-#                     st.error(f\"æœåŠ¡è¿”å›é”™è¯¯: {data.get('error', 'æœªçŸ¥é”™è¯¯')}\")\n-#             else:\n-#                 st.error(f\"è¯·æ±‚å¤±è´¥, çŠ¶æ€ç : {response.status_code}\")\n-#                 st.error(f\"é”™è¯¯ä¿¡æ¯: {response.text}\")\n-#     except requests.exceptions.Timeout:\n-#         st.error(\"è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•\")\n-#     except requests.exceptions.ConnectionError:\n-#         st.error(\"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\")\n-#     except Exception as e:\n-#         st.error(f\"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}\")\n-#     return False\n-\n-# # å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n-# with st.sidebar:\n-#     st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n-#     st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n-#     st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n-#     st.number_input(\"èº«é«˜ (cm)\", min_value=50.0, max_value=250.0, key=\"height\", value=175.0, step=1.0)\n-#     st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.5)\n-    \n-#     # æ´»åŠ¨æ°´å¹³æ˜ å°„\n-#     activity_options = {\n-#         \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n-#         \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\": \"b\",\n-#         \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\": \"c\"\n-#     }\n-#     selected_activity_label = st.selectbox(\n-#         \"æ´»åŠ¨æ°´å¹³\",\n-#         list(activity_options.keys()),\n-#         key=\"activity_level_label\",\n-#         index=1\n-#     )\n-#     # å°†é€‰æ‹©çš„å€¼æ˜ å°„ä¸ºç®€å†™å½¢å¼\n-#     st.session_state.activity_level = activity_options[selected_activity_label]\n-    \n-#     st.selectbox(\"é¤åˆ«\", [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], key=\"meal_type\", index=1)\n-\n-# # ä¸»å†…å®¹åŒº\n-# main_container = st.container()\n-\n-# with main_container:\n-#     col1, col2 = st.columns([1, 1])\n-#     st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n-\n-#     for i, dish in enumerate(st.session_state.dishes):\n-#         col_name, col_weight, col_remove = st.columns([3, 1, 0.5])\n-\n-#         with col_name:\n-#             name = st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")\n-#         with col_weight:\n-#             weight = st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)\n-#         with col_remove:\n-#             if i > 0:\n-#                 if st.button(\"åˆ é™¤\", key=f\"remove_{i}\"):\n-#                     remove_dish(i)\n-#                     st.experimental_rerun()\n-\n-#         st.session_state.dishes[i][\"name\"] = name\n-#         st.session_state.dishes[i][\"weight\"] = weight\n-\n-#     # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n-#     st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish)\n-#     if st.button(\"ç”Ÿæˆèœå“æ¨è\"):\n-#         if submit_form():\n-#             if call_backend_service():\n-#                 st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n-#             else:\n-#                 st.session_state.recommendations = None\n-\n-#     with col2:\n-#         st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n-#         if st.session_state.recommendations:\n-#             recommendations = st.session_state.recommendations\n-#             st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n-#             st.markdown(f\"**é¤åˆ«**: {recommendations.get('é¤åˆ«', 'åˆé¤')}\")\n-#             st.markdown(f\"**æ±‚è§£çŠ¶æ€**: {recommendations.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n-#             st.markdown(\"### èœå“æ¨è\")\n-#             tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n-\n-#             with tab1:\n-#                 for dish in recommendations.get(\"èœå“æ¨è\", []):\n-#                     weight = dish.get(\"æ¨èæƒé‡\", 0)\n-#                     if weight >= 0.7:\n-#                         card_class = \"high-weight\"\n-#                         recommendation_text = \"å¼ºçƒˆæ¨è\"\n-#                     elif weight >= 0.5:\n-#                         card_class = \"medium-weight\"\n-#                         recommendation_text = \"æ¨è\"\n-#                     elif weight >= 0.3:\n-#                         card_class = \"medium-weight\"\n-#                         recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n-#                     else:\n-#                         card_class = \"low-weight\"\n-#                         recommendation_text = \"å°‘é‡å°è¯•\"\n-\n-#                     with st.container():\n-#                         st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n-#                         st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n-#                         st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n-#                         st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n-#                         with st.expander(\"æŸ¥çœ‹è¥å…»è¯¦æƒ…\"):\n-#                             nutrition = dish.get(\"è¥å…»å€¼\", {})\n-#                             if nutrition:\n-#                                 col1, col2, col3 = st.columns(3)\n-#                                 with col1:\n-#                                     st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-#                                     st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-#                                 with col2:\n-#                                     st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-#                                     st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-#                                 with col3:\n-#                                     st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n-#                                     st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n-#                             else:\n-#                                 st.warning(\"æ— è¥å…»æ•°æ®\")\n-#                         st.markdown(\"</div>\", unsafe_allow_html=True)\n-\n-#             with tab2:\n-#                 total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n-#                 if total_nutrition:\n-#                     st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n-#                     col1, col2, col3 = st.columns(3)\n-#                     with col1:\n-#                         st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-#                         st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-#                     with col2:\n-#                         st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-#                         st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-#                     with col3:\n-#                         st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n-#                         st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n-\n-#                     st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n-#                     main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n-#                     main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n-#                     df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n-#                     st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n-\n-#                     micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n-#                     micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n-#                     st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n-#                     for nutrient, value in zip(micro_nutrients, micro_values):\n-#                         st.markdown(f\"**{nutrient}**: {value:.1f}\")\n-#                         max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n-#                         percent = min(value / max_value, 1.0) if max_value > 0 else 0\n-#                         st.markdown(f\"\"\"\n-#                         <div class=\"nutrient-bar\">\n-#                             <div class=\"nutrient-fill\" style=\"width: {percent*100}%;\"></div>\n-#                         </div>\n-#                         <div class=\"nutrient-value\">{value:.1f}</div>\n-#                         \"\"\", unsafe_allow_html=True)\n-#                 else:\n-#                     st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n-#         else:\n-#             st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n-\n-# # ä½¿ç”¨è¯´æ˜\n-# st.markdown(\"---\")\n-# st.markdown(\"\"\"\n-# ### ä½¿ç”¨è¯´æ˜\n-# 1. åœ¨å·¦ä¾§å¡«å†™æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰ï¼‰\n-# 2. æ·»åŠ æ‚¨æƒ³è¯„ä¼°çš„èœå“ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰\n-# 3. ç‚¹å‡»\"ç”Ÿæˆèœå“æ¨è\"æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\n-# 4. æŸ¥çœ‹å³ä¾§çš„æ¨èç»“æœï¼Œäº†è§£æ¯é“èœçš„æ¨èç¨‹åº¦å’ŒåŸå› \n-\n-# **æ¨èæƒé‡è¯´æ˜**:\n-# - **å¼ºçƒˆæ¨è (æƒé‡ â‰¥ 0.7)**: è¥å…»å‡è¡¡ä¸”ç¬¦åˆéœ€æ±‚  \n-# - **æ¨è (0.5 â‰¤ æƒé‡ < 0.7)**: è¥å…»è‰¯å¥½ï¼Œé€‚åˆé£Ÿç”¨  \n-# - **é€‚é‡é£Ÿç”¨ (0.3 â‰¤ æƒé‡ < 0.5)**: å¯ä»¥å°‘é‡é£Ÿç”¨  \n-# - **å°‘é‡å°è¯• (æƒé‡ < 0.3)**: å»ºè®®æœ¬é¤é¿å…æˆ–å°‘é‡å°è¯•\n-# \"\"\")\n-\n-# # è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰\n-# if st.checkbox(\"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯\"):\n-#     st.markdown(\"### è¯·æ±‚æ•°æ®\")\n-#     st.json(st.session_state.request_data)\n-#     if st.session_state.recommendations:\n-#         st.markdown(\"### å®Œæ•´å“åº”\")\n-#         st.json(st.session_state.recommendations)\n import streamlit as st\n import requests\n import time\n import json\n@@ -327,15 +16,8 @@\n \n # è‡ªå®šä¹‰CSSæ ·å¼\n st.markdown(\"\"\"\n <style>\n-    .header {\n-        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);\n-        color: white;\n-        padding: 2rem;\n-        border-radius: 0 0 20px 20px;\n-        margin-bottom: 2rem;\n-    }\n     .recommendation-card {\n         border: 1px solid #e0e0e0;\n         border-radius: 12px;\n         padding: 15px;\n@@ -365,48 +47,8 @@\n     .nutrient-value {\n         font-size: 12px;\n         margin-bottom: 10px;\n     }\n-    .nutrient-grid {\n-        display: grid;\n-        grid-template-columns: repeat(3, 1fr);\n-        gap: 15px;\n-        margin-top: 15px;\n-    }\n-    .nutrient-item {\n-        background: #f8f9fa;\n-        border-radius: 8px;\n-        padding: 12px;\n-        text-align: center;\n-        box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n-    }\n-    .nutrient-title {\n-        font-weight: 600;\n-        margin-bottom: 5px;\n-    }\n-    .nutrient-value-display {\n-        font-size: 18px;\n-        font-weight: bold;\n-    }\n-    .nutrient-unit {\n-        font-size: 12px;\n-        color: #666;\n-    }\n-    .dish-row {\n-        display: flex;\n-        margin-bottom: 15px;\n-    }\n-    .dish-name {\n-        flex: 3;\n-        margin-right: 10px;\n-    }\n-    .dish-weight {\n-        flex: 1;\n-        margin-right: 10px;\n-    }\n-    .dish-remove {\n-        flex: 0.5;\n-    }\n </style>\n \"\"\", unsafe_allow_html=True)\n \n # åº”ç”¨æ ‡é¢˜\n@@ -437,9 +79,8 @@\n # åˆ é™¤èœå“\n def remove_dish(index):\n     if len(st.session_state.dishes) > 1:\n         st.session_state.dishes.pop(index)\n-        st.experimental_rerun()\n \n # æäº¤è¡¨å•\n def submit_form():\n     required_fields = ['gender', 'age', 'height', 'weight', 'activity_level', 'meal_type']\n@@ -506,9 +147,9 @@\n     st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n     st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n     st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n     st.number_input(\"èº«é«˜ (cm)\", min_value=50.0, max_value=250.0, key=\"height\", value=175.0, step=1.0)\n-    st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.1)\n+    st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.5)\n     \n     # æ´»åŠ¨æ°´å¹³æ˜ å°„\n     activity_options = {\n         \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n@@ -530,45 +171,37 @@\n main_container = st.container()\n \n with main_container:\n     col1, col2 = st.columns([1, 1])\n-    \n-    with col1:\n-        st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n-        \n-        for i, dish in enumerate(st.session_state.dishes):\n-            # ä½¿ç”¨HTML/CSSåˆ›å»ºç±»ä¼¼åˆ—çš„æ•ˆæœ\n-            st.markdown(f\"\"\"\n-            <div class=\"dish-row\">\n-                <div class=\"dish-name\">\n-                    {st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")._repr_html_()}\n-                </div>\n-                <div class=\"dish-weight\">\n-                    {st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)._repr_html_()}\n-                </div>\n-                <div class=\"dish-remove\">\n-            \"\"\", unsafe_allow_html=True)\n-            \n-            # åˆ é™¤æŒ‰é’®ï¼ˆä¸æ˜¯ç¬¬ä¸€ä¸ªèœå“æ—¶æ˜¾ç¤ºï¼‰\n+    st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n+\n+    for i, dish in enumerate(st.session_state.dishes):\n+        col_name, col_weight, col_remove = st.columns([3, 1, 0.5])\n+\n+        with col_name:\n+            name = st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")\n+        with col_weight:\n+            weight = st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)\n+        with col_remove:\n             if i > 0:\n-                st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n-            \n-            st.markdown(\"</div></div>\", unsafe_allow_html=True)\n-        \n-        # æ·»åŠ èœå“æŒ‰é’®\n-        st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish)\n-        \n-        # æäº¤æŒ‰é’®\n-        if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n-            if submit_form():\n-                if call_backend_service():\n-                    st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n-                else:\n-                    st.session_state.recommendations = None\n-    \n+                if st.button(\"åˆ é™¤\", key=f\"remove_{i}\"):\n+                    remove_dish(i)\n+                    st.experimental_rerun()\n+\n+        st.session_state.dishes[i][\"name\"] = name\n+        st.session_state.dishes[i][\"weight\"] = weight\n+\n+    # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n+    st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish)\n+    if st.button(\"ç”Ÿæˆèœå“æ¨è\"):\n+        if submit_form():\n+            if call_backend_service():\n+                st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n+            else:\n+                st.session_state.recommendations = None\n+\n     with col2:\n         st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n-        \n         if st.session_state.recommendations:\n             recommendations = st.session_state.recommendations\n             st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n             st.markdown(f\"**é¤åˆ«**: {recommendations.get('é¤åˆ«', 'åˆé¤')}\")\n@@ -596,79 +229,23 @@\n                         st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n                         st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n                         st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n                         st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n-                        \n                         with st.expander(\"æŸ¥çœ‹è¥å…»è¯¦æƒ…\"):\n                             nutrition = dish.get(\"è¥å…»å€¼\", {})\n                             if nutrition:\n-                                st.markdown(\"\"\"\n-                                <style>\n-                                .nutrient-grid {\n-                                    display: grid;\n-                                    grid-template-columns: repeat(3, 1fr);\n-                                    gap: 15px;\n-                                    margin-top: 15px;\n-                                }\n-                                .nutrient-item {\n-                                    background: #f8f9fa;\n-                                    border-radius: 8px;\n-                                    padding: 12px;\n-                                    text-align: center;\n-                                    box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n-                                }\n-                                .nutrient-title {\n-                                    font-weight: 600;\n-                                    margin-bottom: 5px;\n-                                }\n-                                .nutrient-value-display {\n-                                    font-size: 18px;\n-                                    font-weight: bold;\n-                                }\n-                                .nutrient-unit {\n-                                    font-size: 12px;\n-                                    color: #666;\n-                                }\n-                                </style>\n-                                \"\"\", unsafe_allow_html=True)\n-                                \n-                                st.markdown(f\"\"\"\n-                                <div class=\"nutrient-grid\">\n-                                    <div class=\"nutrient-item\">\n-                                        <div class=\"nutrient-title\">èƒ½é‡</div>\n-                                        <div class=\"nutrient-value-display\">{nutrition.get('èƒ½é‡', 0):.1f}</div>\n-                                        <div class=\"nutrient-unit\">kcal</div>\n-                                    </div>\n-                                    <div class=\"nutrient-item\">\n-                                        <div class=\"nutrient-title\">è›‹ç™½è´¨</div>\n-                                        <div class=\"nutrient-value-display\">{nutrition.get('è›‹ç™½è´¨', 0):.1f}</div>\n-                                        <div class=\"nutrient-unit\">g</div>\n-                                    </div>\n-                                    <div class=\"nutrient-item\">\n-                                        <div class=\"nutrient-title\">è„‚è‚ª</div>\n-                                        <div class=\"nutrient-value-display\">{nutrition.get('è„‚è‚ª', 0):.1f}</div>\n-                                        <div class=\"nutrient-unit\">g</div>\n-                                    </div>\n-                                    <div class=\"nutrient-item\">\n-                                        <div class=\"nutrient-title\">ç¢³æ°´åŒ–åˆç‰©</div>\n-                                        <div class=\"nutrient-value-display\">{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f}</div>\n-                                        <div class=\"nutrient-unit\">g</div>\n-                                    </div>\n-                                    <div class=\"nutrient-item\">\n-                                        <div class=\"nutrient-title\">é’ </div>\n-                                        <div class=\"nutrient-value-display\">{nutrition.get('é’ ', 0):.1f}</div>\n-                                        <div class=\"nutrient-unit\">mg</div>\n-                                    </div>\n-                                    <div class=\"nutrient-item\">\n-                                        <div class=\"nutrient-title\">ç»´ç”Ÿç´ C</div>\n-                                        <div class=\"nutrient-value-display\">{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f}</div>\n-                                        <div class=\"nutrient-unit\">mg</div>\n-                                    </div>\n-                                </div>\n-                                \"\"\", unsafe_allow_html=True)\n+                                col1, col2, col3 = st.columns(3)\n+                                with col1:\n+                                    st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                                    st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+                                with col2:\n+                                    st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                                    st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+                                with col3:\n+                                    st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n+                                    st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n                             else:\n                                 st.warning(\"æ— è¥å…»æ•°æ®\")\n-                        \n                         st.markdown(\"</div>\", unsafe_allow_html=True)\n \n             with tab2:\n                 total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n@@ -730,5 +307,5 @@\n     st.markdown(\"### è¯·æ±‚æ•°æ®\")\n     st.json(st.session_state.request_data)\n     if st.session_state.recommendations:\n         st.markdown(\"### å®Œæ•´å“åº”\")\n-        st.json(st.session_state.recommendations)\n\\ No newline at end of file\n+        st.json(st.session_state.recommendations)\n"
                },
                {
                    "date": 1752544284449,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,14 @@\n         border-radius: 12px;\n         padding: 15px;\n         margin-bottom: 10px;\n         background-color: #fafafa;\n+        transition: transform 0.2s, box-shadow 0.2s;\n     }\n+    .recommendation-card:hover {\n+        transform: translateY(-3px);\n+        box-shadow: 0 4px 8px rgba(0,0,0,0.1);\n+    }\n     .high-weight {\n         border-left: 6px solid #4CAF50;\n     }\n     .medium-weight {\n@@ -42,13 +47,26 @@\n     }\n     .nutrient-fill {\n         height: 100%;\n         background-color: #4CAF50;\n+        transition: width 0.5s;\n     }\n     .nutrient-value {\n         font-size: 12px;\n         margin-bottom: 10px;\n     }\n+    .nutrition-range {\n+        font-size: 12px;\n+        color: #666;\n+        margin-top: -5px;\n+    }\n+    .summary-card {\n+        background: linear-gradient(145deg, #f5f5f5, #e0e0e0);\n+        border-radius: 10px;\n+        padding: 15px;\n+        margin-bottom: 15px;\n+        box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n+    }\n </style>\n \"\"\", unsafe_allow_html=True)\n \n # åº”ç”¨æ ‡é¢˜\n@@ -61,8 +79,26 @@\n \n # åç«¯æœåŠ¡URL\n BACKEND_URL = \"http://192.168.99.55:5000/recommend_dishes\"\n \n+# è¥å…»å•ä½æ˜ å°„\n+NUTRIENT_UNITS = {\n+    \"èƒ½é‡\": \"kcal\",\n+    \"è›‹ç™½è´¨\": \"g\",\n+    \"è„‚è‚ª\": \"g\",\n+    \"ç¢³æ°´åŒ–åˆç‰©\": \"g\",\n+    \"é’ \": \"mg\",\n+    \"é’™\": \"mg\",\n+    \"é“\": \"mg\",\n+    \"ç»´ç”Ÿç´ C\": \"mg\",\n+    \"ç»´ç”Ÿç´ A\": \"Î¼g\",\n+    \"ç»´ç”Ÿç´ B1\": \"mg\",\n+    \"ç»´ç”Ÿç´ B2\": \"mg\",\n+    \"çƒŸé…¸\": \"mg\",\n+    \"é”Œ\": \"mg\",\n+    \"è†³é£Ÿçº¤ç»´\": \"g\"\n+}\n+\n # åˆå§‹åŒ–session state\n if 'dishes' not in st.session_state:\n     st.session_state.dishes = [{\"name\": \"\", \"weight\": 100.0}]\n if 'recommendations' not in st.session_state:\n@@ -70,8 +106,10 @@\n if 'request_data' not in st.session_state:\n     st.session_state.request_data = None\n if 'response_time' not in st.session_state:\n     st.session_state.response_time = None\n+if 'selected_dish' not in st.session_state:\n+    st.session_state.selected_dish = None\n \n # æ·»åŠ èœå“\n def add_dish():\n     st.session_state.dishes.append({\"name\": \"\", \"weight\": 100.0})\n@@ -80,11 +118,18 @@\n def remove_dish(index):\n     if len(st.session_state.dishes) > 1:\n         st.session_state.dishes.pop(index)\n \n+# æ´»åŠ¨æ°´å¹³æ˜ å°„\n+ACTIVITY_MAPPING = {\n+    \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n+    \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\": \"b\",\n+    \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\": \"c\"\n+}\n+\n # æäº¤è¡¨å•\n def submit_form():\n-    required_fields = ['gender', 'age', 'height', 'weight', 'activity_level', 'meal_type']\n+    required_fields = ['gender', 'age', 'height', 'weight', 'activity_level_label', 'meal_type']\n     if not all([st.session_state.get(field) for field in required_fields]):\n         st.error(\"è¯·å¡«å†™å®Œæ•´çš„ä¸ªäººä¿¡æ¯\")\n         return False\n     for i, dish in enumerate(st.session_state.dishes):\n@@ -97,15 +142,18 @@\n     return True\n \n # è°ƒç”¨åç«¯æœåŠ¡\n def call_backend_service():\n+    # æ˜ å°„æ´»åŠ¨æ°´å¹³ä¸ºç®€å†™å½¢å¼\n+    activity_level = ACTIVITY_MAPPING[st.session_state.activity_level_label]\n+    \n     st.session_state.request_data = {\n         \"info\": {\n             \"æ€§åˆ«\": st.session_state.gender,\n             \"å¹´é¾„\": st.session_state.age,\n             \"èº«é«˜\": st.session_state.height,\n             \"ä½“é‡\": st.session_state.weight,\n-            \"activity_level\": st.session_state.activity_level\n+            \"activity_level\": activity_level\n         },\n         \"data\": {\n             \"é¤åˆ«\": st.session_state.meal_type,\n             \"èœå“åç§°\": [\n@@ -141,171 +189,356 @@\n     except Exception as e:\n         st.error(f\"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}\")\n     return False\n \n+# æ¸²æŸ“è¥å…»éœ€æ±‚å¡\n+def render_nutrition_card(title, value, range_value, unit):\n+    if isinstance(range_value, tuple) or isinstance(range_value, list):\n+        range_str = f\"{range_value[0]:.0f}-{range_value[1]:.0f}{unit}\"\n+    else:\n+        range_str = f\"{range_value:.0f}{unit}\"\n+    \n+    return f\"\"\"\n+    <div class=\"summary-card\">\n+        <h4>{title}</h4>\n+        <div class=\"nutrient-bar\">\n+            <div class=\"nutrient-fill\" style=\"width: {min(value / (range_value[1] if isinstance(range_value, tuple) else range_value), 1) * 100}%\"></div>\n+        </div>\n+        <div class=\"nutrient-value\">å½“å‰: {value:.0f}{unit} <span class=\"nutrition-range\">éœ€æ±‚: {range_str}</span></div>\n+    </div>\n+    \"\"\"\n+\n # å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n with st.sidebar:\n     st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n     st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n     st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n     st.number_input(\"èº«é«˜ (cm)\", min_value=50.0, max_value=250.0, key=\"height\", value=175.0, step=1.0)\n     st.number_input(\"ä½“é‡ (kg)\", min_value=10.0, max_value=200.0, key=\"weight\", value=65.5, step=0.5)\n     \n-    # æ´»åŠ¨æ°´å¹³æ˜ å°„\n-    activity_options = {\n-        \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n-        \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\": \"b\",\n-        \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\": \"c\"\n-    }\n     selected_activity_label = st.selectbox(\n         \"æ´»åŠ¨æ°´å¹³\",\n-        list(activity_options.keys()),\n+        list(ACTIVITY_MAPPING.keys()),\n         key=\"activity_level_label\",\n         index=1\n     )\n-    # å°†é€‰æ‹©çš„å€¼æ˜ å°„ä¸ºç®€å†™å½¢å¼\n-    st.session_state.activity_level = activity_options[selected_activity_label]\n     \n     st.selectbox(\"é¤åˆ«\", [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], key=\"meal_type\", index=1)\n \n # ä¸»å†…å®¹åŒº\n main_container = st.container()\n \n with main_container:\n     col1, col2 = st.columns([1, 1])\n-    st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n+    \n+    with col1:\n+        st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n+        for i, dish in enumerate(st.session_state.dishes):\n+            cols = st.columns([0.5, 3, 1, 1.2])\n+            \n+            with cols[0]:\n+                st.write(f\"#{i+1}\")\n+            with cols[1]:\n+                name = st.text_input(f\"èœå“åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\", label_visibility=\"collapsed\")\n+            with cols[2]:\n+                weight = st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0, label_visibility=\"collapsed\")\n+            with cols[3]:\n+                if i > 0:\n+                    if st.button(\"âŒ åˆ é™¤\", key=f\"remove_{i}\", use_container_width=True):\n+                        remove_dish(i)\n+                        st.rerun()\n \n-    for i, dish in enumerate(st.session_state.dishes):\n-        col_name, col_weight, col_remove = st.columns([3, 1, 0.5])\n+            st.session_state.dishes[i][\"name\"] = name\n+            st.session_state.dishes[i][\"weight\"] = weight\n \n-        with col_name:\n-            name = st.text_input(f\"èœå“ #{i+1} åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\")\n-        with col_weight:\n-            weight = st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0)\n-        with col_remove:\n-            if i > 0:\n-                if st.button(\"åˆ é™¤\", key=f\"remove_{i}\"):\n-                    remove_dish(i)\n-                    st.experimental_rerun()\n+        # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n+        st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n+        if st.button(\"âœ¨ ç”Ÿæˆèœå“æ¨è\", type=\"primary\", use_container_width=True):\n+            if submit_form():\n+                if call_backend_service():\n+                    st.toast(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\", icon=\"âœ…\")\n+                else:\n+                    st.session_state.recommendations = None\n+                    st.toast(\"æ¨èç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯\", icon=\"âš ï¸\")\n \n-        st.session_state.dishes[i][\"name\"] = name\n-        st.session_state.dishes[i][\"weight\"] = weight\n-\n-    # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n-    st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish)\n-    if st.button(\"ç”Ÿæˆèœå“æ¨è\"):\n-        if submit_form():\n-            if call_backend_service():\n-                st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n-            else:\n-                st.session_state.recommendations = None\n-\n+# æ¨èç»“æœæ˜¾ç¤º\n+if st.session_state.recommendations:\n+    recommendations = st.session_state.recommendations\n     with col2:\n         st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n-        if st.session_state.recommendations:\n-            recommendations = st.session_state.recommendations\n-            st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n-            st.markdown(f\"**é¤åˆ«**: {recommendations.get('é¤åˆ«', 'åˆé¤')}\")\n-            st.markdown(f\"**æ±‚è§£çŠ¶æ€**: {recommendations.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n-            st.markdown(\"### èœå“æ¨è\")\n-            tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n-\n-            with tab1:\n-                for dish in recommendations.get(\"èœå“æ¨è\", []):\n-                    weight = dish.get(\"æ¨èæƒé‡\", 0)\n-                    if weight >= 0.7:\n-                        card_class = \"high-weight\"\n-                        recommendation_text = \"å¼ºçƒˆæ¨è\"\n-                    elif weight >= 0.5:\n-                        card_class = \"medium-weight\"\n-                        recommendation_text = \"æ¨è\"\n-                    elif weight >= 0.3:\n-                        card_class = \"medium-weight\"\n-                        recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n-                    else:\n-                        card_class = \"low-weight\"\n-                        recommendation_text = \"å°‘é‡å°è¯•\"\n-\n-                    with st.container():\n-                        st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n-                        st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n-                        st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n-                        st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n-                        with st.expander(\"æŸ¥çœ‹è¥å…»è¯¦æƒ…\"):\n-                            nutrition = dish.get(\"è¥å…»å€¼\", {})\n-                            if nutrition:\n-                                col1, col2, col3 = st.columns(3)\n-                                with col1:\n-                                    st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                                    st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                                with col2:\n-                                    st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-                                    st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                                with col3:\n-                                    st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n-                                    st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n-                            else:\n-                                st.warning(\"æ— è¥å…»æ•°æ®\")\n-                        st.markdown(\"</div>\", unsafe_allow_html=True)\n-\n-            with tab2:\n-                total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n-                if total_nutrition:\n-                    st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n-                    col1, col2, col3 = st.columns(3)\n-                    with col1:\n-                        st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                        st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                    with col2:\n-                        st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-                        st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                    with col3:\n-                        st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n-                        st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n-\n-                    st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n-                    main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n-                    main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n-                    df = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n-                    st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n-\n-                    micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n-                    micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n-                    st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n-                    for nutrient, value in zip(micro_nutrients, micro_values):\n-                        st.markdown(f\"**{nutrient}**: {value:.1f}\")\n-                        max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n-                        percent = min(value / max_value, 1.0) if max_value > 0 else 0\n-                        st.markdown(f\"\"\"\n-                        <div class=\"nutrient-bar\">\n-                            <div class=\"nutrient-fill\" style=\"width: {percent*100}%;\"></div>\n-                        </div>\n-                        <div class=\"nutrient-value\">{value:.1f}</div>\n-                        \"\"\", unsafe_allow_html=True)\n+        st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n+        \n+        # åŸºæœ¬ä¿¡æ¯å¡ç‰‡\n+        with st.expander(\"ğŸ“‹ åŸºæœ¬ä¿¡æ¯æ‘˜è¦\", expanded=True):\n+            col_summary1, col_summary2 = st.columns(2)\n+            with col_summary1:\n+                st.metric(\"é¤åˆ«\", recommendations.get(\"é¤åˆ«\", \"åˆé¤\"))\n+                st.metric(\"çŠ¶æ€\", recommendations.get(\"æ±‚è§£çŠ¶æ€\", \"æœªçŸ¥\"))\n+            with col_summary2:\n+                st.metric(\"æ´»åŠ¨æ°´å¹³\", st.session_state.activity_level_label)\n+                st.metric(\"èƒ½é‡éœ€æ±‚èŒƒå›´\", \n+                         f\"{recommendations.get('ç”¨æˆ·è¥å…»éœ€æ±‚', {}).get('èƒ½é‡', [0,0])[0]:.0f}-\"\n+                         f\"{recommendations.get('ç”¨æˆ·è¥å…»éœ€æ±‚', {}).get('èƒ½é‡', [0,0])[1]:.0f} kcal\")\n+        \n+        tab_rec, tab_nutrition, tab_details = st.tabs([\"èœå“æ¨è\", \"è¥å…»åˆ†æ\", \"è¯¦æƒ…æ•°æ®\"])\n+        \n+        with tab_rec:\n+            st.markdown(\"#### ğŸ“‹ èœå“æ¨èåˆ—è¡¨\")\n+            \n+            # æ’åºï¼šæŒ‰æƒé‡é™åº\n+            sorted_dishes = sorted(recommendations.get(\"èœå“æ¨è\", []), \n+                                  key=lambda x: x.get(\"æ¨èæƒé‡\", 0), \n+                                  reverse=True)\n+            \n+            for dish in sorted_dishes:\n+                weight = dish.get(\"æ¨èæƒé‡\", 0)\n+                if weight >= 0.7:\n+                    card_class = \"high-weight\"\n+                    recommendation_text = \"å¼ºçƒˆæ¨è\"\n+                elif weight >= 0.5:\n+                    card_class = \"medium-weight\"\n+                    recommendation_text = \"æ¨è\"\n+                elif weight >= 0.3:\n+                    card_class = \"medium-weight\"\n+                    recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n                 else:\n-                    st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n-        else:\n-            st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n+                    card_class = \"low-weight\"\n+                    recommendation_text = \"å°‘é‡å°è¯•\"\n+                \n+                with st.container():\n+                    st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n+                    \n+                    cols = st.columns([3, 2])\n+                    with cols[0]:\n+                        st.markdown(f\"#### ğŸ² {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n+                        st.markdown(f\"**æ¨èæŒ‡æ•°**: {weight:.2f} ({recommendation_text})\")\n+                    with cols[1]:\n+                        st.progress(min(weight, 1.0), text=f\"{recommendation_text}\")\n+                    \n+                    st.markdown(f\"##### ğŸ§  æ¨èç†ç”±\")\n+                    st.caption(f\"{dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n+                    \n+                    nutrition = dish.get(\"è¥å…»å€¼\", {})\n+                    if nutrition:\n+                        with st.expander(\"ğŸ“Š è¥å…»æˆåˆ†åˆ†æ\", expanded=False):\n+                            st.markdown(\"**ä¸»è¦è¥å…»ç´ **\")\n+                            col_nut1, col_nut2, col_nut3 = st.columns(3)\n+                            with col_nut1:\n+                                st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                                st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+                            with col_nut2:\n+                                st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                                st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+                            with col_nut3:\n+                                st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n+                                st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+                    \n+                    st.markdown(\"</div>\", unsafe_allow_html=True)\n+        \n+        with tab_nutrition:\n+            st.markdown(\"#### ğŸ“Š è¥å…»åˆ†æ\")\n+            \n+            user_needs = recommendations.get(\"ç”¨æˆ·è¥å…»éœ€æ±‚\", {})\n+            total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n+            \n+            if total_nutrition and user_needs:\n+                st.markdown(\"##### ğŸ½ï¸ æ•´é¤è¥å…»æ‘˜è¦\")\n+                col_sum1, col_sum2 = st.columns(2)\n+                \n+                with col_sum1:\n+                    st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\", \n+                             delta=f\"{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('èƒ½é‡', [0,0])[0]:.1f}-{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('èƒ½é‡', [0,0])[1]:.1f} kcal\",\n+                             delta_color=\"off\")\n+                    st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\",\n+                             delta=f\"{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('è›‹ç™½è´¨', [0,0])[0]:.1f}-{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('è›‹ç™½è´¨', [0,0])[1]:.1f} g\",\n+                             delta_color=\"off\")\n+                with col_sum2:\n+                    st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\",\n+                             delta=f\"{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('è„‚è‚ª', [0,0])[0]:.1f}-{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('è„‚è‚ª', [0,0])[1]:.1f} g\",\n+                             delta_color=\"off\")\n+                    st.metric(\"æ€»ç¢³æ°´\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\",\n+                             delta=f\"{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('ç¢³æ°´åŒ–åˆç‰©', [0,0])[0]:.1f}-{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('ç¢³æ°´åŒ–åˆç‰©', [0,0])[1]:.1f} g\",\n+                             delta_color=\"off\")\n+                \n+                st.markdown(\"---\")\n+                st.markdown(\"##### ğŸ“ˆ è¥å…»ç´ æ»¡è¶³æƒ…å†µ\")\n+                \n+                # å®é‡è¥å…»ç´ åˆ†æ\n+                st.markdown(\"**å®é‡è¥å…»ç´ **\")\n+                col_macronutrients = st.columns(2)\n+                with col_macronutrients[0]:\n+                    st.markdown(render_nutrition_card(\n+                        \"èƒ½é‡\", \n+                        total_nutrition.get('èƒ½é‡', 0),\n+                        user_needs.get('èƒ½é‡', [0, 0]),\n+                        \"kcal\"\n+                    ), unsafe_allow_html=True)\n+                    \n+                    st.markdown(render_nutrition_card(\n+                        \"è›‹ç™½è´¨\", \n+                        total_nutrition.get('è›‹ç™½è´¨', 0),\n+                        user_needs.get('è›‹ç™½è´¨', [0, 0]),\n+                        \"g\"\n+                    ), unsafe_allow_html=True)\n+                    \n+                with col_macronutrients[1]:\n+                    st.markdown(render_nutrition_card(\n+                        \"è„‚è‚ª\", \n+                        total_nutrition.get('è„‚è‚ª', 0),\n+                        user_needs.get('è„‚è‚ª', [0, 0]),\n+                        \"g\"\n+                    ), unsafe_allow_html=True)\n+                    \n+                    st.markdown(render_nutrition_card(\n+                        \"ç¢³æ°´åŒ–åˆç‰©\", \n+                        total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0),\n+                        user_needs.get('ç¢³æ°´åŒ–åˆç‰©', [0, 0]),\n+                        \"g\"\n+                    ), unsafe_allow_html=True)\n+                \n+                # å¾®é‡è¥å…»ç´ åˆ†æ\n+                st.markdown(\"**å¾®é‡è¥å…»ç´ **\")\n+                col_micronutrients = st.columns(2)\n+                with col_micronutrients[0]:\n+                    st.markdown(render_nutrition_card(\n+                        \"é’ \", \n+                        total_nutrition.get('é’ ', 0),\n+                        user_needs.get('é’ ', [0, 0]) if isinstance(user_needs.get('é’ '), (list, tuple)) else user_needs.get('é’ ', 0),\n+                        \"mg\"\n+                    ), unsafe_allow_html=True)\n+                    \n+                    st.markdown(render_nutrition_card(\n+                        \"é’™\", \n+                        total_nutrition.get('é’™', 0),\n+                        user_needs.get('é’™', [0, 0]) if isinstance(user_needs.get('é’™'), (list, tuple)) else user_needs.get('é’™', 0),\n+                        \"mg\"\n+                    ), unsafe_allow_html=True)\n+                    \n+                with col_micronutrients[1]:\n+                    st.markdown(render_nutrition_card(\n+                        \"é“\", \n+                        total_nutrition.get('é“', 0),\n+                        user_needs.get('é“', [0, 0]) if isinstance(user_needs.get('é“'), (list, tuple)) else user_needs.get('é“', 0),\n+                        \"mg\"\n+                    ), unsafe_allow_html=True)\n+                    \n+                    st.markdown(render_nutrition_card(\n+                        \"ç»´ç”Ÿç´ C\", \n+                        total_nutrition.get('ç»´ç”Ÿç´ C', 0),\n+                        user_needs.get('ç»´ç”Ÿç´ C', [0, 0]) if isinstance(user_needs.get('ç»´ç”Ÿç´ C'), (list, tuple)) else user_needs.get('ç»´ç”Ÿç´ C', 0),\n+                        \"mg\"\n+                    ), unsafe_allow_html=True)\n+                \n+                # è¥å…»åˆ†å¸ƒå›¾è¡¨\n+                st.markdown(\"---\")\n+                st.markdown(\"##### ğŸ“Š è¥å…»åˆ†å¸ƒ\")\n+                \n+                main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n+                main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n+                df_main = pd.DataFrame({\n+                    \"è¥å…»ç´ \": main_nutrients,\n+                    \"å«é‡\": main_values,\n+                    \"å•ä½\": [NUTRIENT_UNITS.get(n, \"\") for n in main_nutrients]\n+                })\n+                st.bar_chart(df_main.set_index(\"è¥å…»ç´ \")[\"å«é‡\"])\n+                \n+                st.markdown(\"**ç»´ç”Ÿç´ åˆ†å¸ƒ**\")\n+                vitamin_nutrients = [\"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ B1\", \"ç»´ç”Ÿç´ B2\", \"ç»´ç”Ÿç´ C\"]\n+                vitamin_values = [total_nutrition.get(n, 0) for n in vitamin_nutrients]\n+                df_vitamin = pd.DataFrame({\n+                    \"ç»´ç”Ÿç´ \": vitamin_nutrients,\n+                    \"å«é‡\": vitamin_values,\n+                    \"å•ä½\": [NUTRIENT_UNITS.get(n, \"\") for n in vitamin_nutrients]\n+                })\n+                st.bar_chart(df_vitamin.set_index(\"ç»´ç”Ÿç´ \")[\"å«é‡\"])\n+                \n+                st.markdown(\"**çŸ¿ç‰©è´¨åˆ†å¸ƒ**\")\n+                mineral_nutrients = [\"é’ \", \"é’™\", \"é“\", \"é”Œ\"]\n+                mineral_values = [total_nutrition.get(n, 0) for n in mineral_nutrients]\n+                df_mineral = pd.DataFrame({\n+                    \"çŸ¿ç‰©è´¨\": mineral_nutrients,\n+                    \"å«é‡\": mineral_values,\n+                    \"å•ä½\": [NUTRIENT_UNITS.get(n, \"\") for n in mineral_nutrients]\n+                })\n+                st.bar_chart(df_mineral.set_index(\"çŸ¿ç‰©è´¨\")[\"å«é‡\"])\n+        \n+        with tab_details:\n+            st.markdown(\"#### ğŸ“Š è¯¦æƒ…æ•°æ®\")\n+            \n+            st.markdown(\"##### ç”¨æˆ·éœ€æ±‚è¥å…»èŒƒå›´\")\n+            if recommendations.get(\"ç”¨æˆ·è¥å…»éœ€æ±‚\"):\n+                df_needs = pd.DataFrame.from_dict(recommendations[\"ç”¨æˆ·è¥å…»éœ€æ±‚\"], orient=\"index\", columns=[\"å€¼\"])\n+                st.dataframe(df_needs, use_container_width=True)\n+            else:\n+                st.warning(\"æ— ç”¨æˆ·è¥å…»éœ€æ±‚æ•°æ®\")\n+            \n+            st.markdown(\"##### èœå“æ¨èè¯¦æƒ…\")\n+            if recommendations.get(\"èœå“æ¨è\"):\n+                dish_data = []\n+                for dish in recommendations[\"èœå“æ¨è\"]:\n+                    dish_data.append({\n+                        \"èœå“åç§°\": dish.get(\"èœå“åç§°\", \"\"),\n+                        \"æ¨èæƒé‡\": dish.get(\"æ¨èæƒé‡\", 0),\n+                        \"åŸå› \": dish.get(\"åŸå› \", \"\")\n+                    })\n+                st.dataframe(pd.DataFrame(dish_data), use_container_width=True)\n+            else:\n+                st.warning(\"æ— èœå“æ¨èæ•°æ®\")\n+            \n+            st.markdown(\"##### æ•´é¤è¥å…»æ‘˜è¦\")\n+            if recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\"):\n+                df_total = pd.DataFrame.from_dict(recommendations[\"æ•´é¤è¥å…»æ‘˜è¦\"], orient=\"index\", columns=[\"å€¼\"])\n+                st.dataframe(df_total, use_container_width=True)\n+            else:\n+                st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n+else:\n+    with col2:\n+        st.info(\"âœ¨ è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n+        st.image(\"https://via.placeholder.com/600x300?text=ç­‰å¾…æ¨èç»“æœ\", use_column_width=True)\n \n # ä½¿ç”¨è¯´æ˜\n st.markdown(\"---\")\n-st.markdown(\"\"\"\n-### ä½¿ç”¨è¯´æ˜\n-1. åœ¨å·¦ä¾§å¡«å†™æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰ï¼‰\n-2. æ·»åŠ æ‚¨æƒ³è¯„ä¼°çš„èœå“ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰\n-3. ç‚¹å‡»\"ç”Ÿæˆèœå“æ¨è\"æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\n-4. æŸ¥çœ‹å³ä¾§çš„æ¨èç»“æœï¼Œäº†è§£æ¯é“èœçš„æ¨èç¨‹åº¦å’ŒåŸå› \n+with st.expander(\"â„¹ï¸ ä½¿ç”¨è¯´æ˜\"):\n+    st.markdown(\"\"\"\n+    ### ä½¿ç”¨æŒ‡å—\n+    \n+    1. **å¡«å†™ä¸ªäººä¿¡æ¯**ï¼š\n+       - åœ¨å·¦ä¾§æ å®Œæ•´å¡«å†™æ‚¨çš„æ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰ä¿¡æ¯\n+       - é€‰æ‹©æ‚¨çš„æ´»åŠ¨æ°´å¹³ï¼ˆæ ¹æ®æ—¥å¸¸æ´»åŠ¨å¼ºåº¦ï¼‰\n+       - é€‰æ‹©è¦è§„åˆ’çš„é¤åˆ«ï¼ˆæ—©é¤/åˆé¤/æ™šé¤ï¼‰\n+    \n+    2. **æ·»åŠ èœå“ä¿¡æ¯**ï¼š\n+       - è¾“å…¥èœå“åç§°ï¼ˆå¦‚ï¼šç•ªèŒ„ç‚’è›‹ï¼‰\n+       - è®¾ç½®èœå“ä»½é‡ï¼ˆå…‹æ•°ï¼‰\n+       - å¯æ·»åŠ å¤šä¸ªèœå“è¿›è¡Œæ··åˆåˆ†æ\n+    \n+    3. **ç”Ÿæˆæ¨è**ï¼š\n+       - ç‚¹å‡»\"âœ¨ ç”Ÿæˆèœå“æ¨è\"æŒ‰é’®è¿›è¡Œåˆ†æ\n+       - ç³»ç»Ÿå°†æ ¹æ®æ‚¨çš„ä¸ªäººæƒ…å†µå’Œèœå“ç‰¹ç‚¹ç”Ÿæˆæ¨è\n+    \n+    4. **æŸ¥çœ‹ç»“æœ**ï¼š\n+       - åœ¨å³ä¾§æ¨èç»“æœåŒºåŸŸæŸ¥çœ‹åˆ†æç»“æœ\n+       - é€šè¿‡ä¸‰ä¸ªæ ‡ç­¾é¡µåˆ†åˆ«æŸ¥çœ‹ï¼š\n+         - ğŸ“‹ èœå“æ¨è - å„èœå“æ¨èæŒ‡æ•°åŠåŸå› \n+         - ğŸ“Š è¥å…»åˆ†æ - æ•´é¤è¥å…»æ„æˆåŠéœ€æ±‚æ»¡è¶³æƒ…å†µ\n+         - ğŸ“Š è¯¦æƒ…æ•°æ® - è¯¦ç»†çš„æ•°æ®è¡¨æ ¼\n+    \"\"\")\n+    \n+    st.markdown(\"### æ¨èæƒé‡è¯´æ˜\")\n+    cols_legend = st.columns(4)\n+    with cols_legend[0]:\n+        st.markdown(\"<div class='recommendation-card high-weight'><b>å¼ºçƒˆæ¨è</b><br>(æƒé‡ â‰¥ 0.7)</div>\", unsafe_allow_html=True)\n+    with cols_legend[1]:\n+        st.markdown(\"<div class='recommendation-card medium-weight'><b>æ¨è</b><br>(0.5 â‰¤ æƒé‡ < 0.7)</div>\", unsafe_allow_html=True)\n+    with cols_legend[2]:\n+        st.markdown(\"<div class='recommendation-card medium-weight'><b>é€‚é‡é£Ÿç”¨</b><br>(0.3 â‰¤ æƒé‡ < 0.5)</div>\", unsafe_allow_html=True)\n+    with cols_legend[3]:\n+        st.markdown(\"<div class='recommendation-card low-weight'><b>å°‘é‡å°è¯•</b><br>(æƒé‡ < 0.3)</div>\", unsafe_allow_html=True)\n \n-**æ¨èæƒé‡è¯´æ˜**:\n-- **å¼ºçƒˆæ¨è (æƒé‡ â‰¥ 0.7)**: è¥å…»å‡è¡¡ä¸”ç¬¦åˆéœ€æ±‚  \n-- **æ¨è (0.5 â‰¤ æƒé‡ < 0.7)**: è¥å…»è‰¯å¥½ï¼Œé€‚åˆé£Ÿç”¨  \n-- **é€‚é‡é£Ÿç”¨ (0.3 â‰¤ æƒé‡ < 0.5)**: å¯ä»¥å°‘é‡é£Ÿç”¨  \n-- **å°‘é‡å°è¯• (æƒé‡ < 0.3)**: å»ºè®®æœ¬é¤é¿å…æˆ–å°‘é‡å°è¯•\n-\"\"\")\n-\n # è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰\n if st.checkbox(\"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯\"):\n     st.markdown(\"### è¯·æ±‚æ•°æ®\")\n     st.json(st.session_state.request_data)\n+    \n     if st.session_state.recommendations:\n         st.markdown(\"### å®Œæ•´å“åº”\")\n-        st.json(st.session_state.recommendations)\n+        st.json(st.session_state.recommendations)\n\\ No newline at end of file\n"
                },
                {
                    "date": 1752544651032,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -65,8 +65,16 @@\n         padding: 15px;\n         margin-bottom: 15px;\n         box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n     }\n+    .dish-input-row {\n+        display: flex;\n+        margin-bottom: 15px;\n+        align-items: center;\n+    }\n+    .dish-input-cell {\n+        margin-right: 15px;\n+    }\n </style>\n \"\"\", unsafe_allow_html=True)\n \n # åº”ç”¨æ ‡é¢˜\n@@ -117,8 +125,9 @@\n # åˆ é™¤èœå“\n def remove_dish(index):\n     if len(st.session_state.dishes) > 1:\n         st.session_state.dishes.pop(index)\n+        st.rerun()\n \n # æ´»åŠ¨æ°´å¹³æ˜ å°„\n ACTIVITY_MAPPING = {\n     \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n@@ -191,9 +200,9 @@\n     return False\n \n # æ¸²æŸ“è¥å…»éœ€æ±‚å¡\n def render_nutrition_card(title, value, range_value, unit):\n-    if isinstance(range_value, tuple) or isinstance(range_value, list):\n+    if isinstance(range_value, (tuple, list)):\n         range_str = f\"{range_value[0]:.0f}-{range_value[1]:.0f}{unit}\"\n     else:\n         range_str = f\"{range_value:.0f}{unit}\"\n     \n@@ -231,26 +240,30 @@\n     col1, col2 = st.columns([1, 1])\n     \n     with col1:\n         st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n+        \n         for i, dish in enumerate(st.session_state.dishes):\n-            cols = st.columns([0.5, 3, 1, 1.2])\n+            st.markdown(f\"**èœå“ #{i+1}**\")\n+            st.text_input(\"èœå“åç§°\", value=dish[\"name\"], \n+                         key=f\"dish_name_{i}\", \n+                         placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\",\n+                         label_visibility=\"collapsed\")\n             \n-            with cols[0]:\n-                st.write(f\"#{i+1}\")\n-            with cols[1]:\n-                name = st.text_input(f\"èœå“åç§°\", value=dish[\"name\"], key=f\"dish_name_{i}\", placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\", label_visibility=\"collapsed\")\n-            with cols[2]:\n-                weight = st.number_input(\"é‡é‡ (g)\", min_value=1.0, value=dish[\"weight\"], key=f\"dish_weight_{i}\", step=1.0, label_visibility=\"collapsed\")\n-            with cols[3]:\n+            weight_col, remove_col = st.columns([3, 1])\n+            with weight_col:\n+                dish[\"weight\"] = st.number_input(\"é‡é‡ (g)\", min_value=1.0, \n+                                               value=dish[\"weight\"], \n+                                               key=f\"dish_weight_{i}\", \n+                                               step=1.0)\n+            with remove_col:\n                 if i > 0:\n-                    if st.button(\"âŒ åˆ é™¤\", key=f\"remove_{i}\", use_container_width=True):\n+                    if st.button(\"åˆ é™¤\", key=f\"remove_{i}\", use_container_width=True):\n                         remove_dish(i)\n-                        st.rerun()\n-\n-            st.session_state.dishes[i][\"name\"] = name\n-            st.session_state.dishes[i][\"weight\"] = weight\n-\n+                        st.stop()\n+            \n+            st.divider()\n+        \n         # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n         st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n         if st.button(\"âœ¨ ç”Ÿæˆèœå“æ¨è\", type=\"primary\", use_container_width=True):\n             if submit_form():\n@@ -492,9 +505,8 @@\n                 st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n else:\n     with col2:\n         st.info(\"âœ¨ è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n-        st.image(\"https://via.placeholder.com/600x300?text=ç­‰å¾…æ¨èç»“æœ\", use_column_width=True)\n \n # ä½¿ç”¨è¯´æ˜\n st.markdown(\"---\")\n with st.expander(\"â„¹ï¸ ä½¿ç”¨è¯´æ˜\"):\n"
                },
                {
                    "date": 1752544817737,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,8 +73,11 @@\n     }\n     .dish-input-cell {\n         margin-right: 15px;\n     }\n+    .hidden-label label {\n+        display: none;\n+    }\n </style>\n \"\"\", unsafe_allow_html=True)\n \n # åº”ç”¨æ ‡é¢˜\n@@ -125,9 +128,8 @@\n # åˆ é™¤èœå“\n def remove_dish(index):\n     if len(st.session_state.dishes) > 1:\n         st.session_state.dishes.pop(index)\n-        st.rerun()\n \n # æ´»åŠ¨æ°´å¹³æ˜ å°„\n ACTIVITY_MAPPING = {\n     \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n@@ -198,25 +200,8 @@\n     except Exception as e:\n         st.error(f\"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}\")\n     return False\n \n-# æ¸²æŸ“è¥å…»éœ€æ±‚å¡\n-def render_nutrition_card(title, value, range_value, unit):\n-    if isinstance(range_value, (tuple, list)):\n-        range_str = f\"{range_value[0]:.0f}-{range_value[1]:.0f}{unit}\"\n-    else:\n-        range_str = f\"{range_value:.0f}{unit}\"\n-    \n-    return f\"\"\"\n-    <div class=\"summary-card\">\n-        <h4>{title}</h4>\n-        <div class=\"nutrient-bar\">\n-            <div class=\"nutrient-fill\" style=\"width: {min(value / (range_value[1] if isinstance(range_value, tuple) else range_value), 1) * 100}%\"></div>\n-        </div>\n-        <div class=\"nutrient-value\">å½“å‰: {value:.0f}{unit} <span class=\"nutrition-range\">éœ€æ±‚: {range_str}</span></div>\n-    </div>\n-    \"\"\"\n-\n # å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\n with st.sidebar:\n     st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n     st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n@@ -243,24 +228,34 @@\n         st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n         \n         for i, dish in enumerate(st.session_state.dishes):\n             st.markdown(f\"**èœå“ #{i+1}**\")\n-            st.text_input(\"èœå“åç§°\", value=dish[\"name\"], \n-                         key=f\"dish_name_{i}\", \n-                         placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\",\n-                         label_visibility=\"collapsed\")\n             \n+            # ä½¿ç”¨CSSéšè—æ ‡ç­¾è€Œä¸æ˜¯label_visibilityå‚æ•°\n+            st.markdown('<div class=\"hidden-label\">', unsafe_allow_html=True)\n+            dish[\"name\"] = st.text_input(\n+                \"èœå“åç§°\", \n+                value=dish[\"name\"], \n+                key=f\"dish_name_{i}\", \n+                placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n+            )\n+            st.markdown('</div>', unsafe_allow_html=True)\n+            \n+            # é‡é‡è¾“å…¥å’Œåˆ é™¤æŒ‰é’®\n             weight_col, remove_col = st.columns([3, 1])\n             with weight_col:\n-                dish[\"weight\"] = st.number_input(\"é‡é‡ (g)\", min_value=1.0, \n-                                               value=dish[\"weight\"], \n-                                               key=f\"dish_weight_{i}\", \n-                                               step=1.0)\n+                dish[\"weight\"] = st.number_input(\n+                    \"é‡é‡ (g)\", \n+                    min_value=1.0, \n+                    value=dish[\"weight\"], \n+                    key=f\"dish_weight_{i}\", \n+                    step=1.0\n+                )\n             with remove_col:\n                 if i > 0:\n                     if st.button(\"åˆ é™¤\", key=f\"remove_{i}\", use_container_width=True):\n                         remove_dish(i)\n-                        st.stop()\n+                        st.experimental_rerun()\n             \n             st.divider()\n         \n         # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n@@ -287,11 +282,15 @@\n                 st.metric(\"é¤åˆ«\", recommendations.get(\"é¤åˆ«\", \"åˆé¤\"))\n                 st.metric(\"çŠ¶æ€\", recommendations.get(\"æ±‚è§£çŠ¶æ€\", \"æœªçŸ¥\"))\n             with col_summary2:\n                 st.metric(\"æ´»åŠ¨æ°´å¹³\", st.session_state.activity_level_label)\n-                st.metric(\"èƒ½é‡éœ€æ±‚èŒƒå›´\", \n-                         f\"{recommendations.get('ç”¨æˆ·è¥å…»éœ€æ±‚', {}).get('èƒ½é‡', [0,0])[0]:.0f}-\"\n-                         f\"{recommendations.get('ç”¨æˆ·è¥å…»éœ€æ±‚', {}).get('èƒ½é‡', [0,0])[1]:.0f} kcal\")\n+                # ç¡®ä¿èƒ½å¤„ç†å„ç§æ ¼å¼çš„èƒ½é‡éœ€æ±‚\n+                energy_needs = recommendations.get('ç”¨æˆ·è¥å…»éœ€æ±‚', {}).get('èƒ½é‡', [0,0])\n+                if isinstance(energy_needs, (tuple, list)) and len(energy_needs) == 2:\n+                    energy_range = f\"{energy_needs[0]:.0f}-{energy_needs[1]:.0f} kcal\"\n+                else:\n+                    energy_range = \"æœªçŸ¥\"\n+                st.metric(\"èƒ½é‡éœ€æ±‚èŒƒå›´\", energy_range)\n         \n         tab_rec, tab_nutrition, tab_details = st.tabs([\"èœå“æ¨è\", \"è¥å…»åˆ†æ\", \"è¯¦æƒ…æ•°æ®\"])\n         \n         with tab_rec:\n@@ -357,20 +356,51 @@\n                 st.markdown(\"##### ğŸ½ï¸ æ•´é¤è¥å…»æ‘˜è¦\")\n                 col_sum1, col_sum2 = st.columns(2)\n                 \n                 with col_sum1:\n+                    # å¤„ç†èƒ½é‡éœ€æ±‚æ ¼å¼\n+                    energy_needs = user_needs.get('èƒ½é‡', [0,0])\n+                    if isinstance(energy_needs, (tuple, list)) and len(energy_needs) == 2:\n+                        energy_range = f\"{energy_needs[0]:.0f}-{energy_needs[1]:.0f} kcal\"\n+                    else:\n+                        energy_range = \"æœªçŸ¥\"\n+                    \n                     st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\", \n-                             delta=f\"{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('èƒ½é‡', [0,0])[0]:.1f}-{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('èƒ½é‡', [0,0])[1]:.1f} kcal\",\n+                             delta=energy_range,\n                              delta_color=\"off\")\n+                    \n+                    # å¤„ç†è›‹ç™½è´¨éœ€æ±‚æ ¼å¼\n+                    protein_needs = user_needs.get('è›‹ç™½è´¨', [0,0])\n+                    if isinstance(protein_needs, (tuple, list)) and len(protein_needs) == 2:\n+                        protein_range = f\"{protein_needs[0]:.0f}-{protein_needs[1]:.0f} g\"\n+                    else:\n+                        protein_range = \"æœªçŸ¥\"\n+                    \n                     st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\",\n-                             delta=f\"{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('è›‹ç™½è´¨', [0,0])[0]:.1f}-{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('è›‹ç™½è´¨', [0,0])[1]:.1f} g\",\n+                             delta=protein_range,\n                              delta_color=\"off\")\n+                \n                 with col_sum2:\n+                    # å¤„ç†è„‚è‚ªéœ€æ±‚æ ¼å¼\n+                    fat_needs = user_needs.get('è„‚è‚ª', [0,0])\n+                    if isinstance(fat_needs, (tuple, list)) and len(fat_needs) == 2:\n+                        fat_range = f\"{fat_needs[0]:.0f}-{fat_needs[1]:.0f} g\"\n+                    else:\n+                        fat_range = \"æœªçŸ¥\"\n+                    \n                     st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\",\n-                             delta=f\"{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('è„‚è‚ª', [0,0])[0]:.1f}-{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('è„‚è‚ª', [0,0])[1]:.1f} g\",\n+                             delta=fat_range,\n                              delta_color=\"off\")\n+                    \n+                    # å¤„ç†ç¢³æ°´åŒ–åˆç‰©éœ€æ±‚æ ¼å¼\n+                    carb_needs = user_needs.get('ç¢³æ°´åŒ–åˆç‰©', [0,0])\n+                    if isinstance(carb_needs, (tuple, list)) and len(carb_needs) == 2:\n+                        carb_range = f\"{carb_needs[0]:.0f}-{carb_needs[1]:.0f} g\"\n+                    else:\n+                        carb_range = \"æœªçŸ¥\"\n+                    \n                     st.metric(\"æ€»ç¢³æ°´\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\",\n-                             delta=f\"{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('ç¢³æ°´åŒ–åˆç‰©', [0,0])[0]:.1f}-{recommendations['ç”¨æˆ·è¥å…»éœ€æ±‚'].get('ç¢³æ°´åŒ–åˆç‰©', [0,0])[1]:.1f} g\",\n+                             delta=carb_range,\n                              delta_color=\"off\")\n                 \n                 st.markdown(\"---\")\n                 st.markdown(\"##### ğŸ“ˆ è¥å…»ç´ æ»¡è¶³æƒ…å†µ\")\n@@ -378,69 +408,41 @@\n                 # å®é‡è¥å…»ç´ åˆ†æ\n                 st.markdown(\"**å®é‡è¥å…»ç´ **\")\n                 col_macronutrients = st.columns(2)\n                 with col_macronutrients[0]:\n-                    st.markdown(render_nutrition_card(\n-                        \"èƒ½é‡\", \n-                        total_nutrition.get('èƒ½é‡', 0),\n-                        user_needs.get('èƒ½é‡', [0, 0]),\n-                        \"kcal\"\n-                    ), unsafe_allow_html=True)\n+                    st.markdown(\"**èƒ½é‡**\")\n+                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                    st.metric(\"éœ€æ±‚èŒƒå›´\", energy_range)\n                     \n-                    st.markdown(render_nutrition_card(\n-                        \"è›‹ç™½è´¨\", \n-                        total_nutrition.get('è›‹ç™½è´¨', 0),\n-                        user_needs.get('è›‹ç™½è´¨', [0, 0]),\n-                        \"g\"\n-                    ), unsafe_allow_html=True)\n+                    st.markdown(\"**è›‹ç™½è´¨**\")\n+                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+                    st.metric(\"éœ€æ±‚èŒƒå›´\", protein_range)\n                     \n                 with col_macronutrients[1]:\n-                    st.markdown(render_nutrition_card(\n-                        \"è„‚è‚ª\", \n-                        total_nutrition.get('è„‚è‚ª', 0),\n-                        user_needs.get('è„‚è‚ª', [0, 0]),\n-                        \"g\"\n-                    ), unsafe_allow_html=True)\n+                    st.markdown(\"**è„‚è‚ª**\")\n+                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                    st.metric(\"éœ€æ±‚èŒƒå›´\", fat_range)\n                     \n-                    st.markdown(render_nutrition_card(\n-                        \"ç¢³æ°´åŒ–åˆç‰©\", \n-                        total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0),\n-                        user_needs.get('ç¢³æ°´åŒ–åˆç‰©', [0, 0]),\n-                        \"g\"\n-                    ), unsafe_allow_html=True)\n+                    st.markdown(\"**ç¢³æ°´åŒ–åˆç‰©**\")\n+                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+                    st.metric(\"éœ€æ±‚èŒƒå›´\", carb_range)\n                 \n                 # å¾®é‡è¥å…»ç´ åˆ†æ\n                 st.markdown(\"**å¾®é‡è¥å…»ç´ **\")\n                 col_micronutrients = st.columns(2)\n                 with col_micronutrients[0]:\n-                    st.markdown(render_nutrition_card(\n-                        \"é’ \", \n-                        total_nutrition.get('é’ ', 0),\n-                        user_needs.get('é’ ', [0, 0]) if isinstance(user_needs.get('é’ '), (list, tuple)) else user_needs.get('é’ ', 0),\n-                        \"mg\"\n-                    ), unsafe_allow_html=True)\n+                    st.markdown(\"**é’ **\")\n+                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n                     \n-                    st.markdown(render_nutrition_card(\n-                        \"é’™\", \n-                        total_nutrition.get('é’™', 0),\n-                        user_needs.get('é’™', [0, 0]) if isinstance(user_needs.get('é’™'), (list, tuple)) else user_needs.get('é’™', 0),\n-                        \"mg\"\n-                    ), unsafe_allow_html=True)\n+                    st.markdown(\"**é’™**\")\n+                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('é’™', 0):.1f} mg\")\n                     \n                 with col_micronutrients[1]:\n-                    st.markdown(render_nutrition_card(\n-                        \"é“\", \n-                        total_nutrition.get('é“', 0),\n-                        user_needs.get('é“', [0, 0]) if isinstance(user_needs.get('é“'), (list, tuple)) else user_needs.get('é“', 0),\n-                        \"mg\"\n-                    ), unsafe_allow_html=True)\n+                    st.markdown(\"**é“**\")\n+                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('é“', 0):.1f} mg\")\n                     \n-                    st.markdown(render_nutrition_card(\n-                        \"ç»´ç”Ÿç´ C\", \n-                        total_nutrition.get('ç»´ç”Ÿç´ C', 0),\n-                        user_needs.get('ç»´ç”Ÿç´ C', [0, 0]) if isinstance(user_needs.get('ç»´ç”Ÿç´ C'), (list, tuple)) else user_needs.get('ç»´ç”Ÿç´ C', 0),\n-                        \"mg\"\n-                    ), unsafe_allow_html=True)\n+                    st.markdown(\"**ç»´ç”Ÿç´ C**\")\n+                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n                 \n                 # è¥å…»åˆ†å¸ƒå›¾è¡¨\n                 st.markdown(\"---\")\n                 st.markdown(\"##### ğŸ“Š è¥å…»åˆ†å¸ƒ\")\n"
                },
                {
                    "date": 1752546370161,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -218,337 +218,197 @@\n     \n     st.selectbox(\"é¤åˆ«\", [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], key=\"meal_type\", index=1)\n \n # ä¸»å†…å®¹åŒº\n-main_container = st.container()\n+st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n \n-with main_container:\n-    col1, col2 = st.columns([1, 1])\n+# èœå“è¾“å…¥éƒ¨åˆ† - é¿å…åµŒå¥—åˆ—\n+for i, dish in enumerate(st.session_state.dishes):\n+    st.markdown(f\"**èœå“ #{i+1}**\")\n     \n+    # èœå“åç§°è¾“å…¥\n+    dish[\"name\"] = st.text_input(\n+        f\"èœå“åç§° #{i+1}\", \n+        value=dish[\"name\"], \n+        key=f\"dish_name_{i}\", \n+        placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n+    )\n+    \n+    # é‡é‡è¾“å…¥å’Œåˆ é™¤æŒ‰é’® - ä½¿ç”¨æ°´å¹³å¸ƒå±€ä½†é¿å…åµŒå¥—åˆ—\n+    col1, col2 = st.beta_columns([3, 1])\n     with col1:\n-        st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n-        \n-        for i, dish in enumerate(st.session_state.dishes):\n-            st.markdown(f\"**èœå“ #{i+1}**\")\n-            \n-            # ä½¿ç”¨CSSéšè—æ ‡ç­¾è€Œä¸æ˜¯label_visibilityå‚æ•°\n-            st.markdown('<div class=\"hidden-label\">', unsafe_allow_html=True)\n-            dish[\"name\"] = st.text_input(\n-                \"èœå“åç§°\", \n-                value=dish[\"name\"], \n-                key=f\"dish_name_{i}\", \n-                placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n-            )\n-            st.markdown('</div>', unsafe_allow_html=True)\n-            \n-            # é‡é‡è¾“å…¥å’Œåˆ é™¤æŒ‰é’®\n-            weight_col, remove_col = st.columns([3, 1])\n-            with weight_col:\n-                dish[\"weight\"] = st.number_input(\n-                    \"é‡é‡ (g)\", \n-                    min_value=1.0, \n-                    value=dish[\"weight\"], \n-                    key=f\"dish_weight_{i}\", \n-                    step=1.0\n-                )\n-            with remove_col:\n-                if i > 0:\n-                    if st.button(\"åˆ é™¤\", key=f\"remove_{i}\", use_container_width=True):\n-                        remove_dish(i)\n-                        st.experimental_rerun()\n-            \n-            st.divider()\n-        \n-        # æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n-        st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n-        if st.button(\"âœ¨ ç”Ÿæˆèœå“æ¨è\", type=\"primary\", use_container_width=True):\n-            if submit_form():\n-                if call_backend_service():\n-                    st.toast(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\", icon=\"âœ…\")\n-                else:\n-                    st.session_state.recommendations = None\n-                    st.toast(\"æ¨èç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯\", icon=\"âš ï¸\")\n+        dish[\"weight\"] = st.number_input(\n+            \"é‡é‡ (g)\", \n+            min_value=1.0, \n+            value=dish[\"weight\"], \n+            key=f\"dish_weight_{i}\", \n+            step=1.0\n+        )\n+    with col2:\n+        if i > 0:\n+            if st.button(\"åˆ é™¤\", key=f\"remove_{i}\"):\n+                remove_dish(i)\n+                st.experimental_rerun()\n+    \n+    st.markdown(\"---\")\n \n-# æ¨èç»“æœæ˜¾ç¤º\n+# æ·»åŠ æŒ‰é’®å’Œç”Ÿæˆæ¨è\n+st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish)\n+if st.button(\"âœ¨ ç”Ÿæˆèœå“æ¨è\", key=\"generate_recommendation\"):\n+    if submit_form():\n+        if call_backend_service():\n+            st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n+        else:\n+            st.session_state.recommendations = None\n+\n+# æ¨èç»“æœæ˜¾ç¤º - é¿å…åµŒå¥—åˆ—\n if st.session_state.recommendations:\n     recommendations = st.session_state.recommendations\n-    with col2:\n-        st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n-        st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n+    st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n+    st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n+    \n+    # åŸºæœ¬ä¿¡æ¯å¡ç‰‡\n+    with st.beta_expander(\"ğŸ“‹ åŸºæœ¬ä¿¡æ¯æ‘˜è¦\", expanded=True):\n+        col1, col2 = st.beta_columns(2)\n+        with col1:\n+            st.metric(\"é¤åˆ«\", recommendations.get(\"é¤åˆ«\", \"åˆé¤\"))\n+            st.metric(\"çŠ¶æ€\", recommendations.get(\"æ±‚è§£çŠ¶æ€\", \"æœªçŸ¥\"))\n+        with col2:\n+            st.metric(\"æ´»åŠ¨æ°´å¹³\", st.session_state.activity_level_label)\n+            energy_needs = recommendations.get('ç”¨æˆ·è¥å…»éœ€æ±‚', {}).get('èƒ½é‡', [0,0])\n+            if isinstance(energy_needs, (tuple, list)) and len(energy_needs) == 2:\n+                energy_range = f\"{energy_needs[0]:.0f}-{energy_needs[1]:.0f} kcal\"\n+            else:\n+                energy_range = \"æœªçŸ¥\"\n+            st.metric(\"èƒ½é‡éœ€æ±‚èŒƒå›´\", energy_range)\n+    \n+    # èœå“æ¨èæ ‡ç­¾é¡µ\n+    tab1, tab2, tab3 = st.beta_tabs([\"èœå“æ¨è\", \"è¥å…»åˆ†æ\", \"è¯¦æƒ…æ•°æ®\"])\n+    \n+    with tab1:\n+        st.markdown(\"#### ğŸ“‹ èœå“æ¨èåˆ—è¡¨\")\n         \n-        # åŸºæœ¬ä¿¡æ¯å¡ç‰‡\n-        with st.expander(\"ğŸ“‹ åŸºæœ¬ä¿¡æ¯æ‘˜è¦\", expanded=True):\n-            col_summary1, col_summary2 = st.columns(2)\n-            with col_summary1:\n-                st.metric(\"é¤åˆ«\", recommendations.get(\"é¤åˆ«\", \"åˆé¤\"))\n-                st.metric(\"çŠ¶æ€\", recommendations.get(\"æ±‚è§£çŠ¶æ€\", \"æœªçŸ¥\"))\n-            with col_summary2:\n-                st.metric(\"æ´»åŠ¨æ°´å¹³\", st.session_state.activity_level_label)\n-                # ç¡®ä¿èƒ½å¤„ç†å„ç§æ ¼å¼çš„èƒ½é‡éœ€æ±‚\n-                energy_needs = recommendations.get('ç”¨æˆ·è¥å…»éœ€æ±‚', {}).get('èƒ½é‡', [0,0])\n-                if isinstance(energy_needs, (tuple, list)) and len(energy_needs) == 2:\n-                    energy_range = f\"{energy_needs[0]:.0f}-{energy_needs[1]:.0f} kcal\"\n-                else:\n-                    energy_range = \"æœªçŸ¥\"\n-                st.metric(\"èƒ½é‡éœ€æ±‚èŒƒå›´\", energy_range)\n+        # æ’åºï¼šæŒ‰æƒé‡é™åº\n+        sorted_dishes = sorted(recommendations.get(\"èœå“æ¨è\", []), \n+                              key=lambda x: x.get(\"æ¨èæƒé‡\", 0), \n+                              reverse=True)\n         \n-        tab_rec, tab_nutrition, tab_details = st.tabs([\"èœå“æ¨è\", \"è¥å…»åˆ†æ\", \"è¯¦æƒ…æ•°æ®\"])\n-        \n-        with tab_rec:\n-            st.markdown(\"#### ğŸ“‹ èœå“æ¨èåˆ—è¡¨\")\n+        for dish in sorted_dishes:\n+            weight = dish.get(\"æ¨èæƒé‡\", 0)\n+            if weight >= 0.7:\n+                card_class = \"high-weight\"\n+                recommendation_text = \"å¼ºçƒˆæ¨è\"\n+            elif weight >= 0.5:\n+                card_class = \"medium-weight\"\n+                recommendation_text = \"æ¨è\"\n+            elif weight >= 0.3:\n+                card_class = \"medium-weight\"\n+                recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n+            else:\n+                card_class = \"low-weight\"\n+                recommendation_text = \"å°‘é‡å°è¯•\"\n             \n-            # æ’åºï¼šæŒ‰æƒé‡é™åº\n-            sorted_dishes = sorted(recommendations.get(\"èœå“æ¨è\", []), \n-                                  key=lambda x: x.get(\"æ¨èæƒé‡\", 0), \n-                                  reverse=True)\n+            st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n+            st.markdown(f\"#### ğŸ² {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n+            st.markdown(f\"**æ¨èæŒ‡æ•°**: {weight:.2f} ({recommendation_text})\")\n+            st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n             \n-            for dish in sorted_dishes:\n-                weight = dish.get(\"æ¨èæƒé‡\", 0)\n-                if weight >= 0.7:\n-                    card_class = \"high-weight\"\n-                    recommendation_text = \"å¼ºçƒˆæ¨è\"\n-                elif weight >= 0.5:\n-                    card_class = \"medium-weight\"\n-                    recommendation_text = \"æ¨è\"\n-                elif weight >= 0.3:\n-                    card_class = \"medium-weight\"\n-                    recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n-                else:\n-                    card_class = \"low-weight\"\n-                    recommendation_text = \"å°‘é‡å°è¯•\"\n-                \n-                with st.container():\n-                    st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n-                    \n-                    cols = st.columns([3, 2])\n-                    with cols[0]:\n-                        st.markdown(f\"#### ğŸ² {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n-                        st.markdown(f\"**æ¨èæŒ‡æ•°**: {weight:.2f} ({recommendation_text})\")\n-                    with cols[1]:\n-                        st.progress(min(weight, 1.0), text=f\"{recommendation_text}\")\n-                    \n-                    st.markdown(f\"##### ğŸ§  æ¨èç†ç”±\")\n-                    st.caption(f\"{dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n-                    \n-                    nutrition = dish.get(\"è¥å…»å€¼\", {})\n-                    if nutrition:\n-                        with st.expander(\"ğŸ“Š è¥å…»æˆåˆ†åˆ†æ\", expanded=False):\n-                            st.markdown(\"**ä¸»è¦è¥å…»ç´ **\")\n-                            col_nut1, col_nut2, col_nut3 = st.columns(3)\n-                            with col_nut1:\n-                                st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                                st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                            with col_nut2:\n-                                st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-                                st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                            with col_nut3:\n-                                st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n-                                st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n-                    \n-                    st.markdown(\"</div>\", unsafe_allow_html=True)\n+            nutrition = dish.get(\"è¥å…»å€¼\", {})\n+            if nutrition:\n+                with st.beta_expander(\"ğŸ“Š è¥å…»æˆåˆ†åˆ†æ\", expanded=False):\n+                    col1, col2, col3 = st.beta_columns(3)\n+                    with col1:\n+                        st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                        st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+                    with col2:\n+                        st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                        st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n+                    with col3:\n+                        st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n+                        st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n+            st.markdown(\"</div>\", unsafe_allow_html=True)\n+    \n+    with tab2:\n+        st.markdown(\"#### ğŸ“Š è¥å…»åˆ†æ\")\n         \n-        with tab_nutrition:\n-            st.markdown(\"#### ğŸ“Š è¥å…»åˆ†æ\")\n+        user_needs = recommendations.get(\"ç”¨æˆ·è¥å…»éœ€æ±‚\", {})\n+        total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n+        \n+        if total_nutrition and user_needs:\n+            st.markdown(\"##### ğŸ½ï¸ æ•´é¤è¥å…»æ‘˜è¦\")\n+            col1, col2 = st.beta_columns(2)\n             \n-            user_needs = recommendations.get(\"ç”¨æˆ·è¥å…»éœ€æ±‚\", {})\n-            total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n+            with col1:\n+                st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n+                st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n+            with col2:\n+                st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n+                st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n             \n-            if total_nutrition and user_needs:\n-                st.markdown(\"##### ğŸ½ï¸ æ•´é¤è¥å…»æ‘˜è¦\")\n-                col_sum1, col_sum2 = st.columns(2)\n-                \n-                with col_sum1:\n-                    # å¤„ç†èƒ½é‡éœ€æ±‚æ ¼å¼\n-                    energy_needs = user_needs.get('èƒ½é‡', [0,0])\n-                    if isinstance(energy_needs, (tuple, list)) and len(energy_needs) == 2:\n-                        energy_range = f\"{energy_needs[0]:.0f}-{energy_needs[1]:.0f} kcal\"\n-                    else:\n-                        energy_range = \"æœªçŸ¥\"\n-                    \n-                    st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\", \n-                             delta=energy_range,\n-                             delta_color=\"off\")\n-                    \n-                    # å¤„ç†è›‹ç™½è´¨éœ€æ±‚æ ¼å¼\n-                    protein_needs = user_needs.get('è›‹ç™½è´¨', [0,0])\n-                    if isinstance(protein_needs, (tuple, list)) and len(protein_needs) == 2:\n-                        protein_range = f\"{protein_needs[0]:.0f}-{protein_needs[1]:.0f} g\"\n-                    else:\n-                        protein_range = \"æœªçŸ¥\"\n-                    \n-                    st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\",\n-                             delta=protein_range,\n-                             delta_color=\"off\")\n-                \n-                with col_sum2:\n-                    # å¤„ç†è„‚è‚ªéœ€æ±‚æ ¼å¼\n-                    fat_needs = user_needs.get('è„‚è‚ª', [0,0])\n-                    if isinstance(fat_needs, (tuple, list)) and len(fat_needs) == 2:\n-                        fat_range = f\"{fat_needs[0]:.0f}-{fat_needs[1]:.0f} g\"\n-                    else:\n-                        fat_range = \"æœªçŸ¥\"\n-                    \n-                    st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\",\n-                             delta=fat_range,\n-                             delta_color=\"off\")\n-                    \n-                    # å¤„ç†ç¢³æ°´åŒ–åˆç‰©éœ€æ±‚æ ¼å¼\n-                    carb_needs = user_needs.get('ç¢³æ°´åŒ–åˆç‰©', [0,0])\n-                    if isinstance(carb_needs, (tuple, list)) and len(carb_needs) == 2:\n-                        carb_range = f\"{carb_needs[0]:.0f}-{carb_needs[1]:.0f} g\"\n-                    else:\n-                        carb_range = \"æœªçŸ¥\"\n-                    \n-                    st.metric(\"æ€»ç¢³æ°´\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\",\n-                             delta=carb_range,\n-                             delta_color=\"off\")\n-                \n-                st.markdown(\"---\")\n-                st.markdown(\"##### ğŸ“ˆ è¥å…»ç´ æ»¡è¶³æƒ…å†µ\")\n-                \n-                # å®é‡è¥å…»ç´ åˆ†æ\n-                st.markdown(\"**å®é‡è¥å…»ç´ **\")\n-                col_macronutrients = st.columns(2)\n-                with col_macronutrients[0]:\n-                    st.markdown(\"**èƒ½é‡**\")\n-                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n-                    st.metric(\"éœ€æ±‚èŒƒå›´\", energy_range)\n-                    \n-                    st.markdown(\"**è›‹ç™½è´¨**\")\n-                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n-                    st.metric(\"éœ€æ±‚èŒƒå›´\", protein_range)\n-                    \n-                with col_macronutrients[1]:\n-                    st.markdown(\"**è„‚è‚ª**\")\n-                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n-                    st.metric(\"éœ€æ±‚èŒƒå›´\", fat_range)\n-                    \n-                    st.markdown(\"**ç¢³æ°´åŒ–åˆç‰©**\")\n-                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n-                    st.metric(\"éœ€æ±‚èŒƒå›´\", carb_range)\n-                \n-                # å¾®é‡è¥å…»ç´ åˆ†æ\n-                st.markdown(\"**å¾®é‡è¥å…»ç´ **\")\n-                col_micronutrients = st.columns(2)\n-                with col_micronutrients[0]:\n-                    st.markdown(\"**é’ **\")\n-                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n-                    \n-                    st.markdown(\"**é’™**\")\n-                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('é’™', 0):.1f} mg\")\n-                    \n-                with col_micronutrients[1]:\n-                    st.markdown(\"**é“**\")\n-                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('é“', 0):.1f} mg\")\n-                    \n-                    st.markdown(\"**ç»´ç”Ÿç´ C**\")\n-                    st.metric(\"æ‘„å…¥é‡\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n-                \n-                # è¥å…»åˆ†å¸ƒå›¾è¡¨\n-                st.markdown(\"---\")\n-                st.markdown(\"##### ğŸ“Š è¥å…»åˆ†å¸ƒ\")\n-                \n-                main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n-                main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n-                df_main = pd.DataFrame({\n-                    \"è¥å…»ç´ \": main_nutrients,\n-                    \"å«é‡\": main_values,\n-                    \"å•ä½\": [NUTRIENT_UNITS.get(n, \"\") for n in main_nutrients]\n+            st.markdown(\"---\")\n+            st.markdown(\"##### ğŸ“ˆ è¥å…»åˆ†å¸ƒ\")\n+            \n+            # å®é‡è¥å…»ç´ å›¾è¡¨\n+            main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n+            main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n+            df_main = pd.DataFrame({\"è¥å…»ç´ \": main_nutrients, \"å«é‡\": main_values})\n+            st.bar_chart(df_main.set_index(\"è¥å…»ç´ \"))\n+            \n+            # å¾®é‡è¥å…»ç´ å›¾è¡¨\n+            micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n+            micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n+            st.markdown(\"##### å¾®é‡è¥å…»ç´ \")\n+            df_micro = pd.DataFrame({\"è¥å…»ç´ \": micro_nutrients, \"å«é‡\": micro_values})\n+            st.bar_chart(df_micro.set_index(\"è¥å…»ç´ \"))\n+    \n+    with tab3:\n+        st.markdown(\"#### ğŸ“Š è¯¦æƒ…æ•°æ®\")\n+        \n+        st.markdown(\"##### ç”¨æˆ·éœ€æ±‚è¥å…»èŒƒå›´\")\n+        if recommendations.get(\"ç”¨æˆ·è¥å…»éœ€æ±‚\"):\n+            df_needs = pd.DataFrame.from_dict(recommendations[\"ç”¨æˆ·è¥å…»éœ€æ±‚\"], orient=\"index\", columns=[\"å€¼\"])\n+            st.dataframe(df_needs)\n+        else:\n+            st.warning(\"æ— ç”¨æˆ·è¥å…»éœ€æ±‚æ•°æ®\")\n+        \n+        st.markdown(\"##### èœå“æ¨èè¯¦æƒ…\")\n+        if recommendations.get(\"èœå“æ¨è\"):\n+            dish_data = []\n+            for dish in recommendations[\"èœå“æ¨è\"]:\n+                dish_data.append({\n+                    \"èœå“åç§°\": dish.get(\"èœå“åç§°\", \"\"),\n+                    \"æ¨èæƒé‡\": dish.get(\"æ¨èæƒé‡\", 0),\n+                    \"åŸå› \": dish.get(\"åŸå› \", \"\")\n                 })\n-                st.bar_chart(df_main.set_index(\"è¥å…»ç´ \")[\"å«é‡\"])\n-                \n-                st.markdown(\"**ç»´ç”Ÿç´ åˆ†å¸ƒ**\")\n-                vitamin_nutrients = [\"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ B1\", \"ç»´ç”Ÿç´ B2\", \"ç»´ç”Ÿç´ C\"]\n-                vitamin_values = [total_nutrition.get(n, 0) for n in vitamin_nutrients]\n-                df_vitamin = pd.DataFrame({\n-                    \"ç»´ç”Ÿç´ \": vitamin_nutrients,\n-                    \"å«é‡\": vitamin_values,\n-                    \"å•ä½\": [NUTRIENT_UNITS.get(n, \"\") for n in vitamin_nutrients]\n-                })\n-                st.bar_chart(df_vitamin.set_index(\"ç»´ç”Ÿç´ \")[\"å«é‡\"])\n-                \n-                st.markdown(\"**çŸ¿ç‰©è´¨åˆ†å¸ƒ**\")\n-                mineral_nutrients = [\"é’ \", \"é’™\", \"é“\", \"é”Œ\"]\n-                mineral_values = [total_nutrition.get(n, 0) for n in mineral_nutrients]\n-                df_mineral = pd.DataFrame({\n-                    \"çŸ¿ç‰©è´¨\": mineral_nutrients,\n-                    \"å«é‡\": mineral_values,\n-                    \"å•ä½\": [NUTRIENT_UNITS.get(n, \"\") for n in mineral_nutrients]\n-                })\n-                st.bar_chart(df_mineral.set_index(\"çŸ¿ç‰©è´¨\")[\"å«é‡\"])\n+            st.dataframe(pd.DataFrame(dish_data))\n+        else:\n+            st.warning(\"æ— èœå“æ¨èæ•°æ®\")\n         \n-        with tab_details:\n-            st.markdown(\"#### ğŸ“Š è¯¦æƒ…æ•°æ®\")\n-            \n-            st.markdown(\"##### ç”¨æˆ·éœ€æ±‚è¥å…»èŒƒå›´\")\n-            if recommendations.get(\"ç”¨æˆ·è¥å…»éœ€æ±‚\"):\n-                df_needs = pd.DataFrame.from_dict(recommendations[\"ç”¨æˆ·è¥å…»éœ€æ±‚\"], orient=\"index\", columns=[\"å€¼\"])\n-                st.dataframe(df_needs, use_container_width=True)\n-            else:\n-                st.warning(\"æ— ç”¨æˆ·è¥å…»éœ€æ±‚æ•°æ®\")\n-            \n-            st.markdown(\"##### èœå“æ¨èè¯¦æƒ…\")\n-            if recommendations.get(\"èœå“æ¨è\"):\n-                dish_data = []\n-                for dish in recommendations[\"èœå“æ¨è\"]:\n-                    dish_data.append({\n-                        \"èœå“åç§°\": dish.get(\"èœå“åç§°\", \"\"),\n-                        \"æ¨èæƒé‡\": dish.get(\"æ¨èæƒé‡\", 0),\n-                        \"åŸå› \": dish.get(\"åŸå› \", \"\")\n-                    })\n-                st.dataframe(pd.DataFrame(dish_data), use_container_width=True)\n-            else:\n-                st.warning(\"æ— èœå“æ¨èæ•°æ®\")\n-            \n-            st.markdown(\"##### æ•´é¤è¥å…»æ‘˜è¦\")\n-            if recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\"):\n-                df_total = pd.DataFrame.from_dict(recommendations[\"æ•´é¤è¥å…»æ‘˜è¦\"], orient=\"index\", columns=[\"å€¼\"])\n-                st.dataframe(df_total, use_container_width=True)\n-            else:\n-                st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n+        st.markdown(\"##### æ•´é¤è¥å…»æ‘˜è¦\")\n+        if recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\"):\n+            df_total = pd.DataFrame.from_dict(recommendations[\"æ•´é¤è¥å…»æ‘˜è¦\"], orient=\"index\", columns=[\"å€¼\"])\n+            st.dataframe(df_total)\n+        else:\n+            st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n else:\n-    with col2:\n-        st.info(\"âœ¨ è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n+    st.info(\"âœ¨ è¯·å¡«å†™ä¸ªäººä¿¡æ¯å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n \n # ä½¿ç”¨è¯´æ˜\n st.markdown(\"---\")\n-with st.expander(\"â„¹ï¸ ä½¿ç”¨è¯´æ˜\"):\n-    st.markdown(\"\"\"\n-    ### ä½¿ç”¨æŒ‡å—\n-    \n-    1. **å¡«å†™ä¸ªäººä¿¡æ¯**ï¼š\n-       - åœ¨å·¦ä¾§æ å®Œæ•´å¡«å†™æ‚¨çš„æ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰ä¿¡æ¯\n-       - é€‰æ‹©æ‚¨çš„æ´»åŠ¨æ°´å¹³ï¼ˆæ ¹æ®æ—¥å¸¸æ´»åŠ¨å¼ºåº¦ï¼‰\n-       - é€‰æ‹©è¦è§„åˆ’çš„é¤åˆ«ï¼ˆæ—©é¤/åˆé¤/æ™šé¤ï¼‰\n-    \n-    2. **æ·»åŠ èœå“ä¿¡æ¯**ï¼š\n-       - è¾“å…¥èœå“åç§°ï¼ˆå¦‚ï¼šç•ªèŒ„ç‚’è›‹ï¼‰\n-       - è®¾ç½®èœå“ä»½é‡ï¼ˆå…‹æ•°ï¼‰\n-       - å¯æ·»åŠ å¤šä¸ªèœå“è¿›è¡Œæ··åˆåˆ†æ\n-    \n-    3. **ç”Ÿæˆæ¨è**ï¼š\n-       - ç‚¹å‡»\"âœ¨ ç”Ÿæˆèœå“æ¨è\"æŒ‰é’®è¿›è¡Œåˆ†æ\n-       - ç³»ç»Ÿå°†æ ¹æ®æ‚¨çš„ä¸ªäººæƒ…å†µå’Œèœå“ç‰¹ç‚¹ç”Ÿæˆæ¨è\n-    \n-    4. **æŸ¥çœ‹ç»“æœ**ï¼š\n-       - åœ¨å³ä¾§æ¨èç»“æœåŒºåŸŸæŸ¥çœ‹åˆ†æç»“æœ\n-       - é€šè¿‡ä¸‰ä¸ªæ ‡ç­¾é¡µåˆ†åˆ«æŸ¥çœ‹ï¼š\n-         - ğŸ“‹ èœå“æ¨è - å„èœå“æ¨èæŒ‡æ•°åŠåŸå› \n-         - ğŸ“Š è¥å…»åˆ†æ - æ•´é¤è¥å…»æ„æˆåŠéœ€æ±‚æ»¡è¶³æƒ…å†µ\n-         - ğŸ“Š è¯¦æƒ…æ•°æ® - è¯¦ç»†çš„æ•°æ®è¡¨æ ¼\n-    \"\"\")\n-    \n-    st.markdown(\"### æ¨èæƒé‡è¯´æ˜\")\n-    cols_legend = st.columns(4)\n-    with cols_legend[0]:\n-        st.markdown(\"<div class='recommendation-card high-weight'><b>å¼ºçƒˆæ¨è</b><br>(æƒé‡ â‰¥ 0.7)</div>\", unsafe_allow_html=True)\n-    with cols_legend[1]:\n-        st.markdown(\"<div class='recommendation-card medium-weight'><b>æ¨è</b><br>(0.5 â‰¤ æƒé‡ < 0.7)</div>\", unsafe_allow_html=True)\n-    with cols_legend[2]:\n-        st.markdown(\"<div class='recommendation-card medium-weight'><b>é€‚é‡é£Ÿç”¨</b><br>(0.3 â‰¤ æƒé‡ < 0.5)</div>\", unsafe_allow_html=True)\n-    with cols_legend[3]:\n-        st.markdown(\"<div class='recommendation-card low-weight'><b>å°‘é‡å°è¯•</b><br>(æƒé‡ < 0.3)</div>\", unsafe_allow_html=True)\n+st.markdown(\"\"\"\n+### ä½¿ç”¨è¯´æ˜\n+1. åœ¨å·¦ä¾§å¡«å†™æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰ï¼‰\n+2. æ·»åŠ æ‚¨æƒ³è¯„ä¼°çš„èœå“ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰\n+3. ç‚¹å‡»\"ç”Ÿæˆèœå“æ¨è\"æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\n+4. æŸ¥çœ‹æ¨èç»“æœï¼Œäº†è§£æ¯é“èœçš„æ¨èç¨‹åº¦å’ŒåŸå› \n \n+**æ¨èæƒé‡è¯´æ˜**:\n+- **å¼ºçƒˆæ¨è (æƒé‡ â‰¥ 0.7)**: è¥å…»å‡è¡¡ä¸”ç¬¦åˆéœ€æ±‚  \n+- **æ¨è (0.5 â‰¤ æƒé‡ < 0.7)**: è¥å…»è‰¯å¥½ï¼Œé€‚åˆé£Ÿç”¨  \n+- **é€‚é‡é£Ÿç”¨ (0.3 â‰¤ æƒé‡ < 0.5)**: å¯ä»¥å°‘é‡é£Ÿç”¨  \n+- **å°‘é‡å°è¯• (æƒé‡ < 0.3)**: å»ºè®®æœ¬é¤é¿å…æˆ–å°‘é‡å°è¯•\n+\"\"\")\n+\n # è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰\n if st.checkbox(\"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯\"):\n     st.markdown(\"### è¯·æ±‚æ•°æ®\")\n     st.json(st.session_state.request_data)\n"
                },
                {
                    "date": 1752546628249,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -76,8 +76,28 @@\n     }\n     .hidden-label label {\n         display: none;\n     }\n+    .tab-content {\n+        padding: 15px;\n+        border: 1px solid #e0e0e0;\n+        border-radius: 0 0 12px 12px;\n+        border-top: none;\n+        margin-top: -10px;\n+    }\n+    .tab-button {\n+        padding: 10px 20px;\n+        border: 1px solid #e0e0e0;\n+        border-radius: 12px 12px 0 0;\n+        background-color: #f0f0f0;\n+        cursor: pointer;\n+        margin-right: 5px;\n+    }\n+    .tab-button.active {\n+        background-color: #fff;\n+        border-bottom: none;\n+        font-weight: bold;\n+    }\n </style>\n \"\"\", unsafe_allow_html=True)\n \n # åº”ç”¨æ ‡é¢˜\n@@ -119,8 +139,10 @@\n if 'response_time' not in st.session_state:\n     st.session_state.response_time = None\n if 'selected_dish' not in st.session_state:\n     st.session_state.selected_dish = None\n+if 'active_tab' not in st.session_state:\n+    st.session_state.active_tab = \"èœå“æ¨è\"\n \n # æ·»åŠ èœå“\n def add_dish():\n     st.session_state.dishes.append({\"name\": \"\", \"weight\": 100.0})\n@@ -220,9 +242,9 @@\n \n # ä¸»å†…å®¹åŒº\n st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n \n-# èœå“è¾“å…¥éƒ¨åˆ† - é¿å…åµŒå¥—åˆ—\n+# èœå“è¾“å…¥éƒ¨åˆ†\n for i, dish in enumerate(st.session_state.dishes):\n     st.markdown(f\"**èœå“ #{i+1}**\")\n     \n     # èœå“åç§°è¾“å…¥\n@@ -232,10 +254,10 @@\n         key=f\"dish_name_{i}\", \n         placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n     )\n     \n-    # é‡é‡è¾“å…¥å’Œåˆ é™¤æŒ‰é’® - ä½¿ç”¨æ°´å¹³å¸ƒå±€ä½†é¿å…åµŒå¥—åˆ—\n-    col1, col2 = st.beta_columns([3, 1])\n+    # é‡é‡è¾“å…¥å’Œåˆ é™¤æŒ‰é’®\n+    col1, col2 = st.columns([3, 1])\n     with col1:\n         dish[\"weight\"] = st.number_input(\n             \"é‡é‡ (g)\", \n             min_value=1.0, \n@@ -259,17 +281,17 @@\n             st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n         else:\n             st.session_state.recommendations = None\n \n-# æ¨èç»“æœæ˜¾ç¤º - é¿å…åµŒå¥—åˆ—\n+# æ¨èç»“æœæ˜¾ç¤º\n if st.session_state.recommendations:\n     recommendations = st.session_state.recommendations\n     st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n     st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n     \n     # åŸºæœ¬ä¿¡æ¯å¡ç‰‡\n-    with st.beta_expander(\"ğŸ“‹ åŸºæœ¬ä¿¡æ¯æ‘˜è¦\", expanded=True):\n-        col1, col2 = st.beta_columns(2)\n+    with st.expander(\"ğŸ“‹ åŸºæœ¬ä¿¡æ¯æ‘˜è¦\", expanded=True):\n+        col1, col2 = st.columns(2)\n         with col1:\n             st.metric(\"é¤åˆ«\", recommendations.get(\"é¤åˆ«\", \"åˆé¤\"))\n             st.metric(\"çŠ¶æ€\", recommendations.get(\"æ±‚è§£çŠ¶æ€\", \"æœªçŸ¥\"))\n         with col2:\n@@ -280,12 +302,21 @@\n             else:\n                 energy_range = \"æœªçŸ¥\"\n             st.metric(\"èƒ½é‡éœ€æ±‚èŒƒå›´\", energy_range)\n     \n+    # è‡ªå®šä¹‰æ ‡ç­¾é¡µå®ç°\n+    tabs = [\"èœå“æ¨è\", \"è¥å…»åˆ†æ\", \"è¯¦æƒ…æ•°æ®\"]\n+    tab_buttons = st.columns(len(tabs))\n+    \n+    for i, tab in enumerate(tabs):\n+        with tab_buttons[i]:\n+            if st.button(tab, key=f\"tab_{i}\"):\n+                st.session_state.active_tab = tab\n+    \n+    st.markdown(f\"<div class='tab-content'>\", unsafe_allow_html=True)\n+    \n     # èœå“æ¨èæ ‡ç­¾é¡µ\n-    tab1, tab2, tab3 = st.beta_tabs([\"èœå“æ¨è\", \"è¥å…»åˆ†æ\", \"è¯¦æƒ…æ•°æ®\"])\n-    \n-    with tab1:\n+    if st.session_state.active_tab == \"èœå“æ¨è\":\n         st.markdown(\"#### ğŸ“‹ èœå“æ¨èåˆ—è¡¨\")\n         \n         # æ’åºï¼šæŒ‰æƒé‡é™åº\n         sorted_dishes = sorted(recommendations.get(\"èœå“æ¨è\", []), \n@@ -313,10 +344,10 @@\n             st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n             \n             nutrition = dish.get(\"è¥å…»å€¼\", {})\n             if nutrition:\n-                with st.beta_expander(\"ğŸ“Š è¥å…»æˆåˆ†åˆ†æ\", expanded=False):\n-                    col1, col2, col3 = st.beta_columns(3)\n+                with st.expander(\"ğŸ“Š è¥å…»æˆåˆ†åˆ†æ\", expanded=False):\n+                    col1, col2, col3 = st.columns(3)\n                     with col1:\n                         st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n                         st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n                     with col2:\n@@ -326,17 +357,18 @@\n                         st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n                         st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n             st.markdown(\"</div>\", unsafe_allow_html=True)\n     \n-    with tab2:\n+    # è¥å…»åˆ†ææ ‡ç­¾é¡µ\n+    elif st.session_state.active_tab == \"è¥å…»åˆ†æ\":\n         st.markdown(\"#### ğŸ“Š è¥å…»åˆ†æ\")\n         \n         user_needs = recommendations.get(\"ç”¨æˆ·è¥å…»éœ€æ±‚\", {})\n         total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n         \n         if total_nutrition and user_needs:\n             st.markdown(\"##### ğŸ½ï¸ æ•´é¤è¥å…»æ‘˜è¦\")\n-            col1, col2 = st.beta_columns(2)\n+            col1, col2 = st.columns(2)\n             \n             with col1:\n                 st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n                 st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n@@ -359,9 +391,10 @@\n             st.markdown(\"##### å¾®é‡è¥å…»ç´ \")\n             df_micro = pd.DataFrame({\"è¥å…»ç´ \": micro_nutrients, \"å«é‡\": micro_values})\n             st.bar_chart(df_micro.set_index(\"è¥å…»ç´ \"))\n     \n-    with tab3:\n+    # è¯¦æƒ…æ•°æ®æ ‡ç­¾é¡µ\n+    elif st.session_state.active_tab == \"è¯¦æƒ…æ•°æ®\":\n         st.markdown(\"#### ğŸ“Š è¯¦æƒ…æ•°æ®\")\n         \n         st.markdown(\"##### ç”¨æˆ·éœ€æ±‚è¥å…»èŒƒå›´\")\n         if recommendations.get(\"ç”¨æˆ·è¥å…»éœ€æ±‚\"):\n@@ -388,8 +421,10 @@\n             df_total = pd.DataFrame.from_dict(recommendations[\"æ•´é¤è¥å…»æ‘˜è¦\"], orient=\"index\", columns=[\"å€¼\"])\n             st.dataframe(df_total)\n         else:\n             st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n+    \n+    st.markdown(\"</div>\", unsafe_allow_html=True)\n else:\n     st.info(\"âœ¨ è¯·å¡«å†™ä¸ªäººä¿¡æ¯å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n \n # ä½¿ç”¨è¯´æ˜\n"
                },
                {
                    "date": 1752547968189,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -391,16 +391,30 @@\n             st.markdown(\"##### å¾®é‡è¥å…»ç´ \")\n             df_micro = pd.DataFrame({\"è¥å…»ç´ \": micro_nutrients, \"å«é‡\": micro_values})\n             st.bar_chart(df_micro.set_index(\"è¥å…»ç´ \"))\n     \n-    # è¯¦æƒ…æ•°æ®æ ‡ç­¾é¡µ\n+    # è¯¦æƒ…æ•°æ®æ ‡ç­¾é¡µ - ä¿®å¤äº†ValueErroré”™è¯¯\n     elif st.session_state.active_tab == \"è¯¦æƒ…æ•°æ®\":\n         st.markdown(\"#### ğŸ“Š è¯¦æƒ…æ•°æ®\")\n         \n         st.markdown(\"##### ç”¨æˆ·éœ€æ±‚è¥å…»èŒƒå›´\")\n         if recommendations.get(\"ç”¨æˆ·è¥å…»éœ€æ±‚\"):\n-            df_needs = pd.DataFrame.from_dict(recommendations[\"ç”¨æˆ·è¥å…»éœ€æ±‚\"], orient=\"index\", columns=[\"å€¼\"])\n-            st.dataframe(df_needs)\n+            # åˆ›å»ºæ ¼å¼åŒ–åçš„è¥å…»éœ€æ±‚å­—å…¸\n+            formatted_needs = {}\n+            for nutrient, value in recommendations[\"ç”¨æˆ·è¥å…»éœ€æ±‚\"].items():\n+                # å¤„ç†èŒƒå›´å€¼\n+                if isinstance(value, (list, tuple)) and len(value) == 2:\n+                    formatted_needs[nutrient] = f\"{value[0]:.1f}-{value[1]:.1f}\"\n+                # å¤„ç†å•ä¸ªå€¼\n+                elif isinstance(value, (int, float)):\n+                    formatted_needs[nutrient] = f\"{value:.1f}\"\n+                # å¤„ç†å…¶ä»–ç±»å‹\n+                else:\n+                    formatted_needs[nutrient] = str(value)\n+            \n+            # åˆ›å»ºDataFrame\n+            df_needs = pd.DataFrame.from_dict(formatted_needs, orient=\"index\", columns=[\"å€¼\"])\n+            st.dataframe(df_needs, use_container_width=True)\n         else:\n             st.warning(\"æ— ç”¨æˆ·è¥å…»éœ€æ±‚æ•°æ®\")\n         \n         st.markdown(\"##### èœå“æ¨èè¯¦æƒ…\")\n@@ -411,16 +425,29 @@\n                     \"èœå“åç§°\": dish.get(\"èœå“åç§°\", \"\"),\n                     \"æ¨èæƒé‡\": dish.get(\"æ¨èæƒé‡\", 0),\n                     \"åŸå› \": dish.get(\"åŸå› \", \"\")\n                 })\n-            st.dataframe(pd.DataFrame(dish_data))\n+            st.dataframe(pd.DataFrame(dish_data), use_container_width=True)\n         else:\n             st.warning(\"æ— èœå“æ¨èæ•°æ®\")\n         \n         st.markdown(\"##### æ•´é¤è¥å…»æ‘˜è¦\")\n         if recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\"):\n-            df_total = pd.DataFrame.from_dict(recommendations[\"æ•´é¤è¥å…»æ‘˜è¦\"], orient=\"index\", columns=[\"å€¼\"])\n-            st.dataframe(df_total)\n+            # åˆ›å»ºæ ¼å¼åŒ–åçš„è¥å…»æ‘˜è¦å­—å…¸\n+            formatted_total = {}\n+            for nutrient, value in recommendations[\"æ•´é¤è¥å…»æ‘˜è¦\"].items():\n+                # å¤„ç†èŒƒå›´å€¼\n+                if isinstance(value, (list, tuple)) and len(value) == 2:\n+                    formatted_total[nutrient] = f\"{value[0]:.1f}-{value[1]:.1f}\"\n+                # å¤„ç†å•ä¸ªå€¼\n+                elif isinstance(value, (int, float)):\n+                    formatted_total[nutrient] = f\"{value:.1f}\"\n+                # å¤„ç†å…¶ä»–ç±»å‹\n+                else:\n+                    formatted_total[nutrient] = str(value)\n+            \n+            df_total = pd.DataFrame.from_dict(formatted_total, orient=\"index\", columns=[\"å€¼\"])\n+            st.dataframe(df_total, use_container_width=True)\n         else:\n             st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n     \n     st.markdown(\"</div>\", unsafe_allow_html=True)\n"
                },
                {
                    "date": 1752548195623,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -96,8 +96,12 @@\n         background-color: #fff;\n         border-bottom: none;\n         font-weight: bold;\n     }\n+    .dataframe-container {\n+        width: 100%;\n+        overflow-x: auto;\n+    }\n </style>\n \"\"\", unsafe_allow_html=True)\n \n # åº”ç”¨æ ‡é¢˜\n@@ -412,9 +416,11 @@\n                     formatted_needs[nutrient] = str(value)\n             \n             # åˆ›å»ºDataFrame\n             df_needs = pd.DataFrame.from_dict(formatted_needs, orient=\"index\", columns=[\"å€¼\"])\n-            st.dataframe(df_needs, use_container_width=True)\n+            st.markdown(\"<div class='dataframe-container'>\", unsafe_allow_html=True)\n+            st.dataframe(df_needs)\n+            st.markdown(\"</div>\", unsafe_allow_html=True)\n         else:\n             st.warning(\"æ— ç”¨æˆ·è¥å…»éœ€æ±‚æ•°æ®\")\n         \n         st.markdown(\"##### èœå“æ¨èè¯¦æƒ…\")\n@@ -425,9 +431,11 @@\n                     \"èœå“åç§°\": dish.get(\"èœå“åç§°\", \"\"),\n                     \"æ¨èæƒé‡\": dish.get(\"æ¨èæƒé‡\", 0),\n                     \"åŸå› \": dish.get(\"åŸå› \", \"\")\n                 })\n-            st.dataframe(pd.DataFrame(dish_data), use_container_width=True)\n+            st.markdown(\"<div class='dataframe-container'>\", unsafe_allow_html=True)\n+            st.dataframe(pd.DataFrame(dish_data))\n+            st.markdown(\"</div>\", unsafe_allow_html=True)\n         else:\n             st.warning(\"æ— èœå“æ¨èæ•°æ®\")\n         \n         st.markdown(\"##### æ•´é¤è¥å…»æ‘˜è¦\")\n@@ -445,9 +453,11 @@\n                 else:\n                     formatted_total[nutrient] = str(value)\n             \n             df_total = pd.DataFrame.from_dict(formatted_total, orient=\"index\", columns=[\"å€¼\"])\n-            st.dataframe(df_total, use_container_width=True)\n+            st.markdown(\"<div class='dataframe-container'>\", unsafe_allow_html=True)\n+            st.dataframe(df_total)\n+            st.markdown(\"</div>\", unsafe_allow_html=True)\n         else:\n             st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n     \n     st.markdown(\"</div>\", unsafe_allow_html=True)\n"
                },
                {
                    "date": 1752558121517,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -157,9 +157,9 @@\n         st.session_state.dishes.pop(index)\n \n # æ´»åŠ¨æ°´å¹³æ˜ å°„\n ACTIVITY_MAPPING = {\n-    \"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\": \"a\",\n+    \"è½»æ´»åŠ¨æ°´å¹³()\": \"a\",\n     \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\": \"b\",\n     \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\": \"c\"\n }\n \n"
                },
                {
                    "date": 1752558127565,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -157,11 +157,11 @@\n         st.session_state.dishes.pop(index)\n \n # æ´»åŠ¨æ°´å¹³æ˜ å°„\n ACTIVITY_MAPPING = {\n-    \"è½»æ´»åŠ¨æ°´å¹³()\": \"a\",\n-    \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\": \"b\",\n-    \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\": \"c\"\n+    \"è½»æ´»åŠ¨æ°´å¹³\": \"a\",\n+    \"ä¸­æ´»åŠ¨æ°´å¹³\": \"b\",\n+    \"é‡æ´»åŠ¨æ°´å¹³: \"c\"\n }\n \n # æäº¤è¡¨å•\n def submit_form():\n"
                },
                {
                    "date": 1752558133260,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -159,9 +159,9 @@\n # æ´»åŠ¨æ°´å¹³æ˜ å°„\n ACTIVITY_MAPPING = {\n     \"è½»æ´»åŠ¨æ°´å¹³\": \"a\",\n     \"ä¸­æ´»åŠ¨æ°´å¹³\": \"b\",\n-    \"é‡æ´»åŠ¨æ°´å¹³: \"c\"\n+    \"é‡æ´»åŠ¨æ°´å¹³\": \"c\"\n }\n \n # æäº¤è¡¨å•\n def submit_form():\n"
                },
                {
                    "date": 1752558150756,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -266,9 +266,9 @@\n             \"é‡é‡ (g)\", \n             min_value=1.0, \n             value=dish[\"weight\"], \n             key=f\"dish_weight_{i}\", \n-            step=1.0\n+            step=10.0\n         )\n     with col2:\n         if i > 0:\n             if st.button(\"åˆ é™¤\", key=f\"remove_{i}\"):\n"
                },
                {
                    "date": 1752561174931,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,9 +7,9 @@\n from datetime import datetime\n \n # è®¾ç½®é¡µé¢é…ç½®\n st.set_page_config(\n-    page_title=\"æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n+    page_title=\"ä¸­ç§‘shen'jianæ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n     page_icon=\"ğŸ²\",\n     layout=\"wide\",\n     initial_sidebar_state=\"expanded\"\n )\n"
                },
                {
                    "date": 1752561182813,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,9 +7,9 @@\n from datetime import datetime\n \n # è®¾ç½®é¡µé¢é…ç½®\n st.set_page_config(\n-    page_title=\"ä¸­ç§‘shen'jianæ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n+    page_title=\"ä¸­ç§‘æ·±å¥æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n     page_icon=\"ğŸ²\",\n     layout=\"wide\",\n     initial_sidebar_state=\"expanded\"\n )\n"
                },
                {
                    "date": 1752561259218,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -106,9 +106,9 @@\n \n # åº”ç”¨æ ‡é¢˜\n st.markdown(\"\"\"\n <div class=\"header\">\n-    <h1 style=\"text-align:center; margin:0;\">ğŸ² æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n+    <h1 style=\"text-align:center; margin:0;\">ğŸ² ä¸­ç§‘shen'jianæ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n     <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n </div>\n \"\"\", unsafe_allow_html=True)\n \n"
                },
                {
                    "date": 1752561265859,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -106,9 +106,9 @@\n \n # åº”ç”¨æ ‡é¢˜\n st.markdown(\"\"\"\n <div class=\"header\">\n-    <h1 style=\"text-align:center; margin:0;\">ğŸ² ä¸­ç§‘shen'jianæ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n+    <h1 style=\"text-align:center; margin:0;\">ğŸ² ä¸­ç§‘æ·±å¥æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n     <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n </div>\n \"\"\", unsafe_allow_html=True)\n \n"
                },
                {
                    "date": 1752561279824,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -107,9 +107,9 @@\n # åº”ç”¨æ ‡é¢˜\n st.markdown(\"\"\"\n <div class=\"header\">\n     <h1 style=\"text-align:center; margin:0;\">ğŸ² ä¸­ç§‘æ·±å¥æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n-    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n+    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸çš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n </div>\n \"\"\", unsafe_allow_html=True)\n \n # åç«¯æœåŠ¡URL\n"
                },
                {
                    "date": 1752561286019,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -107,9 +107,9 @@\n # åº”ç”¨æ ‡é¢˜\n st.markdown(\"\"\"\n <div class=\"header\">\n     <h1 style=\"text-align:center; margin:0;\">ğŸ² ä¸­ç§‘æ·±å¥æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n-    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸çš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n+    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸FoodSkyçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n </div>\n \"\"\", unsafe_allow_html=True)\n \n # åç«¯æœåŠ¡URL\n"
                },
                {
                    "date": 1752561298683,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -107,9 +107,9 @@\n # åº”ç”¨æ ‡é¢˜\n st.markdown(\"\"\"\n <div class=\"header\">\n     <h1 style=\"text-align:center; margin:0;\">ğŸ² ä¸­ç§‘æ·±å¥æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n-    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸FoodSkyçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n+    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸FoodSkyå¤§æ¨¡å‹çš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n </div>\n \"\"\", unsafe_allow_html=True)\n \n # åç«¯æœåŠ¡URL\n"
                },
                {
                    "date": 1752564397739,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,29 +16,66 @@\n \n # è‡ªå®šä¹‰CSSæ ·å¼\n st.markdown(\"\"\"\n <style>\n-    .recommendation-card {\n-        border: 1px solid #e0e0e0;\n-        border-radius: 12px;\n-        padding: 15px;\n-        margin-bottom: 10px;\n-        background-color: #fafafa;\n-        transition: transform 0.2s, box-shadow 0.2s;\n-    }\n-    .recommendation-card:hover {\n-        transform: translateY(-3px);\n-        box-shadow: 0 4px 8px rgba(0,0,0,0.1);\n-    }\n-    .high-weight {\n-        border-left: 6px solid #4CAF50;\n-    }\n-    .medium-weight {\n-        border-left: 6px solid #FFC107;\n-    }\n-    .low-weight {\n-        border-left: 6px solid #F44336;\n-    }\n+/* åœ¨ç°æœ‰CSSæ ·å¼éƒ¨åˆ†æ·»åŠ /ä¿®æ”¹ä»¥ä¸‹å†…å®¹ */\n+\n+.recommendation-card {\n+    border-radius: 12px;\n+    padding: 15px;\n+    margin-bottom: 15px;\n+    transition: all 0.3s ease;\n+    box-shadow: 0 4px 10px rgba(0,0,0,0.05);\n+    background: white; /* é»˜è®¤èƒŒæ™¯è‰² */\n+}\n+\n+/* å¼ºçƒˆæ¨è - å†…éƒ¨èƒŒæ™¯ä¸ºæµ…ç»¿è‰² */\n+.high-weight {\n+    background-color: #E8F5E9 !important; /* éå¸¸æµ…çš„ç»¿è‰² */\n+    border: 2px solid #4CAF50; /* å¤–è¾¹æ¡†ä¸ºç»¿è‰² */\n+    border-left: 6px solid #4CAF50; /* å·¦ä¾§æ¡ä¿ç•™ */\n+}\n+\n+/* æ¨è - å†…éƒ¨èƒŒæ™¯ä¸ºæµ…é»„è‰² */\n+.medium-weight {\n+    background-color: #FFFDE7 !important; /* éå¸¸æµ…çš„é»„è‰² */\n+    border: 2px solid #FFC107; /* å¤–è¾¹æ¡†ä¸ºé»„è‰² */\n+    border-left: 6px solid #FFC107; /* å·¦ä¾§æ¡ä¿ç•™ */\n+}\n+\n+/* å°‘é‡å°è¯• - å†…éƒ¨èƒŒæ™¯ä¸ºæµ…çº¢è‰² */\n+.low-weight {\n+    background-color: #FFEBEE !important; /* éå¸¸æµ…çš„çº¢è‰² */\n+    border: 2px solid #F44336; /* å¤–è¾¹æ¡†ä¸ºçº¢è‰² */\n+    border-left: 6px solid #F44336; /* å·¦ä¾§æ¡ä¿ç•™ */\n+}\n+\n+/* æ‚¬åœæ•ˆæœ */\n+.recommendation-card:hover {\n+    transform: translateY(-5px);\n+    box-shadow: 0 8px 15px rgba(0,0,0,0.1);\n+}\n+\n+/* å¼ºçƒˆæ¨èæ‚¬åœæ—¶èƒŒæ™¯åŠ æ·± */\n+.high-weight:hover {\n+    background-color: #C8E6C9 !important;\n+}\n+\n+/* æ¨èæ‚¬åœæ—¶èƒŒæ™¯åŠ æ·± */\n+.medium-weight:hover {\n+    background-color: #FFECB3 !important;\n+}\n+\n+/* å°‘é‡å°è¯•æ‚¬åœæ—¶èƒŒæ™¯åŠ æ·± */\n+.low-weight:hover {\n+    background-color: #FFCDD2 !important;\n+}\n+\n+/* æ ‡é¢˜é¢œè‰²å¢å¼º */\n+.recommendation-card h3 {\n+    color: #333; /* æ·±ç°è‰²å¢å¼ºå¯è¯»æ€§ */\n+    margin-top: 0;\n+}\n     .nutrient-bar {\n         height: 10px;\n         background-color: #f0f0f0;\n         border-radius: 5px;\n"
                },
                {
                    "date": 1752564407643,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,64 +18,64 @@\n st.markdown(\"\"\"\n <style>\n /* åœ¨ç°æœ‰CSSæ ·å¼éƒ¨åˆ†æ·»åŠ /ä¿®æ”¹ä»¥ä¸‹å†…å®¹ */\n \n-.recommendation-card {\n-    border-radius: 12px;\n-    padding: 15px;\n-    margin-bottom: 15px;\n-    transition: all 0.3s ease;\n-    box-shadow: 0 4px 10px rgba(0,0,0,0.05);\n-    background: white; /* é»˜è®¤èƒŒæ™¯è‰² */\n-}\n+    .recommendation-card {\n+        border-radius: 12px;\n+        padding: 15px;\n+        margin-bottom: 15px;\n+        transition: all 0.3s ease;\n+        box-shadow: 0 4px 10px rgba(0,0,0,0.05);\n+        background: white; /* é»˜è®¤èƒŒæ™¯è‰² */\n+    }\n \n-/* å¼ºçƒˆæ¨è - å†…éƒ¨èƒŒæ™¯ä¸ºæµ…ç»¿è‰² */\n-.high-weight {\n-    background-color: #E8F5E9 !important; /* éå¸¸æµ…çš„ç»¿è‰² */\n-    border: 2px solid #4CAF50; /* å¤–è¾¹æ¡†ä¸ºç»¿è‰² */\n-    border-left: 6px solid #4CAF50; /* å·¦ä¾§æ¡ä¿ç•™ */\n-}\n+    /* å¼ºçƒˆæ¨è - å†…éƒ¨èƒŒæ™¯ä¸ºæµ…ç»¿è‰² */\n+    .high-weight {\n+        background-color: #E8F5E9 !important; /* éå¸¸æµ…çš„ç»¿è‰² */\n+        border: 2px solid #4CAF50; /* å¤–è¾¹æ¡†ä¸ºç»¿è‰² */\n+        border-left: 6px solid #4CAF50; /* å·¦ä¾§æ¡ä¿ç•™ */\n+    }\n \n-/* æ¨è - å†…éƒ¨èƒŒæ™¯ä¸ºæµ…é»„è‰² */\n-.medium-weight {\n-    background-color: #FFFDE7 !important; /* éå¸¸æµ…çš„é»„è‰² */\n-    border: 2px solid #FFC107; /* å¤–è¾¹æ¡†ä¸ºé»„è‰² */\n-    border-left: 6px solid #FFC107; /* å·¦ä¾§æ¡ä¿ç•™ */\n-}\n+    /* æ¨è - å†…éƒ¨èƒŒæ™¯ä¸ºæµ…é»„è‰² */\n+    .medium-weight {\n+        background-color: #FFFDE7 !important; /* éå¸¸æµ…çš„é»„è‰² */\n+        border: 2px solid #FFC107; /* å¤–è¾¹æ¡†ä¸ºé»„è‰² */\n+        border-left: 6px solid #FFC107; /* å·¦ä¾§æ¡ä¿ç•™ */\n+    }\n \n-/* å°‘é‡å°è¯• - å†…éƒ¨èƒŒæ™¯ä¸ºæµ…çº¢è‰² */\n-.low-weight {\n-    background-color: #FFEBEE !important; /* éå¸¸æµ…çš„çº¢è‰² */\n-    border: 2px solid #F44336; /* å¤–è¾¹æ¡†ä¸ºçº¢è‰² */\n-    border-left: 6px solid #F44336; /* å·¦ä¾§æ¡ä¿ç•™ */\n-}\n+    /* å°‘é‡å°è¯• - å†…éƒ¨èƒŒæ™¯ä¸ºæµ…çº¢è‰² */\n+    .low-weight {\n+        background-color: #FFEBEE !important; /* éå¸¸æµ…çš„çº¢è‰² */\n+        border: 2px solid #F44336; /* å¤–è¾¹æ¡†ä¸ºçº¢è‰² */\n+        border-left: 6px solid #F44336; /* å·¦ä¾§æ¡ä¿ç•™ */\n+    }\n \n-/* æ‚¬åœæ•ˆæœ */\n-.recommendation-card:hover {\n-    transform: translateY(-5px);\n-    box-shadow: 0 8px 15px rgba(0,0,0,0.1);\n-}\n+    /* æ‚¬åœæ•ˆæœ */\n+    .recommendation-card:hover {\n+        transform: translateY(-5px);\n+        box-shadow: 0 8px 15px rgba(0,0,0,0.1);\n+    }\n \n-/* å¼ºçƒˆæ¨èæ‚¬åœæ—¶èƒŒæ™¯åŠ æ·± */\n-.high-weight:hover {\n-    background-color: #C8E6C9 !important;\n-}\n+    /* å¼ºçƒˆæ¨èæ‚¬åœæ—¶èƒŒæ™¯åŠ æ·± */\n+    .high-weight:hover {\n+        background-color: #C8E6C9 !important;\n+    }\n \n-/* æ¨èæ‚¬åœæ—¶èƒŒæ™¯åŠ æ·± */\n-.medium-weight:hover {\n-    background-color: #FFECB3 !important;\n-}\n+    /* æ¨èæ‚¬åœæ—¶èƒŒæ™¯åŠ æ·± */\n+    .medium-weight:hover {\n+        background-color: #FFECB3 !important;\n+    }\n \n-/* å°‘é‡å°è¯•æ‚¬åœæ—¶èƒŒæ™¯åŠ æ·± */\n-.low-weight:hover {\n-    background-color: #FFCDD2 !important;\n-}\n+    /* å°‘é‡å°è¯•æ‚¬åœæ—¶èƒŒæ™¯åŠ æ·± */\n+    .low-weight:hover {\n+        background-color: #FFCDD2 !important;\n+    }\n \n-/* æ ‡é¢˜é¢œè‰²å¢å¼º */\n-.recommendation-card h3 {\n-    color: #333; /* æ·±ç°è‰²å¢å¼ºå¯è¯»æ€§ */\n-    margin-top: 0;\n-}\n+    /* æ ‡é¢˜é¢œè‰²å¢å¼º */\n+    .recommendation-card h3 {\n+        color: #333; /* æ·±ç°è‰²å¢å¼ºå¯è¯»æ€§ */\n+        margin-top: 0;\n+    }\n     .nutrient-bar {\n         height: 10px;\n         background-color: #f0f0f0;\n         border-radius: 5px;\n"
                }
            ],
            "date": 1752476972049,
            "name": "Commit-0",
            "content": "import streamlit as st\nimport requests\nimport time\nimport json\nimport pandas as pd\nimport numpy as np\nfrom datetime import datetime\n\n# è®¾ç½®é¡µé¢é…ç½®\nst.set_page_config(\n    page_title=\"æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ\",\n    page_icon=\"ğŸ²\",\n    layout=\"wide\",\n    initial_sidebar_state=\"expanded\"\n)\n\n# è‡ªå®šä¹‰CSSæ ·å¼\nst.markdown(\"\"\"\n<style>\n    .stApp {\n        background-color: #f5f7fa;\n    }\n    .header {\n        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);\n        color: white;\n        padding: 2rem;\n        border-radius: 0 0 20px 20px;\n        margin-bottom: 2rem;\n    }\n    .section {\n        background: white;\n        border-radius: 15px;\n        padding: 1.5rem;\n        box-shadow: 0 4px 10px rgba(0,0,0,0.05);\n        margin-bottom: 1.5rem;\n    }\n    .dish-card {\n        border: 1px solid #e0e6ed;\n        border-radius: 10px;\n        padding: 1rem;\n        margin-bottom: 1rem;\n        background: #f9fbfd;\n    }\n    .recommendation-card {\n        border-radius: 10px;\n        padding: 1rem;\n        margin-bottom: 1rem;\n        box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n    }\n    .high-weight {\n        background: #d4f7e2;\n        border-left: 4px solid #2ecc71;\n    }\n    .medium-weight {\n        background: #fef5e7;\n        border-left: 4px solid #f39c12;\n    }\n    .low-weight {\n        background: #fce8e6;\n        border-left: 4px solid #e74c3c;\n    }\n    .submit-btn {\n        width: 100%;\n        padding: 0.75rem;\n        border-radius: 8px;\n        background: #3498db;\n        color: white;\n        font-weight: bold;\n        border: none;\n        cursor: pointer;\n        transition: background 0.3s;\n    }\n    .submit-btn:hover {\n        background: #2980b9;\n    }\n    .add-btn {\n        background: #2ecc71;\n        color: white;\n        border: none;\n        border-radius: 5px;\n        padding: 0.5rem 1rem;\n        cursor: pointer;\n        transition: background 0.3s;\n    }\n    .add-btn:hover {\n        background: #27ae60;\n    }\n    .remove-btn {\n        background: #e74c3c;\n        color: white;\n        border: none;\n        border-radius: 5px;\n        padding: 0.25rem 0.75rem;\n        cursor: pointer;\n        margin-left: 0.5rem;\n    }\n    .spinner {\n        display: inline-block;\n        width: 20px;\n        height: 20px;\n        border: 3px solid rgba(0,0,0,0.1);\n        border-radius: 50%;\n        border-top-color: #3498db;\n        animation: spin 1s linear infinite;\n        margin-right: 10px;\n    }\n    @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n    }\n    .nutrient-bar {\n        height: 10px;\n        border-radius: 5px;\n        margin-top: 5px;\n        background: #e0e0e0;\n    }\n    .nutrient-fill {\n        height: 100%;\n        border-radius: 5px;\n        background: #3498db;\n    }\n    .nutrient-value {\n        font-size: 0.9rem;\n        margin-top: 3px;\n        text-align: right;\n    }\n</style>\n\"\"\", unsafe_allow_html=True)\n\n# åº”ç”¨æ ‡é¢˜\nst.markdown(\"\"\"\n<div class=\"header\">\n    <h1 style=\"text-align:center; margin:0;\">ğŸ² æ™ºèƒ½èœå“æ¨èç³»ç»Ÿ</h1>\n    <p style=\"text-align:center; margin:0; opacity:0.9;\">åŸºäºè¥å…»å­¦ä¸AIçš„ä¸ªæ€§åŒ–èœå“æ¨è</p>\n</div>\n\"\"\", unsafe_allow_html=True)\n\n# åç«¯æœåŠ¡URL\nBACKEND_URL = \"http://192.168.99.55:5000/recommend_dishes\"\n\n# åˆå§‹åŒ–session state\nif 'dishes' not in st.session_state:\n    st.session_state.dishes = [{\"name\": \"\", \"weight\": 100}]\n\nif 'recommendations' not in st.session_state:\n    st.session_state.recommendations = None\n\nif 'request_data' not in st.session_state:\n    st.session_state.request_data = None\n\nif 'response_time' not in st.session_state:\n    st.session_state.response_time = None\n\n# æ·»åŠ èœå“\ndef add_dish():\n    st.session_state.dishes.append({\"name\": \"\", \"weight\": 100})\n\n# åˆ é™¤èœå“\ndef remove_dish(index):\n    if len(st.session_state.dishes) > 1:\n        st.session_state.dishes.pop(index)\n\n# æäº¤è¡¨å•\ndef submit_form():\n    # éªŒè¯ç”¨æˆ·ä¿¡æ¯\n    required_fields = ['gender', 'age', 'height', 'weight', 'activity_level', 'meal_type']\n    if not all([st.session_state.get(field) for field in required_fields]):\n        st.error(\"è¯·å¡«å†™å®Œæ•´çš„ä¸ªäººä¿¡æ¯\")\n        return False\n    \n    # éªŒè¯èœå“ä¿¡æ¯\n    for i, dish in enumerate(st.session_state.dishes):\n        if not dish[\"name\"]:\n            st.error(f\"èœå“ #{i+1} åç§°ä¸èƒ½ä¸ºç©º\")\n            return False\n        if dish[\"weight\"] <= 0:\n            st.error(f\"èœå“ #{i+1} é‡é‡å¿…é¡»å¤§äº0\")\n            return False\n    \n    return True\n\n# è°ƒç”¨åç«¯æœåŠ¡\ndef call_backend_service():\n    # å‡†å¤‡è¯·æ±‚æ•°æ®\n    st.session_state.request_data = {\n        \"info\": {\n            \"æ€§åˆ«\": st.session_state.gender,\n            \"å¹´é¾„\": st.session_state.age,\n            \"èº«é«˜\": st.session_state.height,\n            \"ä½“é‡\": st.session_state.weight,\n            \"activity_level\": st.session_state.activity_level\n        },\n        \"data\": {\n            \"é¤åˆ«\": st.session_state.meal_type,\n            \"èœå“åç§°\": [\n                {\n                    \"é£Ÿå“åç§°\": dish[\"name\"],\n                    \"é£Ÿå“å…‹æ•°\": dish[\"weight\"]\n                } for dish in st.session_state.dishes\n            ]\n        }\n    }\n    \n    try:\n        # æ˜¾ç¤ºåŠ è½½çŠ¶æ€\n        with st.spinner(\"æ­£åœ¨åˆ†ææ‚¨çš„è¥å…»éœ€æ±‚ï¼Œè¯·ç¨å€™...\"):\n            start_time = time.time()\n            \n            # å‘é€è¯·æ±‚\n            response = requests.post(\n                BACKEND_URL,\n                json=st.session_state.request_data,\n                timeout=120  # 120ç§’è¶…æ—¶\n            )\n            \n            end_time = time.time()\n            st.session_state.response_time = end_time - start_time\n            \n            # æ£€æŸ¥å“åº”çŠ¶æ€\n            if response.status_code == 200:\n                data = response.json()\n                if data.get(\"success\"):\n                    st.session_state.recommendations = data[\"result\"]\n                    return True\n                else:\n                    st.error(f\"æœåŠ¡è¿”å›é”™è¯¯: {data.get('error', 'æœªçŸ¥é”™è¯¯')}\")\n            else:\n                st.error(f\"è¯·æ±‚å¤±è´¥, çŠ¶æ€ç : {response.status_code}\")\n                st.error(f\"é”™è¯¯ä¿¡æ¯: {response.text}\")\n    except requests.exceptions.Timeout:\n        st.error(\"è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•\")\n    except requests.exceptions.ConnectionError:\n        st.error(\"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\")\n    except Exception as e:\n        st.error(f\"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}\")\n    \n    return False\n\n# å·¦ä¾§æ  - ç”¨æˆ·ä¿¡æ¯è¾“å…¥\nwith st.sidebar:\n    st.markdown(\"### ğŸ§‘ ä¸ªäººä¿¡æ¯\")\n    with st.container():\n        st.selectbox(\"æ€§åˆ«\", [\"ç”·\", \"å¥³\"], key=\"gender\", index=0)\n        st.number_input(\"å¹´é¾„\", min_value=1, max_value=120, key=\"age\", value=20)\n        st.number_input(\"èº«é«˜ (cm)\", min_value=50, max_value=250, key=\"height\", value=175)\n        st.number_input(\"ä½“é‡ (kg)\", min_value=10, max_value=200, key=\"weight\", value=65.5)\n        st.selectbox(\n            \"æ´»åŠ¨æ°´å¹³\", \n            [\"è½»æ´»åŠ¨æ°´å¹³(åŠå…¬å®¤å·¥ä½œï¼Œå¾ˆå°‘è¿åŠ¨)\", \"ä¸­æ´»åŠ¨æ°´å¹³(æ¯å¤©é€‚é‡è¿åŠ¨)\", \"é‡æ´»åŠ¨æ°´å¹³(ä½“åŠ›åŠ³åŠ¨æˆ–é«˜å¼ºåº¦è®­ç»ƒ)\"], \n            key=\"activity_level\",\n            index=1\n        )\n        st.selectbox(\n            \"é¤åˆ«\", \n            [\"æ—©é¤\", \"åˆé¤\", \"æ™šé¤\"], \n            key=\"meal_type\",\n            index=1\n        )\n\n# ä¸»å†…å®¹åŒº\ncol1, col2 = st.columns([1, 1])\n\nwith col1:\n    # èœå“è¾“å…¥éƒ¨åˆ†\n    st.markdown(\"### ğŸ½ï¸ èœå“ä¿¡æ¯\")\n    with st.container():\n        for i, dish in enumerate(st.session_state.dishes):\n            with st.container():\n                col_a, col_b = st.columns([3, 1])\n                with col_a:\n                    dish_name = st.text_input(\n                        f\"èœå“ #{i+1} åç§°\", \n                        value=dish[\"name\"],\n                        key=f\"dish_name_{i}\",\n                        placeholder=\"ä¾‹å¦‚: ç•ªèŒ„ç‚’è›‹\"\n                    )\n                with col_b:\n                    dish_weight = st.number_input(\n                        \"é‡é‡ (g)\", \n                        min_value=1, \n                        value=dish[\"weight\"],\n                        key=f\"dish_weight_{i}\"\n                    )\n                \n                # æ›´æ–°session state\n                st.session_state.dishes[i][\"name\"] = dish_name\n                st.session_state.dishes[i][\"weight\"] = dish_weight\n                \n                # åˆ é™¤æŒ‰é’®ï¼ˆä¸æ˜¯ç¬¬ä¸€ä¸ªèœå“æ—¶æ˜¾ç¤ºï¼‰\n                if i > 0:\n                    st.button(\"åˆ é™¤\", key=f\"remove_{i}\", on_click=remove_dish, args=(i,))\n        \n        # æ·»åŠ èœå“æŒ‰é’®\n        st.button(\"â• æ·»åŠ èœå“\", on_click=add_dish, use_container_width=True)\n        \n        # æäº¤æŒ‰é’®\n        if st.button(\"ç”Ÿæˆèœå“æ¨è\", use_container_width=True, type=\"primary\"):\n            if submit_form():\n                if call_backend_service():\n                    st.success(\"æ¨èç»“æœå·²ç”Ÿæˆï¼\")\n                else:\n                    st.session_state.recommendations = None\n\nwith col2:\n    # ç»“æœæ˜¾ç¤ºéƒ¨åˆ†\n    st.markdown(\"### ğŸ“Š æ¨èç»“æœ\")\n    \n    if st.session_state.recommendations:\n        recommendations = st.session_state.recommendations\n        \n        # æ˜¾ç¤ºè¯·æ±‚ä¿¡æ¯\n        st.caption(f\"è¯·æ±‚æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} | å“åº”æ—¶é—´: {st.session_state.response_time:.2f}ç§’\")\n        \n        # æ˜¾ç¤ºé¤åˆ«å’Œæ±‚è§£çŠ¶æ€\n        st.markdown(f\"**é¤åˆ«**: {recommendations.get('é¤åˆ«', 'åˆé¤')}\")\n        st.markdown(f\"**æ±‚è§£çŠ¶æ€**: {recommendations.get('æ±‚è§£çŠ¶æ€', 'æœªçŸ¥')}\")\n        \n        # æ˜¾ç¤ºèœå“æ¨è\n        st.markdown(\"### èœå“æ¨è\")\n        \n        # åˆ›å»ºé€‰é¡¹å¡\n        tab1, tab2 = st.tabs([\"æ¨èè¯¦æƒ…\", \"è¥å…»åˆ†æ\"])\n        \n        with tab1:\n            for dish in recommendations.get(\"èœå“æ¨è\", []):\n                weight = dish.get(\"æ¨èæƒé‡\", 0)\n                \n                # æ ¹æ®æƒé‡è®¾ç½®æ ·å¼\n                if weight >= 0.7:\n                    card_class = \"high-weight\"\n                    recommendation_text = \"å¼ºçƒˆæ¨è\"\n                elif weight >= 0.5:\n                    card_class = \"medium-weight\"\n                    recommendation_text = \"æ¨è\"\n                elif weight >= 0.3:\n                    card_class = \"medium-weight\"\n                    recommendation_text = \"é€‚é‡é£Ÿç”¨\"\n                else:\n                    card_class = \"low-weight\"\n                    recommendation_text = \"å°‘é‡å°è¯•\"\n                \n                with st.container():\n                    st.markdown(f\"<div class='recommendation-card {card_class}'>\", unsafe_allow_html=True)\n                    \n                    # èœå“åç§°å’Œæƒé‡\n                    col1, col2 = st.columns([3, 1])\n                    with col1:\n                        st.markdown(f\"#### {dish.get('èœå“åç§°', 'æœªçŸ¥èœå“')}\")\n                    with col2:\n                        st.markdown(f\"**æƒé‡**: {weight:.2f} ({recommendation_text})\")\n                    \n                    # æ¨èåŸå› \n                    st.markdown(f\"**åŸå› **: {dish.get('åŸå› ', 'æš‚æ— æ¨èç†ç”±')}\")\n                    \n                    # è¥å…»å€¼æ‘˜è¦\n                    with st.expander(\"æŸ¥çœ‹è¥å…»è¯¦æƒ…\"):\n                        nutrition = dish.get(\"è¥å…»å€¼\", {})\n                        if nutrition:\n                            col1, col2, col3 = st.columns(3)\n                            with col1:\n                                st.metric(\"èƒ½é‡\", f\"{nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n                                st.metric(\"è›‹ç™½è´¨\", f\"{nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n                            with col2:\n                                st.metric(\"è„‚è‚ª\", f\"{nutrition.get('è„‚è‚ª', 0):.1f} g\")\n                                st.metric(\"ç¢³æ°´åŒ–åˆç‰©\", f\"{nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n                            with col3:\n                                st.metric(\"é’ \", f\"{nutrition.get('é’ ', 0):.1f} mg\")\n                                st.metric(\"ç»´ç”Ÿç´ C\", f\"{nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n                        else:\n                            st.warning(\"æ— è¥å…»æ•°æ®\")\n                    \n                    st.markdown(\"</div>\", unsafe_allow_html=True)\n        \n        with tab2:\n            # æ•´é¤è¥å…»æ‘˜è¦\n            total_nutrition = recommendations.get(\"æ•´é¤è¥å…»æ‘˜è¦\", {})\n            if total_nutrition:\n                st.markdown(\"### æ•´é¤è¥å…»æ‘˜è¦\")\n                \n                # åˆ›å»ºè¥å…»æŒ‡æ ‡å¡ç‰‡\n                col1, col2, col3 = st.columns(3)\n                with col1:\n                    st.metric(\"æ€»èƒ½é‡\", f\"{total_nutrition.get('èƒ½é‡', 0):.1f} kcal\")\n                    st.metric(\"æ€»è›‹ç™½è´¨\", f\"{total_nutrition.get('è›‹ç™½è´¨', 0):.1f} g\")\n                with col2:\n                    st.metric(\"æ€»è„‚è‚ª\", f\"{total_nutrition.get('è„‚è‚ª', 0):.1f} g\")\n                    st.metric(\"æ€»ç¢³æ°´åŒ–åˆç‰©\", f\"{total_nutrition.get('ç¢³æ°´åŒ–åˆç‰©', 0):.1f} g\")\n                with col3:\n                    st.metric(\"æ€»é’ \", f\"{total_nutrition.get('é’ ', 0):.1f} mg\")\n                    st.metric(\"æ€»ç»´ç”Ÿç´ C\", f\"{total_nutrition.get('ç»´ç”Ÿç´ C', 0):.1f} mg\")\n                \n                # è¥å…»åˆ†å¸ƒå›¾è¡¨\n                st.markdown(\"### è¥å…»åˆ†å¸ƒ\")\n                \n                # ä¸»è¦è¥å…»ç´ \n                main_nutrients = [\"èƒ½é‡\", \"è›‹ç™½è´¨\", \"è„‚è‚ª\", \"ç¢³æ°´åŒ–åˆç‰©\"]\n                main_values = [total_nutrition.get(n, 0) for n in main_nutrients]\n                \n                # åˆ›å»ºDataFrame\n                df = pd.DataFrame({\n                    \"è¥å…»ç´ \": main_nutrients,\n                    \"å«é‡\": main_values\n                })\n                \n                # æ˜¾ç¤ºæŸ±çŠ¶å›¾\n                st.bar_chart(df.set_index(\"è¥å…»ç´ \"))\n                \n                # å¾®é‡è¥å…»ç´ \n                micro_nutrients = [\"é’™\", \"é“\", \"ç»´ç”Ÿç´ A\", \"ç»´ç”Ÿç´ C\", \"é’ \"]\n                micro_values = [total_nutrition.get(n, 0) for n in micro_nutrients]\n                \n                # æ˜¾ç¤ºå¾®é‡è¥å…»ç´ \n                st.markdown(\"### å¾®é‡è¥å…»ç´ \")\n                for nutrient, value in zip(micro_nutrients, micro_values):\n                    st.markdown(f\"**{nutrient}**: {value:.1f}\")\n                    # æ·»åŠ ç®€å•çš„è¿›åº¦æ¡\n                    max_value = max(micro_values) * 1.1 if max(micro_values) > 0 else 100\n                    percent = min(value / max_value, 1.0) if max_value > 0 else 0\n                    st.markdown(f\"\"\"\n                    <div class=\"nutrient-bar\">\n                        <div class=\"nutrient-fill\" style=\"width: {percent*100}%;\"></div>\n                    </div>\n                    <div class=\"nutrient-value\">{value:.1f}</div>\n                    \"\"\", unsafe_allow_html=True)\n            else:\n                st.warning(\"æ— æ•´é¤è¥å…»æ‘˜è¦æ•°æ®\")\n    else:\n        st.info(\"è¯·å¡«å†™å·¦ä¾§è¡¨å•å¹¶ç‚¹å‡»'ç”Ÿæˆèœå“æ¨è'æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\")\n\n# æ·»åŠ ä¸€äº›è¯´æ˜\nst.markdown(\"---\")\nst.markdown(\"\"\"\n### ä½¿ç”¨è¯´æ˜\n1. åœ¨å·¦ä¾§å¡«å†™æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰ï¼‰\n2. æ·»åŠ æ‚¨æƒ³è¯„ä¼°çš„èœå“ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰\n3. ç‚¹å‡»\"ç”Ÿæˆèœå“æ¨è\"æŒ‰é’®è·å–ä¸ªæ€§åŒ–æ¨è\n4. æŸ¥çœ‹å³ä¾§çš„æ¨èç»“æœï¼Œäº†è§£æ¯é“èœçš„æ¨èç¨‹åº¦å’ŒåŸå› \n\n**æ¨èæƒé‡è¯´æ˜**:\n- **å¼ºçƒˆæ¨è (æƒé‡ â‰¥ 0.7)**: è¥å…»å‡è¡¡ä¸”ç¬¦åˆéœ€æ±‚\n- **æ¨è (0.5 â‰¤ æƒé‡ < 0.7)**: è¥å…»è‰¯å¥½ï¼Œé€‚åˆé£Ÿç”¨\n- **é€‚é‡é£Ÿç”¨ (0.3 â‰¤ æƒé‡ < 0.5)**: å¯ä»¥å°‘é‡é£Ÿç”¨\n- **å°‘é‡å°è¯• (æƒé‡ < 0.3)**: å»ºè®®æœ¬é¤é¿å…æˆ–å°‘é‡å°è¯•\n\"\"\")\n\n# è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰\nif st.checkbox(\"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯\"):\n    st.markdown(\"### è¯·æ±‚æ•°æ®\")\n    st.json(st.session_state.request_data)\n    \n    if st.session_state.recommendations:\n        st.markdown(\"### å®Œæ•´å“åº”\")\n        st.json(st.session_state.recommendations)"
        }
    ]
}